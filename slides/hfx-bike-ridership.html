<!DOCTYPE html>
<html lang="en"><head>
<script src="hfx-bike-ridership_files/libs/clipboard/clipboard.min.js"></script>
<script src="hfx-bike-ridership_files/libs/quarto-html/tabby.min.js"></script>
<script src="hfx-bike-ridership_files/libs/quarto-html/popper.min.js"></script>
<script src="hfx-bike-ridership_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="hfx-bike-ridership_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="hfx-bike-ridership_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="hfx-bike-ridership_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.0.15">

  <meta name="author" content="Taylor Dunn">
  <title>Predicting bike ridership in Halifax, Nova Scotia</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="hfx-bike-ridership_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="hfx-bike-ridership_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="hfx-bike-ridership_files/libs/revealjs/dist/theme/quarto.css" id="theme">
  <link href="hfx-bike-ridership_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="hfx-bike-ridership_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="hfx-bike-ridership_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="hfx-bike-ridership_files/libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="hfx-bike-ridership_files/libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="hfx-bike-ridership_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-captioned.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-captioned) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-captioned.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-captioned .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-captioned .callout-caption  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-captioned.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-captioned.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-caption {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-caption {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-caption {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-captioned .callout-body > .callout-content > :last-child {
    margin-bottom: 0.5rem;
  }

  .callout.callout-captioned .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-captioned) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-caption {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-caption {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-caption {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-caption {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-caption {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  
  <script src="hfx-bike-ridership_files/libs/kePrint-0.0.1/kePrint.js"></script>
  <link href="hfx-bike-ridership_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="center">
  <h1 class="title">Predicting bike ridership in Halifax, Nova Scotia</h1>
  <p class="author">Taylor Dunn</p>
</section>

<section id="background" class="slide level2">
<h2>Background</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><img data-src="images/cbc-article.PNG"></p>
</div><div class="column fragment" style="width:50%;">
<ul>
<li>Temporary tube counters</li>
</ul>
<p><img data-src="images/pneumatic-tube-counter.png"></p>
</div>
</div>
<aside class="notes">
<ul>
<li>In 2016, the city of Halifax installed its first bike counter to track cyclists</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="background-1" class="slide level2">
<h2>Background</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><img data-src="images/permanent-zelt.png"></p>
</div><div class="column fragment" style="width:50%;">
<ul>
<li>Starting in 2020, the city made bike counter data available via their open data platform</li>
</ul>
<p><img data-src="images/halifax-open-data-bikes.PNG"></p>
</div>
</div>
<aside class="notes">
<ul>
<li>A few years later, they installed permanent bike counters that are actually underground so they can work all year round</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="motivation" class="slide level2">
<h2>Motivation</h2>
<ol type="1">
<li>To work with data that was interesting to me</li>
<li>To practice machine learning</li>
<li>To learn how to deploy a data pipeline and model on Google Cloud</li>
</ol>
</section>
<section id="plan-today" class="slide level2">
<h2>Plan today</h2>
<ol type="1">
<li>Getting and exploring the data</li>
<li>Modeling</li>
<li>Deployment</li>
</ol>
</section>
<section>
<section id="getting-the-bike-data" class="title-slide slide level1 center">
<h1>Getting the bike data</h1>

</section>
<section id="getting-the-bike-data-1" class="slide level2">
<h2>Getting the bike data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>query_url <span class="ot">&lt;-</span> <span class="st">"https://services2.arcgis.com/11XBiaBYA9Ep0yNJ/arcgis/rest/services/Bicycle_Counts/FeatureServer/0/query?where=1%3D1&amp;outFields=*&amp;outSR=4326&amp;f=json"</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>resp <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">GET</span>(query_url)</span>
<span id="cb1-3"><a href="#cb1-3"></a>resp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Response [https://services2.arcgis.com/11XBiaBYA9Ep0yNJ/arcgis/rest/services/Bicycle_Counts/FeatureServer/0/query?where=1%3D1&amp;outFields=*&amp;outSR=4326&amp;f=json]
  Date: 2022-04-27 03:26
  Status: 200
  Content-Type: application/json; charset=utf-8
  Size: 579 kB</code></pre>
</div>
</div>
</section>
<section id="getting-the-bike-data-2" class="slide level2">
<h2>Getting the bike data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>parsed_content <span class="ot">&lt;-</span> <span class="fu">content</span>(resp)</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="fu">str</span>(parsed_content, <span class="at">max.level =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 6
 $ objectIdFieldName    : chr "ObjectId"
 $ uniqueIdField        :List of 2
 $ globalIdFieldName    : chr ""
 $ fields               :List of 11
 $ exceededTransferLimit: logi TRUE
 $ features             :List of 2000</code></pre>
</div>
</div>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>parsed_content<span class="sc">$</span>features[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> <span class="fu">str</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 1
 $ attributes:List of 11
  ..$ CHANNEL_ID       : chr "100059339"
  ..$ CHANNEL_NAME     : chr "Hollis St"
  ..$ SERIAL_NUMBER    : chr "X2H20032465"
  ..$ SITE_NAME        : chr "Hollis St"
  ..$ LATITUDE         : num 44.6
  ..$ LONGITUDE        : num -63.6
  ..$ INSTALLATION_DATE: num 1.59e+12
  ..$ COUNT_DATETIME   : num 1.6e+12
  ..$ COUNTER_TYPE     : chr "Bicycle"
  ..$ COUNTER_VALUE    : int 2
  ..$ ObjectId         : int 1</code></pre>
</div>
</div>
</div>
</section>
<section id="getting-the-bike-data-3" class="slide level2">
<h2>Getting the bike data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>bike_counts <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(</span>
<span id="cb7-2"><a href="#cb7-2"></a>  parsed_content<span class="sc">$</span>features,</span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="sc">~</span> <span class="fu">as_tibble</span>(.x<span class="sc">$</span>attributes)</span>
<span id="cb7-4"><a href="#cb7-4"></a>)</span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="fu">glimpse</span>(bike_counts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 2,000
Columns: 11
$ CHANNEL_ID        &lt;chr&gt; "100059339", "100059339", "100059339", "100059339", …
$ CHANNEL_NAME      &lt;chr&gt; "Hollis St", "Hollis St", "Hollis St", "Hollis St", …
$ SERIAL_NUMBER     &lt;chr&gt; "X2H20032465", "X2H20032465", "X2H20032465", "X2H200…
$ SITE_NAME         &lt;chr&gt; "Hollis St", "Hollis St", "Hollis St", "Hollis St", …
$ LATITUDE          &lt;dbl&gt; 44.64799, 44.64799, 44.64799, 44.64799, 44.64799, 44…
$ LONGITUDE         &lt;dbl&gt; -63.57352, -63.57352, -63.57352, -63.57352, -63.5735…
$ INSTALLATION_DATE &lt;dbl&gt; 1.594166e+12, 1.594166e+12, 1.594166e+12, 1.594166e+…
$ COUNT_DATETIME    &lt;dbl&gt; 1.595966e+12, 1.595970e+12, 1.595974e+12, 1.595977e+…
$ COUNTER_TYPE      &lt;chr&gt; "Bicycle", "Bicycle", "Bicycle", "Bicycle", "Bicycle…
$ COUNTER_VALUE     &lt;int&gt; 2, 1, 2, 2, 0, 0, 0, 0, 0, 0, 6, 4, 13, 8, 5, 6, 8, …
$ ObjectId          &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 1…</code></pre>
</div>
</div>
</section>
<section id="getting-the-bike-data-4" class="slide level2">
<h2>Getting the bike data</h2>
<ul>
<li><code>exceededTransferLimit = TRUE</code> tells us that 2000 records is the limit of a single API request.</li>
<li>How many total records are available?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" data-code-line-numbers="|2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>n_records <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">GET</span>(<span class="fu">paste0</span>(query_url,</span>
<span id="cb9-2"><a href="#cb9-2"></a>                              <span class="st">"&amp;returnCountOnly=true"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>  <span class="fu">content</span>(<span class="at">as =</span> <span class="st">"parsed"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>  <span class="fu">unlist</span>(<span class="at">use.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-5"><a href="#cb9-5"></a>n_records</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 124356</code></pre>
</div>
</div>
</section>
<section id="getting-the-bike-data-5" class="slide level2">
<h2>Getting the bike data</h2>
<ul>
<li>Write a function to get 2000 records at a time and iterate</li>
</ul>
<div class="cell">
<details>
<summary>get_bike_data()</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>get_bike_data <span class="ot">&lt;-</span> <span class="cf">function</span>(offset) {</span>
<span id="cb11-2"><a href="#cb11-2"></a>  <span class="co"># Need to prevent scientific notation, e.g. "1e+05" instead of "100000"</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>  offset <span class="ot">&lt;-</span> <span class="fu">format</span>(offset, <span class="at">scientific =</span> <span class="cn">FALSE</span>)</span>
<span id="cb11-4"><a href="#cb11-4"></a>  </span>
<span id="cb11-5"><a href="#cb11-5"></a>  parsed_content <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">GET</span>(<span class="fu">paste0</span>(query_url, <span class="st">"&amp;resultOffset="</span>, offset)) <span class="sc">%&gt;%</span></span>
<span id="cb11-6"><a href="#cb11-6"></a>    <span class="fu">content</span>(<span class="at">as =</span> <span class="st">"parsed"</span>)</span>
<span id="cb11-7"><a href="#cb11-7"></a>  </span>
<span id="cb11-8"><a href="#cb11-8"></a>  <span class="fu">map_dfr</span>(</span>
<span id="cb11-9"><a href="#cb11-9"></a>    parsed_content<span class="sc">$</span>features,</span>
<span id="cb11-10"><a href="#cb11-10"></a>    <span class="sc">~</span> <span class="fu">as_tibble</span>(.x<span class="sc">$</span>attributes)</span>
<span id="cb11-11"><a href="#cb11-11"></a>  ) </span>
<span id="cb11-12"><a href="#cb11-12"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" data-code-line-numbers="|5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>bike_data <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(</span>
<span id="cb12-2"><a href="#cb12-2"></a>  <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fu">ceiling</span>(n_records <span class="sc">/</span> <span class="dv">2000</span>)),</span>
<span id="cb12-3"><a href="#cb12-3"></a>  <span class="sc">~</span> <span class="fu">get_bike_data</span>(<span class="at">offset =</span> .x <span class="sc">*</span> <span class="dv">2000</span>)</span>
<span id="cb12-4"><a href="#cb12-4"></a>)</span>
<span id="cb12-5"><a href="#cb12-5"></a>bike_data <span class="ot">&lt;-</span> janitor<span class="sc">::</span><span class="fu">clean_names</span>(bike_data)</span>
<span id="cb12-6"><a href="#cb12-6"></a><span class="fu">glimpse</span>(bike_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 124,356
Columns: 11
$ channel_id        &lt;chr&gt; "100059339", "100059339", "100059339", "100059339", …
$ channel_name      &lt;chr&gt; "Hollis St", "Hollis St", "Hollis St", "Hollis St", …
$ serial_number     &lt;chr&gt; "X2H20032465", "X2H20032465", "X2H20032465", "X2H200…
$ site_name         &lt;chr&gt; "Hollis St", "Hollis St", "Hollis St", "Hollis St", …
$ latitude          &lt;dbl&gt; 44.64799, 44.64799, 44.64799, 44.64799, 44.64799, 44…
$ longitude         &lt;dbl&gt; -63.57352, -63.57352, -63.57352, -63.57352, -63.5735…
$ installation_date &lt;dbl&gt; 1.594166e+12, 1.594166e+12, 1.594166e+12, 1.594166e+…
$ count_datetime    &lt;dbl&gt; 1.595966e+12, 1.595970e+12, 1.595974e+12, 1.595977e+…
$ counter_type      &lt;chr&gt; "Bicycle", "Bicycle", "Bicycle", "Bicycle", "Bicycle…
$ counter_value     &lt;int&gt; 2, 1, 2, 2, 0, 0, 0, 0, 0, 0, 6, 4, 13, 8, 5, 6, 8, …
$ object_id         &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 1…</code></pre>
</div>
</div>
</section></section>
<section>
<section id="exploring-the-bike-data" class="title-slide slide level1 center">
<h1>Exploring the bike data</h1>

</section>
<section id="exploring-the-bike-data-1" class="slide level2">
<h2>Exploring the bike data</h2>
<div class="cell">

</div>
<ul>
<li>How many records?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>bike_data <span class="sc">%&gt;%</span> <span class="fu">count</span>(site_name, channel_name, <span class="at">name =</span> <span class="st">"n_records"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">

<table>
<thead>
<tr>
<th style="text-align:left;">
site_name
</th>
<th style="text-align:left;">
channel_name
</th>
<th style="text-align:right;">
n_records
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Dartmouth Harbourfront Greenway
</td>
<td style="text-align:left;">
Dartmouth Harbourfront Greenway Northbound
</td>
<td style="text-align:right;">
6988
</td>
</tr>
<tr>
<td style="text-align:left;">
Dartmouth Harbourfront Greenway
</td>
<td style="text-align:left;">
Dartmouth Harbourfront Greenway Southbound
</td>
<td style="text-align:right;">
6988
</td>
</tr>
<tr>
<td style="text-align:left;">
Hollis St
</td>
<td style="text-align:left;">
Hollis St
</td>
<td style="text-align:right;">
15748
</td>
</tr>
<tr>
<td style="text-align:left;">
South Park St
</td>
<td style="text-align:left;">
South Park St Northbound
</td>
<td style="text-align:right;">
23212
</td>
</tr>
<tr>
<td style="text-align:left;">
South Park St
</td>
<td style="text-align:left;">
South Park St Southbound
</td>
<td style="text-align:right;">
23212
</td>
</tr>
<tr>
<td style="text-align:left;">
Vernon St
</td>
<td style="text-align:left;">
Vernon St Northbound
</td>
<td style="text-align:right;">
12052
</td>
</tr>
<tr>
<td style="text-align:left;">
Vernon St
</td>
<td style="text-align:left;">
Vernon St Southbound
</td>
<td style="text-align:right;">
12052
</td>
</tr>
<tr>
<td style="text-align:left;">
Windsor St
</td>
<td style="text-align:left;">
Windsor St Northbound
</td>
<td style="text-align:right;">
12052
</td>
</tr>
<tr>
<td style="text-align:left;">
Windsor St
</td>
<td style="text-align:left;">
Windsor St Southbound
</td>
<td style="text-align:right;">
12052
</td>
</tr>
</tbody>

</table>
</div>
</div>
</div>
<div class="fragment">
<ul>
<li>5 sites</li>
<li>4 out of 5 have two “channels”</li>
</ul>
</div>
</section>
<section id="exploring-the-bike-data-2" class="slide level2">
<h2>Exploring the bike data</h2>
<ul>
<li>Dates?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>bike_data <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>  <span class="fu">group_by</span>(site_name, installation_date) <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3"></a>  <span class="fu">summarise</span>(<span class="at">min_count_date =</span> <span class="fu">min</span>(count_date), <span class="at">max_count_date =</span> <span class="fu">max</span>(count_date),</span>
<span id="cb15-4"><a href="#cb15-4"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">

<table>
<thead>
<tr>
<th style="text-align:left;">
site_name
</th>
<th style="text-align:left;">
installation_date
</th>
<th style="text-align:left;">
min_count_date
</th>
<th style="text-align:left;">
max_count_date
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Dartmouth Harbourfront Greenway
</td>
<td style="text-align:left;">
2021-07-08
</td>
<td style="text-align:left;">
2021-07-08
</td>
<td style="text-align:left;">
2022-04-25
</td>
</tr>
<tr>
<td style="text-align:left;">
Hollis St
</td>
<td style="text-align:left;">
2020-07-08
</td>
<td style="text-align:left;">
2020-07-08
</td>
<td style="text-align:left;">
2022-04-25
</td>
</tr>
<tr>
<td style="text-align:left;">
South Park St
</td>
<td style="text-align:left;">
2019-09-01
</td>
<td style="text-align:left;">
2019-09-01
</td>
<td style="text-align:left;">
2022-04-25
</td>
</tr>
<tr>
<td style="text-align:left;">
Vernon St
</td>
<td style="text-align:left;">
2020-12-09
</td>
<td style="text-align:left;">
2020-12-09
</td>
<td style="text-align:left;">
2022-04-25
</td>
</tr>
<tr>
<td style="text-align:left;">
Windsor St
</td>
<td style="text-align:left;">
2020-12-09
</td>
<td style="text-align:left;">
2020-12-09
</td>
<td style="text-align:left;">
2022-04-25
</td>
</tr>
</tbody>

</table>
</div>
</div>
</div>
</section>
<section id="exploring-the-bike-data-3" class="slide level2">
<h2>Exploring the bike data</h2>
<ul>
<li>Where exactly are the sites?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>site_locs <span class="ot">&lt;-</span> bike_data <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>  <span class="fu">distinct</span>(site_name, <span class="at">lat =</span> latitude, <span class="at">lon =</span> longitude)</span>
<span id="cb16-3"><a href="#cb16-3"></a></span>
<span id="cb16-4"><a href="#cb16-4"></a>mean_lat <span class="ot">&lt;-</span> <span class="fu">mean</span>(site_locs<span class="sc">$</span>lat)</span>
<span id="cb16-5"><a href="#cb16-5"></a>mean_lon <span class="ot">&lt;-</span> <span class="fu">mean</span>(site_locs<span class="sc">$</span>lon)</span>
<span id="cb16-6"><a href="#cb16-6"></a><span class="fu">c</span>(mean_lat, mean_lon)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  44.65037 -63.58116</code></pre>
</div>
</div>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="fu">library</span>(ggmap)</span>
<span id="cb18-2"><a href="#cb18-2"></a>halifax_map <span class="ot">&lt;-</span> <span class="fu">get_googlemap</span>(<span class="fu">c</span>(mean_lon, mean_lat),</span>
<span id="cb18-3"><a href="#cb18-3"></a>                             <span class="at">zoom =</span> <span class="dv">14</span>, <span class="at">maptype =</span> <span class="st">"satellite"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">

</div>
</div>
</section>
<section id="exploring-the-bike-data-4" class="slide level2">
<h2>Exploring the bike data</h2>
<ul>
<li>Where exactly are the sites?</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="fu">ggmap</span>(halifax_map) <span class="sc">+</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> site_locs, <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb19-3"><a href="#cb19-3"></a>             <span class="fu">aes</span>(<span class="at">fill =</span> site_name), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb19-4"><a href="#cb19-4"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_label_repel</span>(</span>
<span id="cb19-5"><a href="#cb19-5"></a>    <span class="at">data =</span> site_locs,</span>
<span id="cb19-6"><a href="#cb19-6"></a>    <span class="fu">aes</span>(<span class="at">color =</span> site_name, <span class="at">label =</span> <span class="fu">str_trunc</span>(site_name, <span class="at">width =</span> <span class="dv">25</span>)),</span>
<span id="cb19-7"><a href="#cb19-7"></a>    <span class="at">box.padding =</span> <span class="fl">1.0</span></span>
<span id="cb19-8"><a href="#cb19-8"></a>  ) <span class="sc">+</span></span>
<span id="cb19-9"><a href="#cb19-9"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb19-10"><a href="#cb19-10"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="hfx-bike-ridership_files/figure-revealjs/unnamed-chunk-18-1.png" width="960" class="r-stretch"></section>
<section id="exploring-the-bike-data-5" class="slide level2">
<h2>Exploring the bike data</h2>
<ul>
<li>At what frequency are data recorded?</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>bike_data <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>  <span class="fu">mutate</span>(<span class="at">time_of_day =</span> <span class="fu">format</span>(count_datetime, <span class="st">"%H:%M:%S"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3"></a>  <span class="fu">count</span>(site_name, time_of_day, <span class="at">name =</span> <span class="st">"n_records"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-4"><a href="#cb20-4"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> time_of_day, <span class="at">x =</span> n_records)) <span class="sc">+</span></span>
<span id="cb20-5"><a href="#cb20-5"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">str_trunc</span>(site_name, <span class="dv">20</span>))) <span class="sc">+</span></span>
<span id="cb20-6"><a href="#cb20-6"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb20-7"><a href="#cb20-7"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb20-8"><a href="#cb20-8"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">5000</span>, <span class="dv">1000</span>)) <span class="sc">+</span></span>
<span id="cb20-9"><a href="#cb20-9"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="hfx-bike-ridership_files/figure-revealjs/unnamed-chunk-19-1.png" width="960" class="r-stretch"></section>
<section id="exploring-the-bike-data-6" class="slide level2">
<h2>Exploring the bike data</h2>
<ul>
<li>What time zone is this?</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>bike_data_tod <span class="ot">&lt;-</span> bike_data <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>  <span class="fu">mutate</span>(</span>
<span id="cb21-3"><a href="#cb21-3"></a>    <span class="at">time_of_day =</span> <span class="fu">format</span>(count_datetime, <span class="st">"%H:%M:%S"</span>),</span>
<span id="cb21-4"><a href="#cb21-4"></a>    <span class="co"># Create a dummy variable with arbitrary date so I can plot time of day</span></span>
<span id="cb21-5"><a href="#cb21-5"></a>    <span class="at">time_of_day =</span> lubridate<span class="sc">::</span><span class="fu">ymd_hms</span>(</span>
<span id="cb21-6"><a href="#cb21-6"></a>      <span class="fu">paste0</span>(<span class="st">"2022-04-22 "</span>, time_of_day)</span>
<span id="cb21-7"><a href="#cb21-7"></a>    )</span>
<span id="cb21-8"><a href="#cb21-8"></a>  )</span>
<span id="cb21-9"><a href="#cb21-9"></a>bike_data_tod <span class="sc">%&gt;%</span></span>
<span id="cb21-10"><a href="#cb21-10"></a>  <span class="fu">group_by</span>(site_name, time_of_day) <span class="sc">%&gt;%</span></span>
<span id="cb21-11"><a href="#cb21-11"></a>  <span class="fu">summarise</span>(</span>
<span id="cb21-12"><a href="#cb21-12"></a>    <span class="at">n =</span> <span class="fu">n</span>(), <span class="at">mean_count =</span> <span class="fu">mean</span>(counter_value),</span>
<span id="cb21-13"><a href="#cb21-13"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb21-14"><a href="#cb21-14"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb21-15"><a href="#cb21-15"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time_of_day, <span class="at">y =</span> mean_count)) <span class="sc">+</span></span>
<span id="cb21-16"><a href="#cb21-16"></a>  <span class="fu">geom_area</span>(<span class="fu">aes</span>(<span class="at">fill =</span> site_name), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb21-17"><a href="#cb21-17"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">as.POSIXct</span>(<span class="st">"2022-04-22 08:00:01"</span>, <span class="at">tz =</span> <span class="st">"UTC"</span>),</span>
<span id="cb21-18"><a href="#cb21-18"></a>             <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb21-19"><a href="#cb21-19"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">as.POSIXct</span>(<span class="st">"2022-04-22 16:00:01"</span>, <span class="at">tz =</span> <span class="st">"UTC"</span>),</span>
<span id="cb21-20"><a href="#cb21-20"></a>             <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb21-21"><a href="#cb21-21"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> site_name, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb21-22"><a href="#cb21-22"></a>  <span class="fu">scale_x_datetime</span>(<span class="at">date_breaks =</span> <span class="st">"2 hours"</span>, <span class="at">date_labels =</span> <span class="st">"%H"</span>) <span class="sc">+</span></span>
<span id="cb21-23"><a href="#cb21-23"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>))) <span class="sc">+</span></span>
<span id="cb21-24"><a href="#cb21-24"></a>  dunnr<span class="sc">::</span><span class="fu">theme_td</span>(<span class="at">base_size =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb21-25"><a href="#cb21-25"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb21-26"><a href="#cb21-26"></a>  dunnr<span class="sc">::</span><span class="fu">add_facet_borders</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img data-src="hfx-bike-ridership_files/figure-revealjs/unnamed-chunk-20-1.png" width="1920"></p>
</div>
</div>
<aside class="notes">
<ul>
<li>If they were in UTC time, the peaks would correspond to 11AM and 8PM locally, which would be odd times for peak cyclists.</li>
<li>If not Atlantic time (GMT-4), then the next</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="exploring-the-bike-data-7" class="slide level2">
<h2>Exploring the bike data</h2>
<ul>
<li>4 of the sites have northbound and southbound channels, how do they differ?</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>d <span class="ot">&lt;-</span> bike_data_tod <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>  <span class="co"># Remove Hollis St, which does not have different channels</span></span>
<span id="cb22-3"><a href="#cb22-3"></a>  <span class="fu">filter</span>(site_name <span class="sc">!=</span> <span class="st">"Hollis St"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-4"><a href="#cb22-4"></a>  <span class="fu">mutate</span>(<span class="at">channel_direction =</span> <span class="fu">str_extract</span>(channel_name, <span class="st">"(North|South)bound"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb22-5"><a href="#cb22-5"></a>  <span class="fu">group_by</span>(site_name, channel_direction, time_of_day) <span class="sc">%&gt;%</span></span>
<span id="cb22-6"><a href="#cb22-6"></a>  <span class="fu">summarise</span>(<span class="at">mean_count =</span> <span class="fu">mean</span>(counter_value), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb22-7"><a href="#cb22-7"></a>p <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span></span>
<span id="cb22-8"><a href="#cb22-8"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time_of_day, <span class="at">y =</span> mean_count, <span class="at">color =</span> channel_direction)) <span class="sc">+</span></span>
<span id="cb22-9"><a href="#cb22-9"></a>  <span class="fu">geom_area</span>(<span class="fu">aes</span>(<span class="at">fill =</span> channel_direction),</span>
<span id="cb22-10"><a href="#cb22-10"></a>            <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="dv">0</span>),</span>
<span id="cb22-11"><a href="#cb22-11"></a>            <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb22-12"><a href="#cb22-12"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">as.POSIXct</span>(<span class="st">"2022-04-22 08:00:01"</span>, <span class="at">tz =</span> <span class="st">"UTC"</span>),</span>
<span id="cb22-13"><a href="#cb22-13"></a>             <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb22-14"><a href="#cb22-14"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">as.POSIXct</span>(<span class="st">"2022-04-22 16:00:01"</span>, <span class="at">tz =</span> <span class="st">"UTC"</span>),</span>
<span id="cb22-15"><a href="#cb22-15"></a>             <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb22-16"><a href="#cb22-16"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb22-17"><a href="#cb22-17"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> site_name, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb22-18"><a href="#cb22-18"></a>  <span class="fu">scale_x_datetime</span>(<span class="at">date_breaks =</span> <span class="st">"2 hours"</span>, <span class="at">date_labels =</span> <span class="st">"%H"</span>) <span class="sc">+</span></span>
<span id="cb22-19"><a href="#cb22-19"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_pretty</span>(<span class="at">n =</span> <span class="dv">3</span>),</span>
<span id="cb22-20"><a href="#cb22-20"></a>                     <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>))) <span class="sc">+</span></span>
<span id="cb22-21"><a href="#cb22-21"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb22-22"><a href="#cb22-22"></a>  dunnr<span class="sc">::</span><span class="fu">add_facet_borders</span>()</span>
<span id="cb22-23"><a href="#cb22-23"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="hfx-bike-ridership_files/figure-revealjs/unnamed-chunk-21-1.png" width="960" class="r-stretch"></section>
<section id="exploring-the-bike-data-8" class="slide level2">
<h2>Exploring the bike data</h2>
<ul>
<li>4 of the sites have northbound and southbound channels, how do they differ?</li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>(p <span class="sc">%+%</span> <span class="fu">filter</span>(d, site_name <span class="sc">==</span> <span class="st">"Vernon St"</span>)) <span class="sc">+</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>  <span class="fu">theme_td</span>(<span class="at">base_size =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb23-3"><a href="#cb23-3"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img data-src="hfx-bike-ridership_files/figure-revealjs/unnamed-chunk-22-1.png" width="960"></p>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="fu">ggmap</span>(halifax_map) <span class="sc">+</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">filter</span>(site_locs, site_name <span class="sc">==</span> <span class="st">"Vernon St"</span>), <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb24-3"><a href="#cb24-3"></a>             <span class="fu">aes</span>(<span class="at">fill =</span> site_name), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb24-4"><a href="#cb24-4"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_label_repel</span>(</span>
<span id="cb24-5"><a href="#cb24-5"></a>    <span class="at">data =</span> <span class="fu">filter</span>(site_locs, site_name <span class="sc">==</span> <span class="st">"Vernon St"</span>),</span>
<span id="cb24-6"><a href="#cb24-6"></a>    <span class="fu">aes</span>(<span class="at">color =</span> site_name, <span class="at">label =</span> site_name),</span>
<span id="cb24-7"><a href="#cb24-7"></a>    <span class="at">box.padding =</span> <span class="fl">1.0</span>, <span class="at">size =</span> <span class="dv">8</span></span>
<span id="cb24-8"><a href="#cb24-8"></a>  ) <span class="sc">+</span></span>
<span id="cb24-9"><a href="#cb24-9"></a>  <span class="fu">theme_void</span>(<span class="at">base_family =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb24-10"><a href="#cb24-10"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb24-11"><a href="#cb24-11"></a>  <span class="fu">ylim</span>(<span class="fl">44.63</span>, <span class="fl">44.645</span>) <span class="sc">+</span></span>
<span id="cb24-12"><a href="#cb24-12"></a>  <span class="fu">xlim</span>(<span class="sc">-</span><span class="fl">63.605</span>, <span class="sc">-</span><span class="fl">63.575</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img data-src="hfx-bike-ridership_files/figure-revealjs/unnamed-chunk-23-1.png" width="960"></p>
</div>
</div>
</div>
</div>
</section>
<section id="exploring-the-bike-data-9" class="slide level2">
<h2>Exploring the bike data</h2>
<ul>
<li>Visualizing the daily totals</li>
</ul>
<div class="cell">

</div>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>p <span class="ot">&lt;-</span> bike_data_daily_counts <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> count_date, <span class="at">y =</span> n_bikes)) <span class="sc">+</span></span>
<span id="cb25-3"><a href="#cb25-3"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> site_name), <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb25-4"><a href="#cb25-4"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> site_name, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb25-5"><a href="#cb25-5"></a>  dunnr<span class="sc">::</span><span class="fu">add_facet_borders</span>()</span>
<span id="cb25-6"><a href="#cb25-6"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="hfx-bike-ridership_files/figure-revealjs/unnamed-chunk-25-1.png" width="960" class="r-stretch quarto-figure-center"><div class="cell">

</div>
</section>
<section id="exploring-the-bike-data-10" class="slide level2">
<h2>Exploring the bike data</h2>
<ul>
<li>First observation: a series of zeroes</li>
</ul>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>p_thick <span class="sc">%+%</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>  <span class="fu">filter</span>(bike_data_daily_counts,</span>
<span id="cb26-3"><a href="#cb26-3"></a>         site_name <span class="sc">==</span> <span class="st">"South Park St"</span>, count_date <span class="sc">&lt;</span> <span class="st">"2020-01-01"</span>) <span class="sc">+</span></span>
<span id="cb26-4"><a href="#cb26-4"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="st">"#709b81"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="hfx-bike-ridership_files/figure-revealjs/unnamed-chunk-27-1.png" width="960" class="r-stretch quarto-figure-center"><div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>bike_data_daily_counts <span class="ot">&lt;-</span> bike_data_daily_counts <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>  <span class="fu">filter</span>(<span class="sc">!</span>((site_name <span class="sc">==</span> <span class="st">"South Park St"</span>) <span class="sc">&amp;</span> (count_date <span class="sc">&lt;</span> <span class="st">"2019-11-23"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="exploring-the-bike-data-11" class="slide level2">
<h2>Exploring the bike data</h2>
<ul>
<li>Second observation: a big year-to-year increase on South Park St</li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>p <span class="sc">%+%</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>  <span class="fu">filter</span>(bike_data_daily_counts, site_name <span class="sc">==</span> <span class="st">"South Park St"</span>) <span class="sc">+</span></span>
<span id="cb28-3"><a href="#cb28-3"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="st">"#709b81"</span>) <span class="sc">+</span></span>
<span id="cb28-4"><a href="#cb28-4"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">as.Date</span>(<span class="st">"2020-09-20"</span>), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb28-5"><a href="#cb28-5"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">as.Date</span>(<span class="st">"2020-12-20"</span>), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb28-6"><a href="#cb28-6"></a>  <span class="fu">theme_td</span>(<span class="at">base_size =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img data-src="hfx-bike-ridership_files/figure-revealjs/unnamed-chunk-29-1.png" width="960"></p>
</div>
</div>
</div><div class="column fragment" style="width:50%;">
<p><img data-src="images/south-park-lane.PNG"></p>
</div>
</div>
<aside class="notes">
<ul>
<li>Construction started in September, and ended in December</li>
<li>Of note: this shows the effect of the pandemic</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="exploring-the-bike-data-12" class="slide level2">
<h2>Exploring the bike data</h2>
<ul>
<li>Third observation: a large spike in February 2022</li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>p_thick <span class="sc">%+%</span></span>
<span id="cb29-2"><a href="#cb29-2"></a>  <span class="fu">filter</span>(bike_data_daily_counts,</span>
<span id="cb29-3"><a href="#cb29-3"></a>         count_date <span class="sc">&gt;=</span> <span class="st">"2022-02-01"</span>, count_date <span class="sc">&lt;</span> <span class="st">"2022-03-01"</span>) <span class="sc">+</span></span>
<span id="cb29-4"><a href="#cb29-4"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">as.Date</span>(<span class="st">"2022-02-12"</span>), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb29-5"><a href="#cb29-5"></a>  <span class="fu">theme_td</span>(<span class="at">base_size =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb29-6"><a href="#cb29-6"></a>  dunnr<span class="sc">::</span><span class="fu">add_facet_borders</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img data-src="hfx-bike-ridership_files/figure-revealjs/unnamed-chunk-30-1.png" width="960"></p>
</div>
</div>
</div><div class="column fragment" style="width:50%;">
<p><img data-src="images/convoy-article.PNG"></p>
</div>
</div>
</section>
<section id="exploring-the-bike-data-13" class="slide level2">
<h2>Exploring the bike data</h2>
<ul>
<li>Overlay years to see seasonality</li>
</ul>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>bike_data_daily_counts <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>  <span class="fu">mutate</span>(<span class="at">count_year =</span> <span class="fu">year</span>(count_date),</span>
<span id="cb30-3"><a href="#cb30-3"></a>         <span class="co"># Replace year with 1970 so I can plot on the same scale</span></span>
<span id="cb30-4"><a href="#cb30-4"></a>         <span class="at">count_date =</span> <span class="fu">as.Date</span>(<span class="fu">yday</span>(count_date), <span class="at">origin =</span> <span class="st">"1970-01-01"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb30-5"><a href="#cb30-5"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> count_date, <span class="at">y =</span> n_bikes, <span class="at">color =</span> <span class="fu">factor</span>(count_year))) <span class="sc">+</span></span>
<span id="cb30-6"><a href="#cb30-6"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb30-7"><a href="#cb30-7"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">formula =</span> <span class="st">"y ~ x"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb30-8"><a href="#cb30-8"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> site_name, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb30-9"><a href="#cb30-9"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_labels =</span> <span class="st">"%B"</span>) <span class="sc">+</span></span>
<span id="cb30-10"><a href="#cb30-10"></a>  dunnr<span class="sc">::</span><span class="fu">add_facet_borders</span>() <span class="sc">+</span></span>
<span id="cb30-11"><a href="#cb30-11"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="st">"Year"</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">by =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb30-12"><a href="#cb30-12"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb30-13"><a href="#cb30-13"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">color =</span> <span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb30-14"><a href="#cb30-14"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="hfx-bike-ridership_files/figure-revealjs/unnamed-chunk-31-1.png" width="960" class="r-stretch quarto-figure-center"></section>
<section id="exploring-the-bike-data-14" class="slide level2">
<h2>Exploring the bike data</h2>
<ul>
<li>How about day of week?</li>
</ul>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>bike_data_daily_counts <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2"></a>  <span class="fu">mutate</span>(<span class="at">day_of_week =</span> lubridate<span class="sc">::</span><span class="fu">wday</span>(count_date, <span class="at">label =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> day_of_week, <span class="at">x =</span> n_bikes)) <span class="sc">+</span></span>
<span id="cb31-4"><a href="#cb31-4"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">color =</span> site_name), <span class="at">height =</span> <span class="fl">0.2</span>, <span class="at">width =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb31-5"><a href="#cb31-5"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">"mean"</span>, <span class="at">geom =</span> <span class="st">"point"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb31-6"><a href="#cb31-6"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> <span class="fu">str_trunc</span>(site_name, <span class="dv">30</span>), <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">scales =</span> <span class="st">"free_x"</span>) <span class="sc">+</span></span>
<span id="cb31-7"><a href="#cb31-7"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb31-8"><a href="#cb31-8"></a>  dunnr<span class="sc">::</span><span class="fu">add_facet_borders</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="hfx-bike-ridership_files/figure-revealjs/unnamed-chunk-32-1.png" width="960" class="r-stretch quarto-figure-center"></section>
<section id="exploring-the-bike-data-15" class="slide level2">
<h2>Exploring the bike data</h2>
<ul>
<li>How about holidays?</li>
</ul>
<div class="cell columns column-output-location">
<div class="column">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r code-overflow-wrap number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="fu">library</span>(timeDate)</span>
<span id="cb32-2"><a href="#cb32-2"></a></span>
<span id="cb32-3"><a href="#cb32-3"></a>canada_holidays <span class="ot">&lt;-</span></span>
<span id="cb32-4"><a href="#cb32-4"></a>  <span class="fu">listHolidays</span>(</span>
<span id="cb32-5"><a href="#cb32-5"></a>    <span class="at">pattern =</span> <span class="st">"^CA|^Christmas|^NewYears|Easter[Sun|Mon]|^GoodFriday|^CaRem"</span></span>
<span id="cb32-6"><a href="#cb32-6"></a>  )</span>
<span id="cb32-7"><a href="#cb32-7"></a>canada_holidays</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output cell-output-stdout">
<pre><code> [1] "CACanadaDay"              "CACivicProvincialHoliday"
 [3] "CALabourDay"              "CaRemembranceDay"        
 [5] "CAThanksgivingDay"        "CAVictoriaDay"           
 [7] "ChristmasDay"             "ChristmasEve"            
 [9] "EasterMonday"             "EasterSunday"            
[11] "GoodFriday"               "NewYearsDay"             </code></pre>
</div>
</div>
</div>
<div class="fragment">
<div class="cell columns column-output-location">
<div class="column">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>canada_holiday_dates <span class="ot">&lt;-</span></span>
<span id="cb34-2"><a href="#cb34-2"></a>  <span class="fu">tibble</span>(<span class="at">holiday =</span> canada_holidays) <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3"></a>  <span class="fu">crossing</span>(<span class="at">year =</span> <span class="dv">2019</span><span class="sc">:</span><span class="dv">2022</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-4"><a href="#cb34-4"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-5"><a href="#cb34-5"></a>    <span class="at">holiday_date =</span> <span class="fu">map2</span>(</span>
<span id="cb34-6"><a href="#cb34-6"></a>      year, holiday,</span>
<span id="cb34-7"><a href="#cb34-7"></a>      <span class="sc">~</span> <span class="fu">as.Date</span>(<span class="fu">holiday</span>(.x, .y)<span class="sc">@</span>Data)</span>
<span id="cb34-8"><a href="#cb34-8"></a>    )</span>
<span id="cb34-9"><a href="#cb34-9"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb34-10"><a href="#cb34-10"></a>  <span class="fu">unnest</span>(holiday_date) <span class="sc">%&gt;%</span></span>
<span id="cb34-11"><a href="#cb34-11"></a>  <span class="fu">arrange</span>(holiday_date)</span>
<span id="cb34-12"><a href="#cb34-12"></a></span>
<span id="cb34-13"><a href="#cb34-13"></a><span class="fu">head</span>(canada_holiday_dates)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output-display">
<div class="kable-table">

<table>
<thead>
<tr>
<th style="text-align:left;">
holiday
</th>
<th style="text-align:right;">
year
</th>
<th style="text-align:left;">
holiday_date
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
NewYearsDay
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:left;">
2019-01-01
</td>
</tr>
<tr>
<td style="text-align:left;">
GoodFriday
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:left;">
2019-04-19
</td>
</tr>
<tr>
<td style="text-align:left;">
EasterSunday
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:left;">
2019-04-21
</td>
</tr>
<tr>
<td style="text-align:left;">
EasterMonday
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:left;">
2019-04-22
</td>
</tr>
<tr>
<td style="text-align:left;">
CAVictoriaDay
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:left;">
2019-05-20
</td>
</tr>
<tr>
<td style="text-align:left;">
CACanadaDay
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:left;">
2019-07-01
</td>
</tr>
</tbody>

</table>
</div>
</div>
</div>
</div>
<aside class="notes">
<ul>
<li>Civic provincial holiday is called Natal day in Nova Scotia. Actually just passed, first Monday of August.</li>
<li>Not a stat holiday, but a day off for many employees across Canada.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div>
</section>
<section id="exploring-the-bike-data-16" class="slide level2">
<h2>Exploring the bike data</h2>
<ul>
<li>Is there a holiday effect?</li>
</ul>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>canada_holiday_dates <span class="sc">%&gt;%</span></span>
<span id="cb35-2"><a href="#cb35-2"></a>  <span class="fu">filter</span>(holiday_date <span class="sc">%in%</span> <span class="fu">unique</span>(bike_data_daily_counts<span class="sc">$</span>count_date)) <span class="sc">%&gt;%</span></span>
<span id="cb35-3"><a href="#cb35-3"></a>  <span class="fu">mutate</span>(</span>
<span id="cb35-4"><a href="#cb35-4"></a>    <span class="at">date_window =</span> <span class="fu">map</span>(holiday_date, <span class="sc">~</span> <span class="fu">seq.Date</span>(.x <span class="sc">-</span> <span class="dv">14</span>, .x <span class="sc">+</span> <span class="dv">14</span>, <span class="at">by =</span> <span class="st">"1 day"</span>))</span>
<span id="cb35-5"><a href="#cb35-5"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb35-6"><a href="#cb35-6"></a>  <span class="fu">unnest</span>(date_window) <span class="sc">%&gt;%</span></span>
<span id="cb35-7"><a href="#cb35-7"></a>  <span class="fu">left_join</span>(</span>
<span id="cb35-8"><a href="#cb35-8"></a>    bike_data_daily_counts, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"date_window"</span> <span class="ot">=</span> <span class="st">"count_date"</span>)</span>
<span id="cb35-9"><a href="#cb35-9"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb35-10"><a href="#cb35-10"></a>  <span class="fu">mutate</span>(<span class="at">is_holiday =</span> holiday_date <span class="sc">==</span> date_window) <span class="sc">%&gt;%</span></span>
<span id="cb35-11"><a href="#cb35-11"></a>  <span class="fu">group_by</span>(holiday) <span class="sc">%&gt;%</span></span>
<span id="cb35-12"><a href="#cb35-12"></a>  <span class="fu">mutate</span>(<span class="at">day_from_holiday =</span> <span class="fu">as.numeric</span>(date_window <span class="sc">-</span> holiday_date)) <span class="sc">%&gt;%</span></span>
<span id="cb35-13"><a href="#cb35-13"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb35-14"><a href="#cb35-14"></a>  <span class="fu">filter</span>(site_name <span class="sc">==</span> <span class="st">"South Park St"</span>,</span>
<span id="cb35-15"><a href="#cb35-15"></a>         <span class="fu">str_detect</span>(holiday, <span class="st">"Provincial|EasterSunday|ChristmasDay"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb35-16"><a href="#cb35-16"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> day_from_holiday, <span class="at">y =</span> n_bikes,</span>
<span id="cb35-17"><a href="#cb35-17"></a>             <span class="at">group =</span> <span class="fu">factor</span>(year))) <span class="sc">+</span></span>
<span id="cb35-18"><a href="#cb35-18"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb35-19"><a href="#cb35-19"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(year)), <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb35-20"><a href="#cb35-20"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(year)), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb35-21"><a href="#cb35-21"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> holiday, <span class="at">scales =</span> <span class="st">"free_y"</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb35-22"><a href="#cb35-22"></a>  <span class="fu">theme_td</span>(<span class="at">base_size =</span> <span class="dv">24</span>) <span class="sc">+</span></span>
<span id="cb35-23"><a href="#cb35-23"></a>  dunnr<span class="sc">::</span><span class="fu">add_facet_borders</span>() <span class="sc">+</span></span>
<span id="cb35-24"><a href="#cb35-24"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb35-25"><a href="#cb35-25"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"lightgrey"</span>)) <span class="sc">+</span></span>
<span id="cb35-26"><a href="#cb35-26"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">14</span>, <span class="sc">-</span><span class="dv">7</span>, <span class="dv">0</span>, <span class="dv">7</span>, <span class="dv">14</span>)) <span class="sc">+</span></span>
<span id="cb35-27"><a href="#cb35-27"></a>  <span class="fu">scale_color_brewer</span>(<span class="st">"Year"</span>, <span class="at">palette =</span> <span class="st">"Set1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="hfx-bike-ridership_files/figure-revealjs/unnamed-chunk-35-1.png" width="1536"></p>
</figure>
</div>
</div>
</div>
<aside class="notes">
<ul>
<li>Only showing South Park St (3 years of data) and only 3 out of 12 holidays</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="exploring-the-bike-data-17" class="slide level2">
<h2>Exploring the bike data</h2>
<ul>
<li>Investigate the autocorrelation</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>bike_lag <span class="ot">&lt;-</span> bike_data_daily_counts <span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="#cb36-2"></a>  <span class="fu">arrange</span>(site_name, count_date) <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="#cb36-3"></a>  <span class="fu">group_by</span>(site_name) <span class="sc">%&gt;%</span></span>
<span id="cb36-4"><a href="#cb36-4"></a>  <span class="fu">mutate</span>(</span>
<span id="cb36-5"><a href="#cb36-5"></a>    <span class="at">n_bikes_lag_1 =</span> <span class="fu">lag</span>(n_bikes, <span class="dv">1</span>),</span>
<span id="cb36-6"><a href="#cb36-6"></a>    <span class="at">n_bikes_lag_2 =</span> <span class="fu">lag</span>(n_bikes, <span class="dv">2</span>),</span>
<span id="cb36-7"><a href="#cb36-7"></a>    <span class="at">n_bikes_lag_3 =</span> <span class="fu">lag</span>(n_bikes, <span class="dv">3</span>),</span>
<span id="cb36-8"><a href="#cb36-8"></a>    <span class="at">n_bikes_lag_7 =</span> <span class="fu">lag</span>(n_bikes, <span class="dv">7</span>),</span>
<span id="cb36-9"><a href="#cb36-9"></a>    <span class="at">n_bikes_lag_14 =</span> <span class="fu">lag</span>(n_bikes, <span class="dv">14</span>)</span>
<span id="cb36-10"><a href="#cb36-10"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb36-11"><a href="#cb36-11"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb36-12"><a href="#cb36-12"></a>  <span class="fu">select</span>(site_name, count_date, <span class="fu">starts_with</span>(<span class="st">"n_bikes"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb36-13"><a href="#cb36-13"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">matches</span>(<span class="st">"n_bikes_lag"</span>),</span>
<span id="cb36-14"><a href="#cb36-14"></a>               <span class="at">names_to =</span> <span class="st">"lag_days"</span>, <span class="at">values_to =</span> <span class="st">"n_bikes_lag"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-15"><a href="#cb36-15"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(n_bikes_lag)) <span class="sc">%&gt;%</span></span>
<span id="cb36-16"><a href="#cb36-16"></a>  <span class="fu">mutate</span>(</span>
<span id="cb36-17"><a href="#cb36-17"></a>    <span class="at">lag_days =</span> <span class="fu">str_extract</span>(lag_days, <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>(),</span>
<span id="cb36-18"><a href="#cb36-18"></a>    <span class="at">lag_label =</span> <span class="fu">if_else</span>(lag_days <span class="sc">==</span> <span class="dv">1</span>, <span class="fu">paste0</span>(lag_days, <span class="st">" day"</span>),</span>
<span id="cb36-19"><a href="#cb36-19"></a>                        <span class="fu">paste0</span>(lag_days, <span class="st">" days"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb36-20"><a href="#cb36-20"></a>      <span class="fu">fct_reorder</span>(lag_days)</span>
<span id="cb36-21"><a href="#cb36-21"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb36-22"><a href="#cb36-22"></a>  <span class="fu">group_by</span>(site_name, lag_days, lag_label) <span class="sc">%&gt;%</span></span>
<span id="cb36-23"><a href="#cb36-23"></a>  <span class="fu">mutate</span>(<span class="at">corr_coef =</span> <span class="fu">cor</span>(n_bikes, n_bikes_lag)) <span class="sc">%&gt;%</span></span>
<span id="cb36-24"><a href="#cb36-24"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb36-25"><a href="#cb36-25"></a></span>
<span id="cb36-26"><a href="#cb36-26"></a>sites_pal <span class="ot">&lt;-</span> <span class="fu">setNames</span>(td_colors<span class="sc">$</span>pastel6, <span class="fu">unique</span>(bike_lag<span class="sc">$</span>site_name))</span>
<span id="cb36-27"><a href="#cb36-27"></a></span>
<span id="cb36-28"><a href="#cb36-28"></a>p <span class="ot">&lt;-</span> bike_lag <span class="sc">%&gt;%</span></span>
<span id="cb36-29"><a href="#cb36-29"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> n_bikes_lag, <span class="at">y =</span> n_bikes, <span class="at">color =</span> site_name)) <span class="sc">+</span></span>
<span id="cb36-30"><a href="#cb36-30"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb36-31"><a href="#cb36-31"></a>  <span class="fu">geom_label</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(lag_label, site_name, corr_coef),</span>
<span id="cb36-32"><a href="#cb36-32"></a>             <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(corr_coef, <span class="dv">2</span>), <span class="at">x =</span> <span class="dv">500</span>, <span class="at">y =</span> <span class="dv">200</span>, <span class="at">size =</span> <span class="dv">15</span>)) <span class="sc">+</span></span>
<span id="cb36-33"><a href="#cb36-33"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb36-34"><a href="#cb36-34"></a>  <span class="fu">facet_grid</span>(<span class="fu">str_trunc</span>(site_name, <span class="dv">20</span>) <span class="sc">~</span> <span class="fu">factor</span>(lag_label)) <span class="sc">+</span></span>
<span id="cb36-35"><a href="#cb36-35"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> sites_pal) <span class="sc">+</span></span>
<span id="cb36-36"><a href="#cb36-36"></a>  <span class="fu">theme_td</span>(<span class="at">base_size =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb36-37"><a href="#cb36-37"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb36-38"><a href="#cb36-38"></a>  dunnr<span class="sc">::</span><span class="fu">add_facet_borders</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>

<img data-src="hfx-bike-ridership_files/figure-revealjs/unnamed-chunk-37-1.png" width="960" class="r-stretch quarto-figure-center"></section>
<section id="exploring-the-bike-data-18" class="slide level2">
<h2>Exploring the bike data</h2>
<ul>
<li>Investigate the autocorrelation</li>
</ul>

<img data-src="hfx-bike-ridership_files/figure-revealjs/unnamed-chunk-38-1.png" width="960" class="r-stretch quarto-figure-center"></section>
<section id="exploring-the-bike-data-19" class="slide level2">
<h2>Exploring the bike data</h2>
<ul>
<li>Investigate the autocorrelation</li>
</ul>

<img data-src="hfx-bike-ridership_files/figure-revealjs/unnamed-chunk-39-1.png" width="960" class="r-stretch quarto-figure-center"></section></section>
<section>
<section id="getting-the-weather-data" class="title-slide slide level1 center">
<h1>Getting the weather data</h1>

</section>
<section id="getting-the-weather-data-1" class="slide level2">
<h2>Getting the weather data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>base_url <span class="ot">&lt;-</span> <span class="st">"https://api.weather.gc.ca/"</span></span>
<span id="cb37-2"><a href="#cb37-2"></a>resp <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">GET</span>(</span>
<span id="cb37-3"><a href="#cb37-3"></a>  <span class="fu">paste0</span>(base_url,</span>
<span id="cb37-4"><a href="#cb37-4"></a>         <span class="st">"collections/climate-stations/items?f=json&amp;limit=10000"</span>)</span>
<span id="cb37-5"><a href="#cb37-5"></a>)</span>
<span id="cb37-6"><a href="#cb37-6"></a>resp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Response [https://api.weather.gc.ca/collections/climate-stations/items?f=json&amp;limit=10000]
  Date: 2022-04-27 03:27
  Status: 200
  Content-Type: application/json
  Size: 9.13 MB</code></pre>
</div>
</div>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a>content_parsed <span class="ot">&lt;-</span> <span class="fu">content</span>(resp, <span class="at">as =</span> <span class="st">"parsed"</span>)</span>
<span id="cb39-2"><a href="#cb39-2"></a><span class="fu">str</span>(content_parsed, <span class="at">max.level =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 6
 $ type          : chr "FeatureCollection"
 $ features      :List of 8552
 $ numberMatched : int 8552
 $ numberReturned: int 8552
 $ links         :List of 4
 $ timeStamp     : chr "2022-04-27T03:27:27.265491Z"</code></pre>
</div>
</div>
</div>
</section>
<section id="getting-the-weather-data-2" class="slide level2">
<h2>Getting the weather data</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>climate_stations <span class="ot">&lt;-</span> content_parsed<span class="sc">$</span>features</span>
<span id="cb41-2"><a href="#cb41-2"></a></span>
<span id="cb41-3"><a href="#cb41-3"></a>climate_stations <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(</span>
<span id="cb41-4"><a href="#cb41-4"></a>  climate_stations,</span>
<span id="cb41-5"><a href="#cb41-5"></a>  <span class="sc">~</span> <span class="fu">discard</span>(.x<span class="sc">$</span>properties, is.null) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb41-6"><a href="#cb41-6"></a>    <span class="fu">mutate</span>(<span class="at">lat =</span> .x<span class="sc">$</span>geometry<span class="sc">$</span>coordinates[[<span class="dv">2</span>]],</span>
<span id="cb41-7"><a href="#cb41-7"></a>           <span class="at">lon =</span> .x<span class="sc">$</span>geometry<span class="sc">$</span>coordinates[[<span class="dv">1</span>]])</span>
<span id="cb41-8"><a href="#cb41-8"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb41-9"><a href="#cb41-9"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb41-10"><a href="#cb41-10"></a>  <span class="co"># Drop the incorrect latitude and longitude</span></span>
<span id="cb41-11"><a href="#cb41-11"></a>  <span class="fu">select</span>(<span class="sc">-</span>latitude, <span class="sc">-</span>longitude)</span>
<span id="cb41-12"><a href="#cb41-12"></a></span>
<span id="cb41-13"><a href="#cb41-13"></a><span class="fu">glimpse</span>(climate_stations)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 8,552
Columns: 32
$ stn_id                   &lt;int&gt; 8496, 9005, 10205, 6149, 6154, 6174, 6177, 61…
$ station_name             &lt;chr&gt; "CARLETON SUR MER", "PORT COLBORNE (AUT)", "K…
$ prov_state_terr_code     &lt;chr&gt; "QC", "ON", "QC", "NB", "NB", "NB", "NB", "NB…
$ eng_prov_name            &lt;chr&gt; "QUEBEC", "ONTARIO", "QUEBEC", "NEW BRUNSWICK…
$ fre_prov_name            &lt;chr&gt; "QUÉBEC", "ONTARIO", "QUÉBEC", "NOUVEAU-BRUNS…
$ country                  &lt;chr&gt; "CAN", "CAN", "CAN", "CAN", "CAN", "CAN", "CA…
$ timezone                 &lt;chr&gt; "EST", "EST", "EST", "AST", "AST", "AST", "AS…
$ elevation                &lt;chr&gt; "541.00", "183.50", "123.80", "152.40", "173.…
$ climate_identifier       &lt;chr&gt; "705AA86", "613F606", "7113382", "8101178", "…
$ station_type             &lt;chr&gt; "N/A", "Climate-Auto", "N/A", "N/A", "N/A", "…
$ publication_code         &lt;int&gt; 1, NA, NA, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
$ display_code             &lt;int&gt; 9, NA, NA, 7, 9, 5, 9, 7, 7, 9, 9, 8, 9, 9, 1…
$ first_date               &lt;chr&gt; "1968-10-01 00:00:00", "1992-12-02 00:00:00",…
$ last_date                &lt;chr&gt; "1968-10-31 00:00:00", "2022-04-24 12:30:02",…
$ dly_first_date           &lt;chr&gt; "1968-10-01 00:00:00", "1992-12-02 00:00:00",…
$ dly_last_date            &lt;chr&gt; "1968-10-31 00:00:00", "2022-04-24 00:00:00",…
$ has_monthly_summary      &lt;chr&gt; "Y", "Y", "N", "Y", "Y", "Y", "Y", "Y", "Y", …
$ has_normals_data         &lt;chr&gt; "N", "N", "N", "N", "N", "N", "N", "N", "N", …
$ has_hourly_data          &lt;chr&gt; "N", "Y", "Y", "N", "N", "N", "N", "N", "N", …
$ lat                      &lt;dbl&gt; 48.13333, 42.86667, 60.02306, 45.93333, 47.36…
$ lon                      &lt;dbl&gt; -66.11667, -79.25000, -70.00361, -64.78333, -…
$ tc_identifier            &lt;chr&gt; NA, "WPC", "YAS", NA, NA, NA, NA, NA, NA, NA,…
$ wmo_identifier           &lt;chr&gt; NA, "71463", NA, NA, NA, NA, NA, NA, NA, NA, …
$ eng_stn_operator_acronym &lt;chr&gt; NA, "ECCC - MSC", "DND", NA, NA, NA, NA, NA, …
$ fre_stn_operator_acronym &lt;chr&gt; NA, "ECCC - SMC", "MDN", NA, NA, NA, NA, NA, …
$ eng_stn_operator_name    &lt;chr&gt; NA, "Environment and Climate Change Canada - …
$ fre_stn_operator_name    &lt;chr&gt; NA, "Environnement et Changement climatique C…
$ hly_first_date           &lt;chr&gt; NA, "1994-02-01 02:00:00", "1992-10-21 07:00:…
$ hly_last_date            &lt;chr&gt; NA, "2022-04-24 12:30:02", "2015-09-10 13:00:…
$ mly_first_date           &lt;chr&gt; NA, "2006-04-01 00:00:00", NA, "1964-01-01 00…
$ mly_last_date            &lt;chr&gt; NA, "2006-12-01 00:00:00", NA, "1979-12-01 00…
$ normal_code              &lt;chr&gt; NA, NA, NA, "F", NA, "D", NA, "F", "F", NA, N…</code></pre>
</div>
</div>
</section>
<section id="getting-the-weather-data-3" class="slide level2">
<h2>Getting the weather data</h2>
<ul>
<li>Top 5 closest climate stations to the bike counters</li>
</ul>
<div class="cell">

</div>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="fu">ggmap</span>(halifax_map) <span class="sc">+</span></span>
<span id="cb43-2"><a href="#cb43-2"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> d, <span class="at">size =</span> <span class="dv">8</span>,</span>
<span id="cb43-3"><a href="#cb43-3"></a>             <span class="fu">aes</span>(<span class="at">fill =</span> group), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb43-4"><a href="#cb43-4"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_label_repel</span>(</span>
<span id="cb43-5"><a href="#cb43-5"></a>    <span class="at">data =</span> d,</span>
<span id="cb43-6"><a href="#cb43-6"></a>    <span class="fu">aes</span>(<span class="at">color =</span> group, <span class="at">label =</span> <span class="fu">str_trunc</span>(label, <span class="at">width =</span> <span class="dv">25</span>)),</span>
<span id="cb43-7"><a href="#cb43-7"></a>    <span class="at">box.padding =</span> <span class="fl">1.0</span>, <span class="at">size =</span> <span class="dv">6</span></span>
<span id="cb43-8"><a href="#cb43-8"></a>  ) <span class="sc">+</span></span>
<span id="cb43-9"><a href="#cb43-9"></a>  <span class="fu">theme_void</span>(<span class="at">base_size =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb43-10"><a href="#cb43-10"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img data-src="hfx-bike-ridership_files/figure-revealjs/unnamed-chunk-46-1.png" width="960"></p>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a>climate_stations_halifax <span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href="#cb44-2"></a>  <span class="fu">transmute</span>(station_name, <span class="at">lat =</span> <span class="fu">round</span>(lat, <span class="dv">2</span>), <span class="at">lon =</span> <span class="fu">round</span>(lon, <span class="dv">2</span>),</span>
<span id="cb44-3"><a href="#cb44-3"></a>            <span class="at">first_date =</span> <span class="fu">as.Date</span>(first_date), <span class="at">last_date =</span> <span class="fu">as.Date</span>(last_date)) <span class="sc">%&gt;%</span></span>
<span id="cb44-4"><a href="#cb44-4"></a>  <span class="fu">kable</span>(<span class="st">"html"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb44-5"><a href="#cb44-5"></a>  <span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="dv">35</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<table class="table" style="font-size: 35px; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> station_name </th>
   <th style="text-align:right;"> lat </th>
   <th style="text-align:right;"> lon </th>
   <th style="text-align:left;"> first_date </th>
   <th style="text-align:left;"> last_date </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> HALIFAX CITADEL </td>
   <td style="text-align:right;"> 44.65 </td>
   <td style="text-align:right;"> -63.58 </td>
   <td style="text-align:left;"> 1933-01-01 </td>
   <td style="text-align:left;"> 2002-01-31 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> HALIFAX DOCKYARD </td>
   <td style="text-align:right;"> 44.66 </td>
   <td style="text-align:right;"> -63.58 </td>
   <td style="text-align:left;"> 2004-09-24 </td>
   <td style="text-align:left;"> 2022-04-24 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> HALIFAX </td>
   <td style="text-align:right;"> 44.65 </td>
   <td style="text-align:right;"> -63.57 </td>
   <td style="text-align:left;"> 1939-01-01 </td>
   <td style="text-align:left;"> 1974-12-01 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> HALIFAX </td>
   <td style="text-align:right;"> 44.65 </td>
   <td style="text-align:right;"> -63.60 </td>
   <td style="text-align:left;"> 1871-01-01 </td>
   <td style="text-align:left;"> 1933-12-01 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> DARTMOUTH </td>
   <td style="text-align:right;"> 44.67 </td>
   <td style="text-align:right;"> -63.57 </td>
   <td style="text-align:left;"> 1990-01-01 </td>
   <td style="text-align:left;"> 1991-12-31 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</section>
<section id="getting-the-weather-data-4" class="slide level2">
<h2>Getting the weather data</h2>
<ul>
<li>Top 5 closest climate stations to the bike counters <em>with recent data</em></li>
</ul>
<div class="cell">

</div>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="fu">ggmap</span>(hrm_map) <span class="sc">+</span></span>
<span id="cb45-2"><a href="#cb45-2"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> d, <span class="at">size =</span> <span class="dv">6</span>,</span>
<span id="cb45-3"><a href="#cb45-3"></a>             <span class="fu">aes</span>(<span class="at">fill =</span> group), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb45-4"><a href="#cb45-4"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_label_repel</span>(</span>
<span id="cb45-5"><a href="#cb45-5"></a>    <span class="at">data =</span> <span class="fu">filter</span>(d, group <span class="sc">!=</span> <span class="st">"bike counters"</span>),</span>
<span id="cb45-6"><a href="#cb45-6"></a>    <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">str_trunc</span>(label, <span class="at">width =</span> <span class="dv">25</span>)),</span>
<span id="cb45-7"><a href="#cb45-7"></a>    <span class="at">box.padding =</span> <span class="fl">0.5</span>, <span class="at">force =</span> <span class="dv">15</span>, <span class="at">color =</span> <span class="st">"#779ecb"</span>, <span class="at">size =</span> <span class="dv">8</span></span>
<span id="cb45-8"><a href="#cb45-8"></a>  ) <span class="sc">+</span></span>
<span id="cb45-9"><a href="#cb45-9"></a>  <span class="fu">theme_void</span>(<span class="at">base_size =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb45-10"><a href="#cb45-10"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb45-11"><a href="#cb45-11"></a>  <span class="fu">ylim</span>(<span class="fl">44.58</span>, <span class="fl">44.69</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img data-src="hfx-bike-ridership_files/figure-revealjs/unnamed-chunk-50-1.png" width="960"></p>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a>climate_stations_halifax <span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href="#cb46-2"></a>  <span class="fu">transmute</span>(station_name, <span class="at">lat =</span> <span class="fu">round</span>(lat, <span class="dv">2</span>), <span class="at">lon =</span> <span class="fu">round</span>(lon, <span class="dv">2</span>),</span>
<span id="cb46-3"><a href="#cb46-3"></a>            <span class="at">first_date =</span> <span class="fu">as.Date</span>(first_date), <span class="at">last_date =</span> <span class="fu">as.Date</span>(last_date)) <span class="sc">%&gt;%</span></span>
<span id="cb46-4"><a href="#cb46-4"></a>  <span class="fu">kable</span>(<span class="st">"html"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb46-5"><a href="#cb46-5"></a>  <span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="dv">35</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<table class="table" style="font-size: 35px; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> station_name </th>
   <th style="text-align:right;"> lat </th>
   <th style="text-align:right;"> lon </th>
   <th style="text-align:left;"> first_date </th>
   <th style="text-align:left;"> last_date </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> HALIFAX DOCKYARD </td>
   <td style="text-align:right;"> 44.66 </td>
   <td style="text-align:right;"> -63.58 </td>
   <td style="text-align:left;"> 2004-09-24 </td>
   <td style="text-align:left;"> 2022-04-24 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> HALIFAX WINDSOR PARK </td>
   <td style="text-align:right;"> 44.66 </td>
   <td style="text-align:right;"> -63.61 </td>
   <td style="text-align:left;"> 2004-09-24 </td>
   <td style="text-align:left;"> 2022-04-24 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> SHEARWATER JETTY </td>
   <td style="text-align:right;"> 44.63 </td>
   <td style="text-align:right;"> -63.52 </td>
   <td style="text-align:left;"> 1994-02-01 </td>
   <td style="text-align:left;"> 2022-04-24 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> MCNABS ISLAND (AUT) </td>
   <td style="text-align:right;"> 44.60 </td>
   <td style="text-align:right;"> -63.53 </td>
   <td style="text-align:left;"> 1999-10-13 </td>
   <td style="text-align:left;"> 2022-04-24 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> HALIFAX KOOTENAY </td>
   <td style="text-align:right;"> 44.59 </td>
   <td style="text-align:right;"> -63.55 </td>
   <td style="text-align:left;"> 2004-09-28 </td>
   <td style="text-align:left;"> 2022-04-24 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</section>
<section id="getting-the-weather-data-5" class="slide level2">
<h2>Getting the weather data</h2>
<ul>
<li>Windsor Park will do</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a>resp <span class="ot">&lt;-</span> <span class="fu">GET</span>(</span>
<span id="cb47-2"><a href="#cb47-2"></a>  <span class="fu">paste0</span>(base_url,</span>
<span id="cb47-3"><a href="#cb47-3"></a>         <span class="st">"collections/climate-daily/items?f=json&amp;limit=10000&amp;STATION_NAME="</span>,</span>
<span id="cb47-4"><a href="#cb47-4"></a>         <span class="fu">URLencode</span>(<span class="st">"HALIFAX WINDSOR PARK"</span>))</span>
<span id="cb47-5"><a href="#cb47-5"></a>)</span>
<span id="cb47-6"><a href="#cb47-6"></a></span>
<span id="cb47-7"><a href="#cb47-7"></a>content_parsed <span class="ot">&lt;-</span> <span class="fu">content</span>(resp, <span class="at">as =</span> <span class="st">"parsed"</span>)</span>
<span id="cb47-8"><a href="#cb47-8"></a></span>
<span id="cb47-9"><a href="#cb47-9"></a>weather_data <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(</span>
<span id="cb47-10"><a href="#cb47-10"></a>  content_parsed<span class="sc">$</span>features,</span>
<span id="cb47-11"><a href="#cb47-11"></a>  <span class="sc">~</span> purrr<span class="sc">::</span><span class="fu">discard</span>(.x<span class="sc">$</span>properties, is.null) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb47-12"><a href="#cb47-12"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb47-13"><a href="#cb47-13"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb47-14"><a href="#cb47-14"></a>  <span class="fu">select</span>(<span class="sc">-</span>station_name, <span class="sc">-</span>climate_identifier, <span class="sc">-</span>id, <span class="sc">-</span>province_code) <span class="sc">%&gt;%</span></span>
<span id="cb47-15"><a href="#cb47-15"></a>  <span class="fu">mutate</span>(<span class="at">report_date =</span> <span class="fu">as.POSIXct</span>(local_date) <span class="sc">%&gt;%</span> <span class="fu">as.Date</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb47-16"><a href="#cb47-16"></a>  <span class="fu">select</span>(report_date, mean_temperature, total_precipitation, snow_on_ground,</span>
<span id="cb47-17"><a href="#cb47-17"></a>         speed_max_gust) <span class="sc">%&gt;%</span></span>
<span id="cb47-18"><a href="#cb47-18"></a>  <span class="fu">inner_join</span>(bike_data_daily_counts <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(count_date),</span>
<span id="cb47-19"><a href="#cb47-19"></a>             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"report_date"</span> <span class="ot">=</span> <span class="st">"count_date"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb47-20"><a href="#cb47-20"></a>  <span class="fu">arrange</span>(report_date)</span>
<span id="cb47-21"><a href="#cb47-21"></a></span>
<span id="cb47-22"><a href="#cb47-22"></a><span class="fu">head</span>(weather_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="kable-table">

<table>
<thead>
<tr>
<th style="text-align:left;">
report_date
</th>
<th style="text-align:right;">
mean_temperature
</th>
<th style="text-align:right;">
total_precipitation
</th>
<th style="text-align:right;">
snow_on_ground
</th>
<th style="text-align:right;">
speed_max_gust
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2019-11-23
</td>
<td style="text-align:right;">
1.7
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
50
</td>
</tr>
<tr>
<td style="text-align:left;">
2019-11-24
</td>
<td style="text-align:right;">
4.5
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
58
</td>
</tr>
<tr>
<td style="text-align:left;">
2019-11-25
</td>
<td style="text-align:right;">
6.5
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
56
</td>
</tr>
<tr>
<td style="text-align:left;">
2019-11-26
</td>
<td style="text-align:right;">
5.8
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
35
</td>
</tr>
<tr>
<td style="text-align:left;">
2019-11-27
</td>
<td style="text-align:right;">
6.8
</td>
<td style="text-align:right;">
1.4
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
31
</td>
</tr>
<tr>
<td style="text-align:left;">
2019-11-28
</td>
<td style="text-align:right;">
2.6
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
58
</td>
</tr>
</tbody>

</table>
</div>
</div>
</div>
</section></section>
<section>
<section id="exploring-the-weather-data" class="title-slide slide level1 center">
<h1>Exploring the weather data</h1>

</section>
<section id="exploring-the-weather-data-1" class="slide level2">
<h2>Exploring the weather data</h2>
<ul>
<li>Weather distributions</li>
</ul>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a>weather_pal <span class="ot">&lt;-</span> <span class="fu">setNames</span>(td_colors<span class="sc">$</span>pastel6[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">5</span>)],</span>
<span id="cb48-2"><a href="#cb48-2"></a>                        <span class="fu">c</span>(<span class="st">"mean_temperature"</span>, <span class="st">"snow_on_ground"</span>,</span>
<span id="cb48-3"><a href="#cb48-3"></a>                          <span class="st">"speed_max_gust"</span>, <span class="st">"total_precipitation"</span>))</span>
<span id="cb48-4"><a href="#cb48-4"></a>weather_data <span class="sc">%&gt;%</span></span>
<span id="cb48-5"><a href="#cb48-5"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>report_date) <span class="sc">%&gt;%</span></span>
<span id="cb48-6"><a href="#cb48-6"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb48-7"><a href="#cb48-7"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">fill =</span> name)) <span class="sc">+</span></span>
<span id="cb48-8"><a href="#cb48-8"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb48-9"><a href="#cb48-9"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>))) <span class="sc">+</span></span>
<span id="cb48-10"><a href="#cb48-10"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb48-11"><a href="#cb48-11"></a>  <span class="fu">theme_td</span>(<span class="at">base_size =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb48-12"><a href="#cb48-12"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb48-13"><a href="#cb48-13"></a>  dunnr<span class="sc">::</span><span class="fu">add_facet_borders</span>() <span class="sc">+</span></span>
<span id="cb48-14"><a href="#cb48-14"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> weather_pal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="hfx-bike-ridership_files/figure-revealjs/unnamed-chunk-54-1.png" width="1920"></p>
</figure>
</div>
</div>
</div>
<aside class="notes">
<ul>
<li><code>mean_temperature</code>: Celsius
<ul>
<li>-10 C = 15 F</li>
<li>20 C = 70 F</li>
</ul></li>
<li><code>snow_on_ground</code>: centimeters
<ul>
<li>25 cm = 10 inches</li>
</ul></li>
<li><code>speed_max_gust</code>: km per hour
<ul>
<li>30 kmh = 20 mph</li>
<li>90 kmh = 55 mpg</li>
</ul></li>
<li><code>total_precipitation</code>: millimeters
<ul>
<li>60 mm = 2 inches</li>
</ul></li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="exploring-the-weather-data-2" class="slide level2">
<h2>Exploring the weather data</h2>
<ul>
<li>Visualize the mean temperature</li>
</ul>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a>mean_temperature <span class="ot">&lt;-</span> <span class="fu">mean</span>(weather_data<span class="sc">$</span>mean_temperature, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb49-2"><a href="#cb49-2"></a></span>
<span id="cb49-3"><a href="#cb49-3"></a>weather_data <span class="sc">%&gt;%</span></span>
<span id="cb49-4"><a href="#cb49-4"></a>  <span class="fu">mutate</span>(</span>
<span id="cb49-5"><a href="#cb49-5"></a>    <span class="at">mean_temperature =</span> <span class="fu">replace_na</span>(mean_temperature, <span class="sc">-</span><span class="dv">20</span>),</span>
<span id="cb49-6"><a href="#cb49-6"></a>    <span class="at">var =</span> <span class="st">"mean_temperature"</span></span>
<span id="cb49-7"><a href="#cb49-7"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb49-8"><a href="#cb49-8"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> report_date, <span class="at">y =</span> mean_temperature)) <span class="sc">+</span></span>
<span id="cb49-9"><a href="#cb49-9"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> var), <span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(mean_temperature <span class="sc">&gt;</span> <span class="sc">-</span><span class="dv">20</span>),</span>
<span id="cb49-10"><a href="#cb49-10"></a>            <span class="at">size =</span> <span class="dv">1</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb49-11"><a href="#cb49-11"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> mean_temperature, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb49-12"><a href="#cb49-12"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">color =</span> var), <span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(mean_temperature <span class="sc">==</span> <span class="sc">-</span><span class="dv">20</span>),</span>
<span id="cb49-13"><a href="#cb49-13"></a>              <span class="at">width =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb49-14"><a href="#cb49-14"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(mean_temperature, <span class="sc">-</span><span class="dv">20</span>, <span class="sc">-</span><span class="dv">10</span>, <span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">20</span>),</span>
<span id="cb49-15"><a href="#cb49-15"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"missing"</span>, <span class="sc">-</span><span class="dv">10</span>, <span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb49-16"><a href="#cb49-16"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> weather_pal) <span class="sc">+</span></span>
<span id="cb49-17"><a href="#cb49-17"></a>  <span class="fu">theme_td</span>(<span class="at">base_size =</span> <span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="hfx-bike-ridership_files/figure-revealjs/unnamed-chunk-55-1.png" width="1920"></p>
</figure>
</div>
</div>
</div>
<aside class="notes">
<ul>
<li>14 missing days for temperature (out of 873 = 1.6%)</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="exploring-the-weather-data-3" class="slide level2">
<h2>Exploring the weather data</h2>
<ul>
<li>Visualize the total precipitation</li>
</ul>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a>mean_precip <span class="ot">&lt;-</span> <span class="fu">mean</span>(weather_data<span class="sc">$</span>total_precipitation, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb50-2"><a href="#cb50-2"></a></span>
<span id="cb50-3"><a href="#cb50-3"></a>weather_data <span class="sc">%&gt;%</span></span>
<span id="cb50-4"><a href="#cb50-4"></a>  <span class="fu">mutate</span>(</span>
<span id="cb50-5"><a href="#cb50-5"></a>    <span class="at">total_precipitation =</span> <span class="fu">replace_na</span>(total_precipitation, <span class="sc">-</span><span class="dv">10</span>),</span>
<span id="cb50-6"><a href="#cb50-6"></a>    <span class="at">var =</span> <span class="st">"total_precipitation"</span></span>
<span id="cb50-7"><a href="#cb50-7"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb50-8"><a href="#cb50-8"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> report_date, <span class="at">y =</span> total_precipitation)) <span class="sc">+</span></span>
<span id="cb50-9"><a href="#cb50-9"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> var), <span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(total_precipitation <span class="sc">&gt;</span> <span class="sc">-</span><span class="dv">10</span>),</span>
<span id="cb50-10"><a href="#cb50-10"></a>             <span class="at">size =</span> <span class="dv">3</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb50-11"><a href="#cb50-11"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> mean_precip, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb50-12"><a href="#cb50-12"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">color =</span> var), <span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(total_precipitation <span class="sc">==</span> <span class="sc">-</span><span class="dv">10</span>),</span>
<span id="cb50-13"><a href="#cb50-13"></a>              <span class="at">width =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb50-14"><a href="#cb50-14"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(mean_precip, <span class="sc">-</span><span class="dv">10</span>, <span class="dv">0</span>, <span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">60</span>),</span>
<span id="cb50-15"><a href="#cb50-15"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"missing"</span>, <span class="dv">0</span>, <span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">60</span>)) <span class="sc">+</span></span>
<span id="cb50-16"><a href="#cb50-16"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> weather_pal) <span class="sc">+</span></span>
<span id="cb50-17"><a href="#cb50-17"></a>  <span class="fu">theme_td</span>(<span class="at">base_size =</span> <span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="hfx-bike-ridership_files/figure-revealjs/unnamed-chunk-56-1.png" width="1920"></p>
</figure>
</div>
</div>
</div>
<aside class="notes">
<ul>
<li>395 missing days for temperature (out of 873 = 45%)</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="exploring-the-weather-data-4" class="slide level2">
<h2>Exploring the weather data</h2>
<ul>
<li>Visualize the snowfall</li>
</ul>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a>mean_snow <span class="ot">&lt;-</span> <span class="fu">mean</span>(weather_data<span class="sc">$</span>snow_on_ground, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb51-2"><a href="#cb51-2"></a></span>
<span id="cb51-3"><a href="#cb51-3"></a>weather_data <span class="sc">%&gt;%</span></span>
<span id="cb51-4"><a href="#cb51-4"></a>  <span class="fu">mutate</span>(</span>
<span id="cb51-5"><a href="#cb51-5"></a>    <span class="at">snow_on_ground =</span> <span class="fu">replace_na</span>(snow_on_ground, <span class="sc">-</span><span class="dv">5</span>),</span>
<span id="cb51-6"><a href="#cb51-6"></a>    <span class="at">var =</span> <span class="st">"snow_on_ground"</span></span>
<span id="cb51-7"><a href="#cb51-7"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb51-8"><a href="#cb51-8"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> report_date, <span class="at">y =</span> snow_on_ground)) <span class="sc">+</span></span>
<span id="cb51-9"><a href="#cb51-9"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> var), <span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(snow_on_ground <span class="sc">&gt;</span> <span class="sc">-</span><span class="dv">5</span>),</span>
<span id="cb51-10"><a href="#cb51-10"></a>             <span class="at">size =</span> <span class="dv">3</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb51-11"><a href="#cb51-11"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> mean_snow, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb51-12"><a href="#cb51-12"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">color =</span> var), <span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(snow_on_ground <span class="sc">==</span> <span class="sc">-</span><span class="dv">5</span>),</span>
<span id="cb51-13"><a href="#cb51-13"></a>              <span class="at">width =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb51-14"><a href="#cb51-14"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(mean_snow, <span class="sc">-</span><span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">60</span>),</span>
<span id="cb51-15"><a href="#cb51-15"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"missing"</span>, <span class="dv">0</span>, <span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">60</span>)) <span class="sc">+</span></span>
<span id="cb51-16"><a href="#cb51-16"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> weather_pal) <span class="sc">+</span></span>
<span id="cb51-17"><a href="#cb51-17"></a>  <span class="fu">theme_td</span>(<span class="at">base_size =</span> <span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="hfx-bike-ridership_files/figure-revealjs/unnamed-chunk-57-1.png" width="1920"></p>
</figure>
</div>
</div>
</div>
<aside class="notes">
<ul>
<li>568 missing days for temperature (out of 873 = 65%)</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="exploring-the-weather-data-5" class="slide level2">
<h2>Exploring the weather data</h2>
<ul>
<li>Visualize the wind speed</li>
</ul>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a>mean_wind <span class="ot">&lt;-</span> <span class="fu">mean</span>(weather_data<span class="sc">$</span>speed_max_gust, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb52-2"><a href="#cb52-2"></a></span>
<span id="cb52-3"><a href="#cb52-3"></a>weather_data <span class="sc">%&gt;%</span></span>
<span id="cb52-4"><a href="#cb52-4"></a>  <span class="fu">mutate</span>(</span>
<span id="cb52-5"><a href="#cb52-5"></a>    <span class="at">speed_max_gust =</span> <span class="fu">replace_na</span>(speed_max_gust, <span class="dv">20</span>),</span>
<span id="cb52-6"><a href="#cb52-6"></a>    <span class="at">var =</span> <span class="st">"speed_max_gust"</span></span>
<span id="cb52-7"><a href="#cb52-7"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb52-8"><a href="#cb52-8"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> report_date, <span class="at">y =</span> speed_max_gust)) <span class="sc">+</span></span>
<span id="cb52-9"><a href="#cb52-9"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> var), <span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(speed_max_gust <span class="sc">&gt;</span> <span class="dv">20</span>),</span>
<span id="cb52-10"><a href="#cb52-10"></a>             <span class="at">size =</span> <span class="dv">3</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb52-11"><a href="#cb52-11"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> mean_wind, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb52-12"><a href="#cb52-12"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">color =</span> var), <span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(speed_max_gust <span class="sc">==</span> <span class="dv">20</span>),</span>
<span id="cb52-13"><a href="#cb52-13"></a>              <span class="at">size =</span> <span class="dv">3</span>, <span class="at">width =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb52-14"><a href="#cb52-14"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(mean_wind, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">70</span>),</span>
<span id="cb52-15"><a href="#cb52-15"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"missing"</span>, <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">70</span>)) <span class="sc">+</span></span>
<span id="cb52-16"><a href="#cb52-16"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> weather_pal) <span class="sc">+</span></span>
<span id="cb52-17"><a href="#cb52-17"></a>  <span class="fu">theme_td</span>(<span class="at">base_size =</span> <span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="hfx-bike-ridership_files/figure-revealjs/unnamed-chunk-58-1.png" width="1920"></p>
</figure>
</div>
</div>
</div>
<aside class="notes">
<ul>
<li>334 missing days for temperature (out of 873 = 4%)</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="exploring-the-weather-data-6" class="slide level2">
<h2>Exploring the weather data</h2>
<ul>
<li>Relationship with daily bike counts</li>
</ul>
<div class="cell">

</div>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a>bike_ridership <span class="sc">%&gt;%</span></span>
<span id="cb53-2"><a href="#cb53-2"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb53-3"><a href="#cb53-3"></a>    <span class="at">cols =</span> <span class="fu">c</span>(mean_temperature, total_precipitation,</span>
<span id="cb53-4"><a href="#cb53-4"></a>             speed_max_gust, snow_on_ground),</span>
<span id="cb53-5"><a href="#cb53-5"></a>    <span class="at">names_to =</span> <span class="st">"var"</span>, <span class="at">values_to =</span> <span class="st">"val"</span></span>
<span id="cb53-6"><a href="#cb53-6"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb53-7"><a href="#cb53-7"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(val)) <span class="sc">%&gt;%</span></span>
<span id="cb53-8"><a href="#cb53-8"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> val, <span class="at">y =</span> n_bikes)) <span class="sc">+</span></span>
<span id="cb53-9"><a href="#cb53-9"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">str_trunc</span>(site_name, <span class="dv">25</span>)), <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb53-10"><a href="#cb53-10"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> var, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">scales =</span> <span class="st">"free_x"</span>) <span class="sc">+</span></span>
<span id="cb53-11"><a href="#cb53-11"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">color =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb53-12"><a href="#cb53-12"></a>  <span class="fu">theme_td</span>(<span class="at">base_size =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb53-13"><a href="#cb53-13"></a>  dunnr<span class="sc">::</span><span class="fu">add_facet_borders</span>() <span class="sc">+</span></span>
<span id="cb53-14"><a href="#cb53-14"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="hfx-bike-ridership_files/figure-revealjs/unnamed-chunk-60-1.png" width="1920" class="r-stretch quarto-figure-center"></section></section>
<section>
<section id="modeling" class="title-slide slide level1 center">
<h1>Modeling</h1>

</section>
<section id="features" class="slide level2">
<h2>Features</h2>
<p>To predict daily count of bicyclists:</p>
<ul>
<li>Site: 5 locations around Halifax</li>
<li>Lagged counts: counts from 14 days ago</li>
</ul>
<div class="fragment">
<ul>
<li>Time variables
<ul>
<li>day of the week: Monday, Tuesday, …</li>
<li>day of the year: 1-365</li>
<li>year: 2020-2022</li>
<li>holidays: New Years, Canada Day, etc.</li>
</ul></li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Weather variables
<ul>
<li>mean temperature: rolling window imputation</li>
<li>total precipitation: imputed with 0</li>
<li>total snowfall: imputed with 0</li>
<li>maximum wind speed: imputed with mean</li>
</ul></li>
</ul>
<div class="cell">

</div>
</div>
</section>
<section id="traintest-split" class="slide level2">
<h2>Train/test split</h2>
<ul>
<li>70/30 split</li>
</ul>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a>bike_split <span class="ot">&lt;-</span> <span class="fu">initial_time_split</span>(bike_ridership, <span class="at">prop =</span> <span class="fl">0.7</span>)</span>
<span id="cb54-2"><a href="#cb54-2"></a></span>
<span id="cb54-3"><a href="#cb54-3"></a>bike_train <span class="ot">&lt;-</span> <span class="fu">training</span>(bike_split)</span>
<span id="cb54-4"><a href="#cb54-4"></a>bike_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(bike_split)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb55-2"><a href="#cb55-2"></a>  <span class="at">train =</span> bike_train, <span class="at">test =</span> bike_test, <span class="at">.id =</span> <span class="st">"data_set"</span></span>
<span id="cb55-3"><a href="#cb55-3"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb55-4"><a href="#cb55-4"></a>  <span class="fu">group_by</span>(data_set, site_name) <span class="sc">%&gt;%</span></span>
<span id="cb55-5"><a href="#cb55-5"></a>  <span class="fu">summarise</span>(</span>
<span id="cb55-6"><a href="#cb55-6"></a>    <span class="at">min_date =</span> <span class="fu">min</span>(count_date), <span class="at">max_date =</span> <span class="fu">max</span>(count_date),</span>
<span id="cb55-7"><a href="#cb55-7"></a>    <span class="at">n_days =</span> <span class="fu">n</span>(), <span class="at">midpoint_date =</span> min_date <span class="sc">+</span> n_days <span class="sc">/</span> <span class="dv">2</span>,</span>
<span id="cb55-8"><a href="#cb55-8"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb55-9"><a href="#cb55-9"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb55-10"><a href="#cb55-10"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">fct_reorder</span>(site_name, min_date), <span class="at">color =</span> data_set)) <span class="sc">+</span></span>
<span id="cb55-11"><a href="#cb55-11"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> min_date, <span class="at">xmax =</span> max_date), <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb55-12"><a href="#cb55-12"></a>                 <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb55-13"><a href="#cb55-13"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> min_date), <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.2</span>), <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb55-14"><a href="#cb55-14"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> max_date), <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.2</span>), <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb55-15"><a href="#cb55-15"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n_days, <span class="at">x =</span> midpoint_date), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">11</span>,</span>
<span id="cb55-16"><a href="#cb55-16"></a>            <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.2</span>), <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb55-17"><a href="#cb55-17"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"date range"</span>, <span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">color =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb55-18"><a href="#cb55-18"></a>  <span class="fu">theme_td</span>(<span class="at">base_size =</span> <span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="hfx-bike-ridership_files/figure-revealjs/unnamed-chunk-64-1.png" width="1920"></p>
</figure>
</div>
</div>
</div>
<aside class="notes">
<ul>
<li>Train: Dec 2019 to Nov 2021, ~2 years</li>
<li>Test: Nov 2021 to April 2022, ~6 months</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="resampling-strategy" class="slide level2">
<h2>Resampling strategy</h2>
<ul>
<li>Train on 12 months, predict on 2 months</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a>bike_resamples <span class="ot">&lt;-</span></span>
<span id="cb56-2"><a href="#cb56-2"></a>  <span class="fu">sliding_period</span>(bike_train, <span class="at">index =</span> count_date,</span>
<span id="cb56-3"><a href="#cb56-3"></a>                 <span class="at">period =</span> <span class="st">"month"</span>, <span class="at">lookback =</span> <span class="dv">12</span>, <span class="at">assess_stop =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb57-2"><a href="#cb57-2"></a>  <span class="at">analysis_set =</span> <span class="fu">map_dfr</span>(bike_resamples<span class="sc">$</span>splits, analysis, <span class="at">.id =</span> <span class="st">"i"</span>),</span>
<span id="cb57-3"><a href="#cb57-3"></a>  <span class="at">assessment_set =</span> <span class="fu">map_dfr</span>(bike_resamples<span class="sc">$</span>splits, assessment, <span class="at">.id =</span> <span class="st">"i"</span>),</span>
<span id="cb57-4"><a href="#cb57-4"></a>  <span class="at">.id =</span> <span class="st">"data_set"</span></span>
<span id="cb57-5"><a href="#cb57-5"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb57-6"><a href="#cb57-6"></a>  <span class="fu">mutate</span>(<span class="at">i =</span> <span class="fu">as.integer</span>(i)) <span class="sc">%&gt;%</span></span>
<span id="cb57-7"><a href="#cb57-7"></a>  <span class="fu">group_by</span>(i, data_set) <span class="sc">%&gt;%</span></span>
<span id="cb57-8"><a href="#cb57-8"></a>  <span class="fu">summarise</span>(</span>
<span id="cb57-9"><a href="#cb57-9"></a>    <span class="at">min_date =</span> <span class="fu">min</span>(count_date), <span class="at">max_date =</span> <span class="fu">max</span>(count_date),</span>
<span id="cb57-10"><a href="#cb57-10"></a>    <span class="at">n_days =</span> <span class="fu">n</span>(), <span class="at">midpoint_date =</span> min_date <span class="sc">+</span> n_days <span class="sc">/</span> <span class="dv">2</span>,</span>
<span id="cb57-11"><a href="#cb57-11"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb57-12"><a href="#cb57-12"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb57-13"><a href="#cb57-13"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">factor</span>(i), <span class="at">color =</span> data_set)) <span class="sc">+</span></span>
<span id="cb57-14"><a href="#cb57-14"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> min_date, <span class="at">xmax =</span> max_date), <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb57-15"><a href="#cb57-15"></a>                 <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.3</span>)) <span class="sc">+</span></span>
<span id="cb57-16"><a href="#cb57-16"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> min_date), <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.3</span>), <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb57-17"><a href="#cb57-17"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> max_date), <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.3</span>), <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb57-18"><a href="#cb57-18"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"date range"</span>, <span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">color =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb57-19"><a href="#cb57-19"></a>  <span class="fu">theme_td</span>(<span class="at">base_size =</span> <span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="hfx-bike-ridership_files/figure-revealjs/unnamed-chunk-66-1.png" width="1920"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="metrics" class="slide level2">
<h2>Metrics</h2>
<ul>
<li>Mean absolute squared error<sup>1</sup></li>
</ul>
<p><span class="math display">\[
q_t = \frac{y_t - \hat{y}_t}{\frac{1}{n-1} \sum_{i=2}^n |y_i - y_{i-1} |} = \frac{\text{model error}}{\text{mean naive forecast error}}
\]</span></p>
<p><span class="math display">\[
\text{MASE} = \text{mean}(|q_t|)
\]</span></p>
<ul>
<li>Root mean square error</li>
</ul>
<aside><ol class="aside-footnotes"><li id="fn1" role="doc-endnote"><p>Hyndman, RJ, &amp; Koehler, AB. (2006). Another look at measures of forecast accuracy. International journal of forecasting, 22(4), 679-688.</p></li></ol></aside></section>
<section id="linear-models" class="slide level2">
<h2>Linear models</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a>lm_spec <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>(<span class="at">engine =</span> <span class="st">"lm"</span>)</span>
<span id="cb58-2"><a href="#cb58-2"></a><span class="fu">library</span>(poissonreg) <span class="co"># This wrapper package is required to use `poisson_reg()`</span></span>
<span id="cb58-3"><a href="#cb58-3"></a>poisson_spec <span class="ot">&lt;-</span> <span class="fu">poisson_reg</span>(<span class="at">engine =</span> <span class="st">"glm"</span>)</span>
<span id="cb58-4"><a href="#cb58-4"></a></span>
<span id="cb58-5"><a href="#cb58-5"></a>glm_recipe <span class="ot">&lt;-</span></span>
<span id="cb58-6"><a href="#cb58-6"></a>  <span class="fu">recipe</span>(n_bikes <span class="sc">~</span> count_date <span class="sc">+</span> site_name <span class="sc">+</span> n_bikes_lag_14,</span>
<span id="cb58-7"><a href="#cb58-7"></a>         <span class="at">data =</span> bike_train) <span class="sc">%&gt;%</span></span>
<span id="cb58-8"><a href="#cb58-8"></a>  <span class="fu">add_role</span>(count_date, <span class="at">new_role =</span> <span class="st">"date_variable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-9"><a href="#cb58-9"></a>  <span class="fu">step_novel</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb58-10"><a href="#cb58-10"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb58-11"><a href="#cb58-11"></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>())</span>
<span id="cb58-12"><a href="#cb58-12"></a></span>
<span id="cb58-13"><a href="#cb58-13"></a>glm_recipe_date <span class="ot">&lt;-</span></span>
<span id="cb58-14"><a href="#cb58-14"></a>  <span class="fu">recipe</span>(n_bikes <span class="sc">~</span> count_date <span class="sc">+</span> site_name <span class="sc">+</span> n_bikes_lag_14,</span>
<span id="cb58-15"><a href="#cb58-15"></a>         <span class="at">data =</span> bike_train) <span class="sc">%&gt;%</span></span>
<span id="cb58-16"><a href="#cb58-16"></a>  <span class="fu">add_role</span>(count_date, <span class="at">new_role =</span> <span class="st">"date_variable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-17"><a href="#cb58-17"></a>  <span class="fu">step_date</span>(count_date, <span class="at">features =</span> <span class="fu">c</span>(<span class="st">"dow"</span>, <span class="st">"doy"</span>, <span class="st">"year"</span>),</span>
<span id="cb58-18"><a href="#cb58-18"></a>            <span class="at">label =</span> <span class="cn">TRUE</span>, <span class="at">ordinal =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-19"><a href="#cb58-19"></a>  <span class="fu">step_ns</span>(count_date_doy, <span class="at">deg_free =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb58-20"><a href="#cb58-20"></a>  <span class="fu">step_holiday</span>(count_date, <span class="at">holidays =</span> canada_holidays) <span class="sc">%&gt;%</span></span>
<span id="cb58-21"><a href="#cb58-21"></a>  <span class="fu">step_novel</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb58-22"><a href="#cb58-22"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb58-23"><a href="#cb58-23"></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>())</span>
<span id="cb58-24"><a href="#cb58-24"></a></span>
<span id="cb58-25"><a href="#cb58-25"></a></span>
<span id="cb58-26"><a href="#cb58-26"></a></span>
<span id="cb58-27"><a href="#cb58-27"></a>glm_recipe_weather <span class="ot">&lt;-</span></span>
<span id="cb58-28"><a href="#cb58-28"></a>  <span class="fu">recipe</span>(n_bikes <span class="sc">~</span> count_date <span class="sc">+</span> site_name <span class="sc">+</span> n_bikes_lag_14 <span class="sc">+</span> mean_temperature <span class="sc">+</span></span>
<span id="cb58-29"><a href="#cb58-29"></a>           total_precipitation <span class="sc">+</span> speed_max_gust <span class="sc">+</span> snow_on_ground,</span>
<span id="cb58-30"><a href="#cb58-30"></a>         <span class="at">data =</span> bike_train) <span class="sc">%&gt;%</span></span>
<span id="cb58-31"><a href="#cb58-31"></a>  <span class="fu">add_role</span>(count_date, <span class="at">new_role =</span> <span class="st">"date_variable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-32"><a href="#cb58-32"></a>  <span class="fu">step_impute_mean</span>(speed_max_gust) <span class="sc">%&gt;%</span></span>
<span id="cb58-33"><a href="#cb58-33"></a>  <span class="co"># Impute these missing values with zero</span></span>
<span id="cb58-34"><a href="#cb58-34"></a>  <span class="fu">step_mutate_at</span>(<span class="fu">c</span>(total_precipitation, snow_on_ground),</span>
<span id="cb58-35"><a href="#cb58-35"></a>                 <span class="at">fn =</span> <span class="sc">~</span> <span class="fu">replace_na</span>(., <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb58-36"><a href="#cb58-36"></a>  <span class="fu">step_impute_roll</span>(mean_temperature, <span class="at">statistic =</span> mean, <span class="at">window =</span> <span class="dv">31</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-37"><a href="#cb58-37"></a>  <span class="fu">step_novel</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb58-38"><a href="#cb58-38"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb58-39"><a href="#cb58-39"></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>())</span>
<span id="cb58-40"><a href="#cb58-40"></a></span>
<span id="cb58-41"><a href="#cb58-41"></a>glm_recipe_date_weather <span class="ot">&lt;-</span></span>
<span id="cb58-42"><a href="#cb58-42"></a>  <span class="fu">recipe</span>(n_bikes <span class="sc">~</span> count_date <span class="sc">+</span> site_name <span class="sc">+</span> n_bikes_lag_14 <span class="sc">+</span> mean_temperature <span class="sc">+</span></span>
<span id="cb58-43"><a href="#cb58-43"></a>           total_precipitation <span class="sc">+</span> speed_max_gust <span class="sc">+</span> snow_on_ground,</span>
<span id="cb58-44"><a href="#cb58-44"></a>         <span class="at">data =</span> bike_train) <span class="sc">%&gt;%</span></span>
<span id="cb58-45"><a href="#cb58-45"></a>  <span class="fu">add_role</span>(count_date, <span class="at">new_role =</span> <span class="st">"date_variable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-46"><a href="#cb58-46"></a>  <span class="fu">step_date</span>(count_date, <span class="at">features =</span> <span class="fu">c</span>(<span class="st">"dow"</span>, <span class="st">"doy"</span>, <span class="st">"year"</span>),</span>
<span id="cb58-47"><a href="#cb58-47"></a>            <span class="at">label =</span> <span class="cn">TRUE</span>, <span class="at">ordinal =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-48"><a href="#cb58-48"></a>  <span class="fu">step_ns</span>(count_date_doy, <span class="at">deg_free =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb58-49"><a href="#cb58-49"></a>  <span class="fu">step_holiday</span>(count_date, <span class="at">holidays =</span> canada_holidays) <span class="sc">%&gt;%</span></span>
<span id="cb58-50"><a href="#cb58-50"></a>  <span class="fu">step_impute_mean</span>(speed_max_gust) <span class="sc">%&gt;%</span></span>
<span id="cb58-51"><a href="#cb58-51"></a>  <span class="fu">step_mutate_at</span>(<span class="fu">c</span>(total_precipitation, snow_on_ground),</span>
<span id="cb58-52"><a href="#cb58-52"></a>                 <span class="at">fn =</span> <span class="sc">~</span> <span class="fu">replace_na</span>(., <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb58-53"><a href="#cb58-53"></a>  <span class="fu">step_impute_roll</span>(mean_temperature, <span class="at">statistic =</span> mean, <span class="at">window =</span> <span class="dv">31</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-54"><a href="#cb58-54"></a>  <span class="fu">step_novel</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb58-55"><a href="#cb58-55"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb58-56"><a href="#cb58-56"></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div>
<ul>
<li class="fragment">Two models: linear regression and Poisson regression</li>
<li class="fragment">Three sets of features:
<ul>
<li class="fragment">Base variables: site and lagged counts</li>
<li class="fragment">Base + date variables
<ul>
<li class="fragment">Day of year variable represented with natural cubic splines, with 4-7 deg freedom</li>
</ul></li>
<li class="fragment">Base + weather variables</li>
<li class="fragment">Base + date + weather</li>
</ul></li>
</ul>
</div>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a>glm_wf_set <span class="ot">&lt;-</span> <span class="fu">workflow_set</span>(</span>
<span id="cb59-2"><a href="#cb59-2"></a>  <span class="at">preproc =</span> <span class="fu">list</span>(<span class="at">base =</span> glm_recipe,</span>
<span id="cb59-3"><a href="#cb59-3"></a>                 <span class="at">date =</span> glm_recipe_date,</span>
<span id="cb59-4"><a href="#cb59-4"></a>                 <span class="at">weather =</span> glm_recipe_weather,</span>
<span id="cb59-5"><a href="#cb59-5"></a>                 <span class="at">date_weather =</span> glm_recipe_date_weather),</span>
<span id="cb59-6"><a href="#cb59-6"></a>  <span class="at">models =</span> <span class="fu">list</span>(<span class="at">linear_reg =</span> lm_spec, <span class="at">poisson_reg =</span> poisson_spec),</span>
<span id="cb59-7"><a href="#cb59-7"></a>  <span class="at">cross =</span> <span class="cn">TRUE</span></span>
<span id="cb59-8"><a href="#cb59-8"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>In total = 20 model configurations</li>
</ul>
</div>
</section>
<section id="linear-models-1" class="slide level2">
<h2>Linear models</h2>
<ul>
<li>Model evaluation</li>
</ul>
<div class="cell">

</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a>glm_wf_set_res <span class="ot">&lt;-</span> <span class="fu">workflow_map</span>(</span>
<span id="cb60-2"><a href="#cb60-2"></a>  glm_wf_set,</span>
<span id="cb60-3"><a href="#cb60-3"></a>  <span class="st">"tune_grid"</span>,</span>
<span id="cb60-4"><a href="#cb60-4"></a>  <span class="at">grid =</span> <span class="fu">grid_regular</span>(<span class="fu">deg_free</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">7</span>)), <span class="at">levels =</span> <span class="dv">4</span>),</span>
<span id="cb60-5"><a href="#cb60-5"></a>  <span class="at">resamples =</span> bike_resamples, <span class="at">metrics =</span> bike_metrics</span>
<span id="cb60-6"><a href="#cb60-6"></a>)</span>
<span id="cb60-7"><a href="#cb60-7"></a></span>
<span id="cb60-8"><a href="#cb60-8"></a><span class="fu">plot_wf_set_metrics</span>(glm_wf_set_res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>

<img data-src="hfx-bike-ridership_files/figure-revealjs/unnamed-chunk-72-1.png" width="1440" class="r-stretch quarto-figure-center"></section>
<section id="linear-models-2" class="slide level2">
<h2>Linear models</h2>
<ul>
<li>Best linear model: Poisson regression with all features</li>
</ul>
<div class="fragment">
<ul>
<li>Best spline degree?</li>
</ul>
<div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a>res <span class="ot">&lt;-</span> <span class="fu">extract_workflow_set_result</span>(glm_wf_set_res,</span>
<span id="cb61-2"><a href="#cb61-2"></a>                                   <span class="at">id =</span> <span class="st">"date_weather_poisson_reg"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-3"><a href="#cb61-3"></a>  <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span></span>
<span id="cb61-4"><a href="#cb61-4"></a>  <span class="fu">filter</span>(.metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"mase"</span>, <span class="st">"rmse"</span>))</span>
<span id="cb61-5"><a href="#cb61-5"></a></span>
<span id="cb61-6"><a href="#cb61-6"></a>res <span class="sc">%&gt;%</span></span>
<span id="cb61-7"><a href="#cb61-7"></a>  <span class="fu">transmute</span>(deg_free, .metric,</span>
<span id="cb61-8"><a href="#cb61-8"></a>            <span class="at">mean_se =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(mean, <span class="dv">2</span>), <span class="st">" ("</span>, <span class="fu">round</span>(std_err, <span class="dv">2</span>), <span class="st">")"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb61-9"><a href="#cb61-9"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> .metric, <span class="at">values_from =</span> mean_se)</span>
<span id="cb61-10"><a href="#cb61-10"></a>res <span class="sc">%&gt;%</span></span>
<span id="cb61-11"><a href="#cb61-11"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> deg_free, <span class="at">y =</span> mean)) <span class="sc">+</span></span>
<span id="cb61-12"><a href="#cb61-12"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb61-13"><a href="#cb61-13"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> mean <span class="sc">-</span> std_err, <span class="at">ymax =</span> mean <span class="sc">+</span> std_err),</span>
<span id="cb61-14"><a href="#cb61-14"></a>                <span class="at">width =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb61-15"><a href="#cb61-15"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> .metric, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb61-16"><a href="#cb61-16"></a>  <span class="fu">theme_td</span>(<span class="at">base_size =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="kable-table">

<table>
<thead>
<tr>
<th style="text-align:right;">
deg_free
</th>
<th style="text-align:left;">
mase
</th>
<th style="text-align:left;">
rmse
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
0.6 (0.05)
</td>
<td style="text-align:left;">
84.51 (10.45)
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
0.55 (0.06)
</td>
<td style="text-align:left;">
74.99 (7.51)
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
0.55 (0.06)
</td>
<td style="text-align:left;">
75.24 (8.44)
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
0.56 (0.06)
</td>
<td style="text-align:left;">
76.93 (8.29)
</td>
</tr>
</tbody>

</table>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img data-src="hfx-bike-ridership_files/figure-revealjs/unnamed-chunk-73-1.png" width="864"></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="linear-models-3" class="slide level2">
<h2>Linear models</h2>
<ul>
<li>Interpretation</li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a>poisson_coefs <span class="ot">&lt;-</span> <span class="fu">tidy</span>(glm_poisson_fit) <span class="sc">%&gt;%</span></span>
<span id="cb62-2"><a href="#cb62-2"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(statistic))) <span class="sc">%&gt;%</span></span>
<span id="cb62-3"><a href="#cb62-3"></a>  <span class="fu">mutate</span>(<span class="at">estimate =</span> <span class="fu">signif</span>(estimate, <span class="dv">3</span>), <span class="at">std.error =</span> <span class="fu">signif</span>(estimate, <span class="dv">2</span>),</span>
<span id="cb62-4"><a href="#cb62-4"></a>         <span class="at">statistic =</span> <span class="fu">round</span>(statistic, <span class="dv">1</span>), <span class="at">p.value =</span> scales<span class="sc">::</span><span class="fu">pvalue</span>(p.value))</span>
<span id="cb62-5"><a href="#cb62-5"></a>poisson_coefs <span class="sc">%&gt;%</span></span>
<span id="cb62-6"><a href="#cb62-6"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(term, <span class="st">"temperature|precip|max_gust|snow"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">

<table>
<thead>
<tr>
<th style="text-align:left;">
term
</th>
<th style="text-align:right;">
estimate
</th>
<th style="text-align:right;">
std.error
</th>
<th style="text-align:right;">
statistic
</th>
<th style="text-align:left;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
total_precipitation
</td>
<td style="text-align:right;">
-0.03840
</td>
<td style="text-align:right;">
-0.0380
</td>
<td style="text-align:right;">
-84.6
</td>
<td style="text-align:left;">
&lt;0.001
</td>
</tr>
<tr>
<td style="text-align:left;">
mean_temperature
</td>
<td style="text-align:right;">
0.03650
</td>
<td style="text-align:right;">
0.0360
</td>
<td style="text-align:right;">
53.3
</td>
<td style="text-align:left;">
&lt;0.001
</td>
</tr>
<tr>
<td style="text-align:left;">
snow_on_ground
</td>
<td style="text-align:right;">
-0.05360
</td>
<td style="text-align:right;">
-0.0540
</td>
<td style="text-align:right;">
-28.9
</td>
<td style="text-align:left;">
&lt;0.001
</td>
</tr>
<tr>
<td style="text-align:left;">
speed_max_gust
</td>
<td style="text-align:right;">
-0.00735
</td>
<td style="text-align:right;">
-0.0074
</td>
<td style="text-align:right;">
-19.6
</td>
<td style="text-align:left;">
&lt;0.001
</td>
</tr>
</tbody>

</table>
</div>
</div>
</div>
<p>. . .</p>
<p><span class="math display">\[
\begin{align}
\log{n}_{\text{bikes}} &amp;= \beta_0 + \beta_1 x_1 + \dots + \beta_p x_p \\
n_{\text{bikes}} &amp;= \text{exp}(\beta_0 + \beta_1 x_1 + \dots + \beta_p x_p) \\
&amp;= \text{exp}(\beta_0) \text{exp}(\beta_1 x_1) \dots \text{exp}(\beta_p x_p) \\
\end{align}
\]</span></p>
</div><div class="column fragment" style="width:50%;">
<ul>
<li>For every 5°C increase in daily average temperature, the expected number of bikes increases by 144%.</li>
<li>For every 10mm increase in rain, the expected number of bikes decreases by 83%.</li>
<li>For every 10km/h increase in maximum wind speed, the expected number of bikes decreases by 96%.</li>
<li>For every 5cm of snow, the expected number of bikes decreases by 59%.</li>
</ul>
</div>
</div>
</section>
<section id="tree-based-methods" class="slide level2">
<h2>Tree-based methods</h2>
<ul>
<li>Decision tree, random forest, boosted trees</li>
<li>10 candidate models each, with different hyperparameters</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a>trees_recipe <span class="ot">&lt;-</span></span>
<span id="cb63-2"><a href="#cb63-2"></a>  <span class="fu">recipe</span>(n_bikes <span class="sc">~</span> count_date <span class="sc">+</span> site_name <span class="sc">+</span> n_bikes_lag_14 <span class="sc">+</span> mean_temperature <span class="sc">+</span></span>
<span id="cb63-3"><a href="#cb63-3"></a>           total_precipitation <span class="sc">+</span> speed_max_gust <span class="sc">+</span> snow_on_ground,</span>
<span id="cb63-4"><a href="#cb63-4"></a>         <span class="at">data =</span> bike_train) <span class="sc">%&gt;%</span></span>
<span id="cb63-5"><a href="#cb63-5"></a>  <span class="fu">update_role</span>(count_date, <span class="at">new_role =</span> <span class="st">"date_variable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-6"><a href="#cb63-6"></a>  <span class="fu">step_date</span>(count_date, <span class="at">features =</span> <span class="fu">c</span>(<span class="st">"dow"</span>, <span class="st">"doy"</span>, <span class="st">"year"</span>),</span>
<span id="cb63-7"><a href="#cb63-7"></a>            <span class="at">label =</span> <span class="cn">TRUE</span>, <span class="at">ordinal =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-8"><a href="#cb63-8"></a>  <span class="fu">step_holiday</span>(count_date, <span class="at">holidays =</span> canada_holidays) <span class="sc">%&gt;%</span></span>
<span id="cb63-9"><a href="#cb63-9"></a>  <span class="fu">step_novel</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb63-10"><a href="#cb63-10"></a>  <span class="fu">step_impute_mean</span>(speed_max_gust) <span class="sc">%&gt;%</span></span>
<span id="cb63-11"><a href="#cb63-11"></a>  <span class="fu">step_mutate_at</span>(<span class="fu">c</span>(total_precipitation, snow_on_ground),</span>
<span id="cb63-12"><a href="#cb63-12"></a>                 <span class="at">fn =</span> <span class="sc">~</span> <span class="fu">replace_na</span>(., <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb63-13"><a href="#cb63-13"></a>  <span class="fu">step_impute_roll</span>(mean_temperature, <span class="at">statistic =</span> mean, <span class="at">window =</span> <span class="dv">31</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-14"><a href="#cb63-14"></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>())</span>
<span id="cb63-15"><a href="#cb63-15"></a></span>
<span id="cb63-16"><a href="#cb63-16"></a><span class="co"># XGBoost requires dummy variables</span></span>
<span id="cb63-17"><a href="#cb63-17"></a>trees_recipe_dummy <span class="ot">&lt;-</span> trees_recipe <span class="sc">%&gt;%</span></span>
<span id="cb63-18"><a href="#cb63-18"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>())</span>
<span id="cb63-19"><a href="#cb63-19"></a></span>
<span id="cb63-20"><a href="#cb63-20"></a>decision_spec <span class="ot">&lt;-</span></span>
<span id="cb63-21"><a href="#cb63-21"></a>  <span class="fu">decision_tree</span>(<span class="at">cost_complexity =</span> <span class="fu">tune</span>(), <span class="at">tree_depth =</span> <span class="fu">tune</span>(),</span>
<span id="cb63-22"><a href="#cb63-22"></a>                <span class="at">min_n =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb63-23"><a href="#cb63-23"></a>  <span class="fu">set_engine</span>(<span class="st">"rpart"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-24"><a href="#cb63-24"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb63-25"><a href="#cb63-25"></a></span>
<span id="cb63-26"><a href="#cb63-26"></a>rf_spec <span class="ot">&lt;-</span> <span class="fu">rand_forest</span>(<span class="at">mtry =</span> <span class="fu">tune</span>(), <span class="at">min_n =</span> <span class="fu">tune</span>(), <span class="at">trees =</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-27"><a href="#cb63-27"></a>  <span class="co"># Setting the `importance` parameter now lets me use `vip` later</span></span>
<span id="cb63-28"><a href="#cb63-28"></a>  <span class="fu">set_engine</span>(<span class="st">"ranger"</span>, <span class="at">importance =</span> <span class="st">"permutation"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-29"><a href="#cb63-29"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb63-30"><a href="#cb63-30"></a></span>
<span id="cb63-31"><a href="#cb63-31"></a>xgb_spec <span class="ot">&lt;-</span> <span class="fu">boost_tree</span>(</span>
<span id="cb63-32"><a href="#cb63-32"></a>  <span class="at">mtry =</span> <span class="fu">tune</span>(), <span class="at">trees =</span> <span class="fu">tune</span>(), <span class="at">min_n =</span> <span class="fu">tune</span>(),</span>
<span id="cb63-33"><a href="#cb63-33"></a>  <span class="at">tree_depth =</span> <span class="fu">tune</span>(), <span class="at">learn_rate =</span> <span class="fu">tune</span>()</span>
<span id="cb63-34"><a href="#cb63-34"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb63-35"><a href="#cb63-35"></a>  <span class="fu">set_engine</span>(<span class="st">"xgboost"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-36"><a href="#cb63-36"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb63-37"><a href="#cb63-37"></a></span>
<span id="cb63-38"><a href="#cb63-38"></a>trees_wf_set <span class="ot">&lt;-</span> <span class="fu">workflow_set</span>(</span>
<span id="cb63-39"><a href="#cb63-39"></a>  <span class="at">preproc =</span> <span class="fu">list</span>(<span class="at">trees_recipe =</span> trees_recipe,</span>
<span id="cb63-40"><a href="#cb63-40"></a>                 <span class="at">trees_recipe =</span> trees_recipe,</span>
<span id="cb63-41"><a href="#cb63-41"></a>                 <span class="at">trees_recipe_dummy =</span> trees_recipe_dummy),</span>
<span id="cb63-42"><a href="#cb63-42"></a>  <span class="at">models =</span> <span class="fu">list</span>(<span class="at">rf =</span> rf_spec, <span class="at">decision =</span> decision_spec, <span class="at">xgb =</span> xgb_spec),</span>
<span id="cb63-43"><a href="#cb63-43"></a>  <span class="at">cross =</span> <span class="cn">FALSE</span></span>
<span id="cb63-44"><a href="#cb63-44"></a>)</span>
<span id="cb63-45"><a href="#cb63-45"></a></span>
<span id="cb63-46"><a href="#cb63-46"></a>trees_wf_set_res <span class="ot">&lt;-</span> <span class="fu">workflow_map</span>(</span>
<span id="cb63-47"><a href="#cb63-47"></a>  trees_wf_set,</span>
<span id="cb63-48"><a href="#cb63-48"></a>  <span class="st">"tune_grid"</span>,</span>
<span id="cb63-49"><a href="#cb63-49"></a>  <span class="at">grid =</span> <span class="dv">10</span>, <span class="at">resamples =</span> bike_resamples, <span class="at">metrics =</span> bike_metrics,</span>
<span id="cb63-50"><a href="#cb63-50"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">

</div>
<aside class="notes">
<ul>
<li>Decision tree:
<ul>
<li>tree depth: how deep the tree can be, i.e.&nbsp;many splits a tree can make before coming to a decision [1, 15]</li>
<li>cost-complexity: prunes the tree to control complexity, using a penalty term that penalizes trees with a large number of terminal nodes [-10, 1]</li>
<li><code>min_n</code> minimal node size: minimum number of data points in a node that is required before it can be split further [2, 40]</li>
</ul></li>
<li>Random forest: combines the output of many decision trees from bootstrapped training samples, but each split in the tree only uses a random subset of predictors
<ul>
<li><code>mtry</code>: number of randomly sampled predictors [1, p]</li>
<li><code>trees</code>: the number of trees to ensemble</li>
</ul></li>
<li>XGBoost: an implementation of gradient boosted decision trees
<ul>
<li>boosting: involves growing decision trees sequentially, where each tree is fit to the residuals from the previous tree</li>
<li>gradient boosting: an extension of boosting where the process of additively generating weak models is done using a gradient descent algorithm</li>
<li>XGBoost is a particular implementation that is faster and more efficient thanks to some regularization and parallelization</li>
</ul></li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="tree-based-methods-1" class="slide level2">
<h2>Tree-based methods</h2>
<ul>
<li>Model evaluation</li>
</ul>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a>plot_wf_set_metrics <span class="ot">&lt;-</span> <span class="cf">function</span>(wf_set_res, <span class="at">rank_metric =</span> <span class="st">"mase"</span>) {</span>
<span id="cb64-2"><a href="#cb64-2"></a>  <span class="fu">rank_results</span>(wf_set_res, <span class="at">rank_metric =</span> rank_metric) <span class="sc">%&gt;%</span></span>
<span id="cb64-3"><a href="#cb64-3"></a>    <span class="fu">filter</span>(.metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"mase"</span>, <span class="st">"rmse"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb64-4"><a href="#cb64-4"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> rank, <span class="at">y =</span> mean, <span class="at">color =</span> model)) <span class="sc">+</span></span>
<span id="cb64-5"><a href="#cb64-5"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb64-6"><a href="#cb64-6"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> mean <span class="sc">-</span> std_err, <span class="at">ymax =</span> mean <span class="sc">+</span> std_err),</span>
<span id="cb64-7"><a href="#cb64-7"></a>                  <span class="at">width =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb64-8"><a href="#cb64-8"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> .metric, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb64-9"><a href="#cb64-9"></a>    <span class="fu">theme_td</span>(<span class="at">base_size =</span> <span class="dv">30</span>)</span>
<span id="cb64-10"><a href="#cb64-10"></a>}</span>
<span id="cb64-11"><a href="#cb64-11"></a><span class="fu">plot_wf_set_metrics</span>(trees_wf_set_res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="hfx-bike-ridership_files/figure-revealjs/unnamed-chunk-80-1.png" width="1440" class="r-stretch quarto-figure-center"><div class="cell">

</div>
<div class="cell">

</div>
</section>
<section id="tree-based-methods-2" class="slide level2">
<h2>Tree-based methods</h2>
<ul>
<li>Interpret the models with variable importance</li>
</ul>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a><span class="fu">library</span>(vip)</span>
<span id="cb65-2"><a href="#cb65-2"></a></span>
<span id="cb65-3"><a href="#cb65-3"></a>p1 <span class="ot">&lt;-</span> <span class="fu">extract_fit_engine</span>(decision_fit) <span class="sc">%&gt;%</span></span>
<span id="cb65-4"><a href="#cb65-4"></a>  <span class="fu">vi</span>(<span class="at">scale =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-5"><a href="#cb65-5"></a>  <span class="fu">vip</span>(<span class="at">num_features =</span> <span class="dv">5</span>)  <span class="sc">+</span></span>
<span id="cb65-6"><a href="#cb65-6"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb65-7"><a href="#cb65-7"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Decision tree"</span>) <span class="sc">+</span></span>
<span id="cb65-8"><a href="#cb65-8"></a>  <span class="fu">theme_td</span>(<span class="at">base_size =</span> <span class="dv">25</span>)</span>
<span id="cb65-9"><a href="#cb65-9"></a>p2 <span class="ot">&lt;-</span> <span class="fu">extract_fit_engine</span>(rf_fit) <span class="sc">%&gt;%</span></span>
<span id="cb65-10"><a href="#cb65-10"></a>  <span class="fu">vi</span>(<span class="at">scale =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-11"><a href="#cb65-11"></a>  <span class="fu">vip</span>(<span class="at">num_features =</span> <span class="dv">5</span>)  <span class="sc">+</span></span>
<span id="cb65-12"><a href="#cb65-12"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb65-13"><a href="#cb65-13"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Random forest"</span>) <span class="sc">+</span></span>
<span id="cb65-14"><a href="#cb65-14"></a>  <span class="fu">theme_td</span>(<span class="at">base_size =</span> <span class="dv">25</span>)</span>
<span id="cb65-15"><a href="#cb65-15"></a>p3 <span class="ot">&lt;-</span> <span class="fu">extract_fit_engine</span>(xgb_fit) <span class="sc">%&gt;%</span></span>
<span id="cb65-16"><a href="#cb65-16"></a>  <span class="fu">vi</span>(<span class="at">scale =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-17"><a href="#cb65-17"></a>  <span class="fu">vip</span>(<span class="at">num_features =</span> <span class="dv">5</span>)  <span class="sc">+</span></span>
<span id="cb65-18"><a href="#cb65-18"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb65-19"><a href="#cb65-19"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Boosted tree"</span>) <span class="sc">+</span></span>
<span id="cb65-20"><a href="#cb65-20"></a>  <span class="fu">theme_td</span>(<span class="at">base_size =</span> <span class="dv">25</span>)</span>
<span id="cb65-21"><a href="#cb65-21"></a></span>
<span id="cb65-22"><a href="#cb65-22"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3 <span class="sc">+</span></span>
<span id="cb65-23"><a href="#cb65-23"></a>  <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="hfx-bike-ridership_files/figure-revealjs/unnamed-chunk-83-1.png" width="1440" class="r-stretch quarto-figure-center"></section>
<section id="model-choice" class="slide level2">
<h2>Model choice</h2>
<div class="cell">

</div>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb66-2"><a href="#cb66-2"></a>  <span class="fu">rank_results</span>(glm_wf_set_res, <span class="at">rank_metric =</span> <span class="st">"mase"</span>,</span>
<span id="cb66-3"><a href="#cb66-3"></a>                     <span class="at">select_best =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-4"><a href="#cb66-4"></a>    <span class="co"># Only include the full pre-processing recipe</span></span>
<span id="cb66-5"><a href="#cb66-5"></a>    <span class="fu">filter</span>(<span class="fu">str_detect</span>(wflow_id, <span class="st">"date_weather"</span>)),</span>
<span id="cb66-6"><a href="#cb66-6"></a>  <span class="fu">rank_results</span>(trees_wf_set_res, <span class="at">rank_metric =</span> <span class="st">"mase"</span>, <span class="at">select_best =</span> <span class="cn">TRUE</span>),</span>
<span id="cb66-7"><a href="#cb66-7"></a>  boost_best <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">"boost_tree_2"</span>)</span>
<span id="cb66-8"><a href="#cb66-8"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb66-9"><a href="#cb66-9"></a>  <span class="fu">filter</span>(.metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"mase"</span>, <span class="st">"rmse"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb66-10"><a href="#cb66-10"></a>  <span class="fu">group_by</span>(model) <span class="sc">%&gt;%</span></span>
<span id="cb66-11"><a href="#cb66-11"></a>  <span class="fu">mutate</span>(<span class="at">mase_temp =</span> mean[.metric <span class="sc">==</span> <span class="st">"mase"</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb66-12"><a href="#cb66-12"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb66-13"><a href="#cb66-13"></a>  <span class="fu">transmute</span>(mase_temp, model, .metric,</span>
<span id="cb66-14"><a href="#cb66-14"></a>            <span class="at">mean_se =</span> <span class="fu">paste0</span>(<span class="fu">signif</span>(mean, <span class="dv">4</span>), <span class="st">" ("</span>,</span>
<span id="cb66-15"><a href="#cb66-15"></a>                             <span class="fu">signif</span>(std_err, <span class="dv">3</span>), <span class="st">")"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb66-16"><a href="#cb66-16"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> .metric, <span class="at">values_from =</span> mean_se) <span class="sc">%&gt;%</span></span>
<span id="cb66-17"><a href="#cb66-17"></a>  <span class="fu">arrange</span>(mase_temp) <span class="sc">%&gt;%</span></span>
<span id="cb66-18"><a href="#cb66-18"></a>  <span class="fu">select</span>(model, <span class="at">MASE =</span> mase, <span class="at">RMSE =</span> rmse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">

<table>
<thead>
<tr>
<th style="text-align:left;">
model
</th>
<th style="text-align:left;">
MASE
</th>
<th style="text-align:left;">
RMSE
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
boost_tree_2
</td>
<td style="text-align:left;">
0.4913 (0.0503)
</td>
<td style="text-align:left;">
70.94 (7.51)
</td>
</tr>
<tr>
<td style="text-align:left;">
boost_tree
</td>
<td style="text-align:left;">
0.4933 (0.0545)
</td>
<td style="text-align:left;">
70.4 (7.97)
</td>
</tr>
<tr>
<td style="text-align:left;">
rand_forest
</td>
<td style="text-align:left;">
0.5099 (0.0566)
</td>
<td style="text-align:left;">
72.33 (7.76)
</td>
</tr>
<tr>
<td style="text-align:left;">
poisson_reg
</td>
<td style="text-align:left;">
0.5471 (0.0563)
</td>
<td style="text-align:left;">
75.24 (8.44)
</td>
</tr>
<tr>
<td style="text-align:left;">
decision_tree
</td>
<td style="text-align:left;">
0.5481 (0.05)
</td>
<td style="text-align:left;">
77.92 (8.13)
</td>
</tr>
<tr>
<td style="text-align:left;">
linear_reg
</td>
<td style="text-align:left;">
0.5775 (0.0754)
</td>
<td style="text-align:left;">
76.04 (7.06)
</td>
</tr>
</tbody>

</table>
</div>
</div>
</div>
<ul>
<li>The boosted tree model (barely) wins by MASE</li>
</ul>
</div><div class="column" style="width:50%;">
<ul>
<li>Fit and evaluate on the test set:</li>
</ul>
<div class="cell">

</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a>boost_tree_final_fit <span class="ot">&lt;-</span> <span class="fu">last_fit</span>(</span>
<span id="cb67-2"><a href="#cb67-2"></a>  boost_tree_workflow, <span class="at">split =</span> bike_split, <span class="at">metrics =</span> bike_metrics</span>
<span id="cb67-3"><a href="#cb67-3"></a>)</span>
<span id="cb67-4"><a href="#cb67-4"></a><span class="fu">collect_metrics</span>(boost_tree_final_fit) <span class="sc">%&gt;%</span></span>
<span id="cb67-5"><a href="#cb67-5"></a>  <span class="fu">transmute</span>(<span class="at">metric =</span> .metric, <span class="at">estimate =</span> <span class="fu">signif</span>(.estimate, <span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">

<table>
<thead>
<tr>
<th style="text-align:left;">
metric
</th>
<th style="text-align:right;">
estimate
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
rmse
</td>
<td style="text-align:right;">
42.6400
</td>
</tr>
<tr>
<td style="text-align:left;">
mase
</td>
<td style="text-align:right;">
0.7039
</td>
</tr>
</tbody>

</table>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="exploring-the-predictions" class="slide level2">
<h2>Exploring the predictions</h2>
<ul>
<li>Actual vs predicted bikes for training and testing sets</li>
</ul>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a>boost_tree_preds <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb68-2"><a href="#cb68-2"></a>  <span class="at">train =</span> <span class="fu">augment</span>(<span class="fu">extract_workflow</span>(boost_tree_final_fit), bike_train),</span>
<span id="cb68-3"><a href="#cb68-3"></a>  <span class="at">test =</span> <span class="fu">augment</span>(<span class="fu">extract_workflow</span>(boost_tree_final_fit), bike_test),</span>
<span id="cb68-4"><a href="#cb68-4"></a>  <span class="at">.id =</span> <span class="st">"data_set"</span></span>
<span id="cb68-5"><a href="#cb68-5"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb68-6"><a href="#cb68-6"></a>  <span class="fu">mutate</span>(<span class="at">data_set =</span> <span class="fu">fct_inorder</span>(data_set), <span class="at">.pred =</span> <span class="fu">if_else</span>(.pred <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="dv">0</span>, .pred))</span>
<span id="cb68-7"><a href="#cb68-7"></a></span>
<span id="cb68-8"><a href="#cb68-8"></a>boost_tree_preds <span class="sc">%&gt;%</span></span>
<span id="cb68-9"><a href="#cb68-9"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> n_bikes, <span class="at">y =</span> .pred)) <span class="sc">+</span></span>
<span id="cb68-10"><a href="#cb68-10"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb68-11"><a href="#cb68-11"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> td_colors<span class="sc">$</span>nice<span class="sc">$</span>emerald) <span class="sc">+</span></span>
<span id="cb68-12"><a href="#cb68-12"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> data_set) <span class="sc">+</span></span>
<span id="cb68-13"><a href="#cb68-13"></a>  <span class="fu">add_facet_borders</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="hfx-bike-ridership_files/figure-revealjs/unnamed-chunk-88-1.png" width="960" class="r-stretch quarto-figure-center"></section>
<section id="exploring-the-predictions-1" class="slide level2">
<h2>Exploring the predictions</h2>
<ul>
<li>Visualize predictions over time</li>
</ul>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a>p <span class="ot">&lt;-</span> boost_tree_preds <span class="sc">%&gt;%</span></span>
<span id="cb69-2"><a href="#cb69-2"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> count_date)) <span class="sc">+</span></span>
<span id="cb69-3"><a href="#cb69-3"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> n_bikes, <span class="at">color =</span> site_name), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb69-4"><a href="#cb69-4"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .pred), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb69-5"><a href="#cb69-5"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">min</span>(bike_test<span class="sc">$</span>count_date), <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb69-6"><a href="#cb69-6"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> site_name, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb69-7"><a href="#cb69-7"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb69-8"><a href="#cb69-8"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">600</span>, <span class="dv">200</span>)) <span class="sc">+</span></span>
<span id="cb69-9"><a href="#cb69-9"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> sites_pal) <span class="sc">+</span></span>
<span id="cb69-10"><a href="#cb69-10"></a>  <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="dv">200</span>) <span class="sc">+</span></span>
<span id="cb69-11"><a href="#cb69-11"></a>  dunnr<span class="sc">::</span><span class="fu">add_facet_borders</span>()</span>
<span id="cb69-12"><a href="#cb69-12"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="hfx-bike-ridership_files/figure-revealjs/unnamed-chunk-89-1.png" width="960" class="r-stretch quarto-figure-center"></section>
<section id="exploring-the-predictions-2" class="slide level2">
<h2>Exploring the predictions</h2>
<ul>
<li>Visualize predictions over time <em>zoomed in</em></li>
</ul>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1"></a>p <span class="sc">+</span> <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">"2021-07-01"</span>, <span class="st">"2022-05-01"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="hfx-bike-ridership_files/figure-revealjs/unnamed-chunk-90-1.png" width="960" class="r-stretch quarto-figure-center"></section>
<section id="exploring-the-predictions-3" class="slide level2">
<h2>Exploring the predictions</h2>
<ul>
<li>Zeroes on Vernon St?</li>
</ul>
<div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a>p <span class="sc">%+%</span> <span class="fu">filter</span>(boost_tree_preds, site_name <span class="sc">==</span> <span class="st">"Vernon St"</span>,</span>
<span id="cb71-2"><a href="#cb71-2"></a>             count_date <span class="sc">&gt;</span> <span class="st">"2021-11-01"</span>, count_date <span class="sc">&lt;</span> <span class="st">"2021-12-01"</span>) <span class="sc">+</span></span>
<span id="cb71-3"><a href="#cb71-3"></a>  <span class="fu">theme_td</span>(<span class="at">base_size =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb71-4"><a href="#cb71-4"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb71-5"><a href="#cb71-5"></a>boost_tree_preds <span class="sc">%&gt;%</span></span>
<span id="cb71-6"><a href="#cb71-6"></a>  <span class="fu">filter</span>(site_name <span class="sc">==</span> <span class="st">"Vernon St"</span>, n_bikes <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb71-7"><a href="#cb71-7"></a>  <span class="fu">transmute</span>(count_date, n_bikes, <span class="at">.pred =</span> <span class="fu">round</span>(.pred, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="hfx-bike-ridership_files/figure-revealjs/unnamed-chunk-91-1.png" width="960"></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="kable-table">

<table>
<thead>
<tr>
<th style="text-align:left;">
count_date
</th>
<th style="text-align:right;">
n_bikes
</th>
<th style="text-align:right;">
.pred
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2021-11-13
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
89.4
</td>
</tr>
<tr>
<td style="text-align:left;">
2021-11-14
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
125.7
</td>
</tr>
<tr>
<td style="text-align:left;">
2021-11-15
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
141.8
</td>
</tr>
<tr>
<td style="text-align:left;">
2021-11-16
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
268.6
</td>
</tr>
<tr>
<td style="text-align:left;">
2021-11-17
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
262.1
</td>
</tr>
<tr>
<td style="text-align:left;">
2021-11-18
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
166.4
</td>
</tr>
</tbody>

</table>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="exploring-the-predictions-4" class="slide level2">
<h2>Exploring the predictions</h2>
<ul>
<li>Home for Christmas 2021?</li>
</ul>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1"></a>p <span class="sc">%+%</span> <span class="fu">filter</span>(boost_tree_preds,</span>
<span id="cb72-2"><a href="#cb72-2"></a>             site_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"South Park St"</span>, <span class="st">"Vernon St"</span>),</span>
<span id="cb72-3"><a href="#cb72-3"></a>             count_date <span class="sc">&gt;</span> <span class="st">"2021-12-01"</span>, count_date <span class="sc">&lt;</span> <span class="st">"2022-01-10"</span>) <span class="sc">+</span></span>
<span id="cb72-4"><a href="#cb72-4"></a>  <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">250</span>)) <span class="sc">+</span></span>
<span id="cb72-5"><a href="#cb72-5"></a>  <span class="fu">theme_td</span>(<span class="at">base_size =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb72-6"><a href="#cb72-6"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="hfx-bike-ridership_files/figure-revealjs/unnamed-chunk-92-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
<aside class="notes">
<ul>
<li>Looked at 2020 numbers in the Christmas period, not nearly as bad – COVID?</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="exploring-the-predictions-5" class="slide level2">
<h2>Exploring the predictions</h2>
<ul>
<li>Big outliers in November 2021?</li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1"></a>p <span class="sc">%+%</span> <span class="fu">filter</span>(boost_tree_preds,</span>
<span id="cb73-2"><a href="#cb73-2"></a>             count_date <span class="sc">&gt;</span> <span class="st">"2021-11-20"</span>, count_date <span class="sc">&lt;</span> <span class="st">"2021-11-26"</span>) <span class="sc">+</span></span>
<span id="cb73-3"><a href="#cb73-3"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">as.Date</span>(<span class="st">"2021-11-23"</span>), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb73-4"><a href="#cb73-4"></a>  <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">200</span>)) <span class="sc">+</span></span>
<span id="cb73-5"><a href="#cb73-5"></a>  <span class="fu">theme_td</span>(<span class="at">base_size =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb73-6"><a href="#cb73-6"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> site_name, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb73-7"><a href="#cb73-7"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="hfx-bike-ridership_files/figure-revealjs/unnamed-chunk-93-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div><div class="column fragment" style="width:50%;">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a>boost_tree_preds <span class="sc">%&gt;%</span></span>
<span id="cb74-2"><a href="#cb74-2"></a>  <span class="fu">filter</span>(count_date <span class="sc">&gt;=</span> <span class="st">"2021-11-22"</span>, count_date <span class="sc">&lt;=</span> <span class="st">"2021-11-23"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-3"><a href="#cb74-3"></a>  <span class="fu">distinct</span>(count_date, mean_temperature, total_precipitation, speed_max_gust)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">

<table>
<thead>
<tr>
<th style="text-align:left;">
count_date
</th>
<th style="text-align:right;">
mean_temperature
</th>
<th style="text-align:right;">
total_precipitation
</th>
<th style="text-align:right;">
speed_max_gust
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2021-11-22
</td>
<td style="text-align:right;">
11.1
</td>
<td style="text-align:right;">
42.2
</td>
<td style="text-align:right;">
57
</td>
</tr>
<tr>
<td style="text-align:left;">
2021-11-23
</td>
<td style="text-align:right;">
6.1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
41
</td>
</tr>
</tbody>

</table>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="exploring-the-predictions-6" class="slide level2">
<h2>Exploring the predictions</h2>

<img data-src="images/weather-article.PNG" class="r-stretch"><div class="fragment">
<ul>
<li>A weak point of my modeling: missing data imputation</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1"></a><span class="fu">augment</span>(</span>
<span id="cb75-2"><a href="#cb75-2"></a>  <span class="fu">extract_workflow</span>(boost_tree_final_fit),</span>
<span id="cb75-3"><a href="#cb75-3"></a>  boost_tree_preds <span class="sc">%&gt;%</span></span>
<span id="cb75-4"><a href="#cb75-4"></a>    <span class="fu">filter</span>(count_date <span class="sc">==</span> <span class="st">"2021-11-23"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb75-5"><a href="#cb75-5"></a>    <span class="fu">rename</span>(<span class="at">.pred_old =</span> .pred) <span class="sc">%&gt;%</span></span>
<span id="cb75-6"><a href="#cb75-6"></a>    <span class="fu">mutate</span>(<span class="at">total_precipitation =</span> <span class="dv">15</span>)</span>
<span id="cb75-7"><a href="#cb75-7"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb75-8"><a href="#cb75-8"></a>  <span class="fu">transmute</span>(site_name, n_bikes,</span>
<span id="cb75-9"><a href="#cb75-9"></a>            <span class="at">.pred_old =</span> <span class="fu">round</span>(.pred_old, <span class="dv">1</span>),</span>
<span id="cb75-10"><a href="#cb75-10"></a>            <span class="at">.pred_new =</span> <span class="fu">round</span>(.pred, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">

<table>
<thead>
<tr>
<th style="text-align:left;">
site_name
</th>
<th style="text-align:right;">
n_bikes
</th>
<th style="text-align:right;">
.pred_old
</th>
<th style="text-align:right;">
.pred_new
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Dartmouth Harbourfront Greenway
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
116.4
</td>
<td style="text-align:right;">
42.4
</td>
</tr>
<tr>
<td style="text-align:left;">
Hollis St
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
71.6
</td>
<td style="text-align:right;">
3.6
</td>
</tr>
<tr>
<td style="text-align:left;">
South Park St
</td>
<td style="text-align:right;">
59
</td>
<td style="text-align:right;">
314.9
</td>
<td style="text-align:right;">
192.0
</td>
</tr>
<tr>
<td style="text-align:left;">
Vernon St
</td>
<td style="text-align:right;">
133
</td>
<td style="text-align:right;">
164.3
</td>
<td style="text-align:right;">
85.7
</td>
</tr>
<tr>
<td style="text-align:left;">
Windsor St
</td>
<td style="text-align:right;">
26
</td>
<td style="text-align:right;">
84.4
</td>
<td style="text-align:right;">
13.6
</td>
</tr>
</tbody>

</table>
</div>
</div>
</div>
</div>
</section></section>
<section>
<section id="model-deployment" class="title-slide slide level1 center">
<h1>Model deployment</h1>

</section>
<section id="model-deployment-1" class="slide level2">
<h2>Model deployment</h2>
<aside class="notes">
<ul>
<li>Docker is a software for generating virtual systems or containers that can run code on servers like Google Cloud or AWS</li>
<li>They’re great for reproduciblity, because they define every little detail including the operating system, of the container</li>
<li>The dockerfile, which I’m showing here, has the instructions for constructing the Docker image or machine</li>
<li>rocker/tidyverse is the base image
<ul>
<li>doing a lot of heavy lifting</li>
<li>Ubuntu, installs system libraries, installs R, installs a bunch of packages</li>
</ul></li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div>
<ul>
<li class="fragment">Putting the boosted tree model into “production” on Google Cloud Platform (GCP)</li>
<li class="fragment">ETL pipeline with BigQuery and Cloud Scheduler</li>
<li class="fragment">automatic model training with Cloud Run and Pub/Sub</li>
<li class="fragment">serving predictions with a REST API</li>
<li class="fragment">prediction visualization with a Shiny dashboard</li>
</ul>
</div>
</section>
<section id="etl-pipeline" class="slide level2">
<h2>ETL pipeline</h2>
<ul>
<li>A Dockerfile to “containerize” the code</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource dockerfile number-lines code-with-copy"><code class="sourceCode dockerfile"><span id="cb76-1"><a href="#cb76-1"></a><span class="kw">FROM</span> rocker/tidyverse:latest</span>
<span id="cb76-2"><a href="#cb76-2"></a></span>
<span id="cb76-3"><a href="#cb76-3"></a><span class="kw">RUN</span> <span class="ex">R</span> <span class="at">-e</span> <span class="st">"install.packages(c('bigrquery', 'httr'), repos = 'http://cran.us.r-project.org')"</span></span>
<span id="cb76-4"><a href="#cb76-4"></a></span>
<span id="cb76-5"><a href="#cb76-5"></a><span class="kw">ADD</span> oauth-client.json /home/rstudio</span>
<span id="cb76-6"><a href="#cb76-6"></a><span class="kw">ADD</span> etl/etl.R /home/rstudio</span>
<span id="cb76-7"><a href="#cb76-7"></a></span>
<span id="cb76-8"><a href="#cb76-8"></a><span class="kw">CMD</span> <span class="ex">Rscript</span> /home/rstudio/etl.R</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<ul>
<li>A script to <em>extract</em>, <em>transform</em> and <em>load</em></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1"></a><span class="fu">library</span>(bigrquery)</span>
<span id="cb77-2"><a href="#cb77-2"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb77-3"><a href="#cb77-3"></a><span class="fu">library</span>(httr)</span>
<span id="cb77-4"><a href="#cb77-4"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb77-5"><a href="#cb77-5"></a></span>
<span id="cb77-6"><a href="#cb77-6"></a><span class="co"># Get bike counter data ---------------------------------------------------</span></span>
<span id="cb77-7"><a href="#cb77-7"></a></span>
<span id="cb77-8"><a href="#cb77-8"></a>hfx_bike_url <span class="ot">&lt;-</span> <span class="st">"https://services2.arcgis.com/11XBiaBYA9Ep0yNJ/arcgis/rest/services/Bicycle_Counts/FeatureServer/0/query?where=1%3D1&amp;outFields=*&amp;outSR=4326&amp;f=json"</span></span>
<span id="cb77-9"><a href="#cb77-9"></a></span>
<span id="cb77-10"><a href="#cb77-10"></a>get_bike_counts <span class="ot">&lt;-</span> <span class="cf">function</span>(offset) {</span>
<span id="cb77-11"><a href="#cb77-11"></a>  <span class="co"># Need to prevent scientific notation, e.g. "1e+05" instead of "100000"</span></span>
<span id="cb77-12"><a href="#cb77-12"></a>  offset <span class="ot">&lt;-</span> <span class="fu">format</span>(offset, <span class="at">scientific =</span> <span class="cn">FALSE</span>)</span>
<span id="cb77-13"><a href="#cb77-13"></a></span>
<span id="cb77-14"><a href="#cb77-14"></a>  content_parsed <span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="fu">paste0</span>(hfx_bike_url, <span class="st">"&amp;resultOffset="</span>, offset)) <span class="sc">%&gt;%</span></span>
<span id="cb77-15"><a href="#cb77-15"></a>    <span class="fu">content</span>(<span class="at">as =</span> <span class="st">"parsed"</span>)</span>
<span id="cb77-16"><a href="#cb77-16"></a></span>
<span id="cb77-17"><a href="#cb77-17"></a>  <span class="fu">map_dfr</span>(</span>
<span id="cb77-18"><a href="#cb77-18"></a>    content_parsed<span class="sc">$</span>features,</span>
<span id="cb77-19"><a href="#cb77-19"></a>    <span class="sc">~</span> <span class="fu">as_tibble</span>(.x<span class="sc">$</span>attributes)</span>
<span id="cb77-20"><a href="#cb77-20"></a>  )</span>
<span id="cb77-21"><a href="#cb77-21"></a>}</span>
<span id="cb77-22"><a href="#cb77-22"></a></span>
<span id="cb77-23"><a href="#cb77-23"></a>n_records <span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="fu">paste0</span>(hfx_bike_url, <span class="st">"&amp;returnCountOnly=true"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb77-24"><a href="#cb77-24"></a>  <span class="fu">content</span>(<span class="at">as =</span> <span class="st">"text"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb77-25"><a href="#cb77-25"></a>  <span class="fu">fromJSON</span>() <span class="sc">%&gt;%</span></span>
<span id="cb77-26"><a href="#cb77-26"></a>  <span class="fu">as.numeric</span>()</span>
<span id="cb77-27"><a href="#cb77-27"></a></span>
<span id="cb77-28"><a href="#cb77-28"></a><span class="fu">message</span>(<span class="st">"Number of bike counter records to collect: "</span>, n_records)</span>
<span id="cb77-29"><a href="#cb77-29"></a><span class="fu">message</span>(<span class="st">"Downloading bike counter data"</span>)</span>
<span id="cb77-30"><a href="#cb77-30"></a>bike_counts <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(</span>
<span id="cb77-31"><a href="#cb77-31"></a>  <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fu">ceiling</span>(n_records <span class="sc">/</span> <span class="dv">2000</span>)),</span>
<span id="cb77-32"><a href="#cb77-32"></a>  <span class="sc">~</span> <span class="fu">get_bike_counts</span>(<span class="at">offset =</span> .x <span class="sc">*</span> <span class="dv">2000</span>)</span>
<span id="cb77-33"><a href="#cb77-33"></a>)</span>
<span id="cb77-34"><a href="#cb77-34"></a></span>
<span id="cb77-35"><a href="#cb77-35"></a>bike_counts_daily <span class="ot">&lt;-</span> bike_counts <span class="sc">%&gt;%</span></span>
<span id="cb77-36"><a href="#cb77-36"></a>  <span class="co"># Timestamps are in Unix time (milliseconds since Jan 1, 1970)</span></span>
<span id="cb77-37"><a href="#cb77-37"></a>  <span class="fu">mutate</span>(<span class="at">count_datetime =</span> <span class="fu">as.POSIXct</span>(COUNT_DATETIME <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb77-38"><a href="#cb77-38"></a>                                     <span class="at">tz =</span> <span class="st">"UTC"</span>, <span class="at">origin =</span> <span class="st">"1970-01-01"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb77-39"><a href="#cb77-39"></a>  <span class="fu">group_by</span>(<span class="at">site_name =</span> SITE_NAME, <span class="at">count_date =</span> <span class="fu">as.Date</span>(count_datetime)) <span class="sc">%&gt;%</span></span>
<span id="cb77-40"><a href="#cb77-40"></a>  <span class="fu">summarise</span>(<span class="at">n_records =</span> <span class="fu">n</span>(), <span class="at">n_bikes =</span> <span class="fu">sum</span>(COUNTER_VALUE),</span>
<span id="cb77-41"><a href="#cb77-41"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb77-42"><a href="#cb77-42"></a>  <span class="fu">filter</span>(</span>
<span id="cb77-43"><a href="#cb77-43"></a>    <span class="co"># Only keep days with a full day of records (24 on Hollis St, 48 others)</span></span>
<span id="cb77-44"><a href="#cb77-44"></a>    <span class="fu">ifelse</span>(site_name <span class="sc">==</span> <span class="st">"Hollis St"</span>, n_records <span class="sc">==</span> <span class="dv">24</span>, n_records <span class="sc">==</span> <span class="dv">48</span>)</span>
<span id="cb77-45"><a href="#cb77-45"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb77-46"><a href="#cb77-46"></a>  <span class="fu">arrange</span>(site_name, count_date) <span class="sc">%&gt;%</span></span>
<span id="cb77-47"><a href="#cb77-47"></a>  <span class="fu">group_by</span>(site_name) <span class="sc">%&gt;%</span></span>
<span id="cb77-48"><a href="#cb77-48"></a>  <span class="fu">mutate</span>(<span class="at">n_bikes_lag_14 =</span> <span class="fu">lag</span>(n_bikes, <span class="dv">14</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb77-49"><a href="#cb77-49"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb77-50"><a href="#cb77-50"></a>  <span class="fu">arrange</span>(count_date, site_name)</span>
<span id="cb77-51"><a href="#cb77-51"></a></span>
<span id="cb77-52"><a href="#cb77-52"></a><span class="fu">message</span>(<span class="st">"Max bike counter date: "</span>, <span class="fu">max</span>(bike_counts_daily<span class="sc">$</span>count_date))</span>
<span id="cb77-53"><a href="#cb77-53"></a></span>
<span id="cb77-54"><a href="#cb77-54"></a><span class="co"># Get weather data --------------------------------------------------------</span></span>
<span id="cb77-55"><a href="#cb77-55"></a></span>
<span id="cb77-56"><a href="#cb77-56"></a>weather_base_url <span class="ot">&lt;-</span></span>
<span id="cb77-57"><a href="#cb77-57"></a>  <span class="st">"https://api.weather.gc.ca/collections/climate-daily/items?f=json&amp;lang=en-CA"</span></span>
<span id="cb77-58"><a href="#cb77-58"></a>get_daily_climate_report_year <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb77-59"><a href="#cb77-59"></a>  station_name, local_year, <span class="at">limit =</span> <span class="dv">10000</span></span>
<span id="cb77-60"><a href="#cb77-60"></a>) {</span>
<span id="cb77-61"><a href="#cb77-61"></a>  weather_query <span class="ot">&lt;-</span> <span class="fu">paste</span>(</span>
<span id="cb77-62"><a href="#cb77-62"></a>    <span class="fu">c</span>(weather_base_url,</span>
<span id="cb77-63"><a href="#cb77-63"></a>      <span class="fu">paste0</span>(<span class="st">"limit="</span>, limit),</span>
<span id="cb77-64"><a href="#cb77-64"></a>      <span class="fu">paste0</span>(<span class="st">"STATION_NAME="</span>, <span class="fu">URLencode</span>(station_name)),</span>
<span id="cb77-65"><a href="#cb77-65"></a>      <span class="fu">paste0</span>(<span class="st">"LOCAL_YEAR="</span>, local_year)),</span>
<span id="cb77-66"><a href="#cb77-66"></a>    <span class="at">collapse =</span> <span class="st">"&amp;"</span></span>
<span id="cb77-67"><a href="#cb77-67"></a>  )</span>
<span id="cb77-68"><a href="#cb77-68"></a>  content_parsed <span class="ot">&lt;-</span> <span class="fu">GET</span>(weather_query) <span class="sc">%&gt;%</span> <span class="fu">content</span>(<span class="at">as =</span> <span class="st">"parsed"</span>)</span>
<span id="cb77-69"><a href="#cb77-69"></a></span>
<span id="cb77-70"><a href="#cb77-70"></a>  <span class="fu">map_dfr</span>(</span>
<span id="cb77-71"><a href="#cb77-71"></a>    content_parsed<span class="sc">$</span>features,</span>
<span id="cb77-72"><a href="#cb77-72"></a>    <span class="sc">~</span> <span class="fu">discard</span>(.x<span class="sc">$</span>properties, is.null) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb77-73"><a href="#cb77-73"></a>  )</span>
<span id="cb77-74"><a href="#cb77-74"></a>}</span>
<span id="cb77-75"><a href="#cb77-75"></a></span>
<span id="cb77-76"><a href="#cb77-76"></a>bike_count_years <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">format</span>(bike_counts_daily<span class="sc">$</span>count_date, <span class="st">"%Y"</span>))</span>
<span id="cb77-77"><a href="#cb77-77"></a></span>
<span id="cb77-78"><a href="#cb77-78"></a><span class="fu">message</span>(<span class="st">"Downloading weather data"</span>)</span>
<span id="cb77-79"><a href="#cb77-79"></a>climate_report_windsor <span class="ot">&lt;-</span></span>
<span id="cb77-80"><a href="#cb77-80"></a>  <span class="fu">map2_dfr</span>(</span>
<span id="cb77-81"><a href="#cb77-81"></a>    <span class="st">"HALIFAX WINDSOR PARK"</span>, bike_count_years,</span>
<span id="cb77-82"><a href="#cb77-82"></a>    get_daily_climate_report_year</span>
<span id="cb77-83"><a href="#cb77-83"></a>  )</span>
<span id="cb77-84"><a href="#cb77-84"></a><span class="co"># Especially in 2022, the Windsor St climate station is missing lots of data.</span></span>
<span id="cb77-85"><a href="#cb77-85"></a><span class="co">#  To supplement it, a more reliable station is the airport.</span></span>
<span id="cb77-86"><a href="#cb77-86"></a><span class="co">#  It is ~30 minutes outside the city, so the weather isn't exactly the same</span></span>
<span id="cb77-87"><a href="#cb77-87"></a><span class="co">#  but should give reasonable imputation of missing values</span></span>
<span id="cb77-88"><a href="#cb77-88"></a>climate_report_airport <span class="ot">&lt;-</span></span>
<span id="cb77-89"><a href="#cb77-89"></a>  <span class="fu">map2_dfr</span>(</span>
<span id="cb77-90"><a href="#cb77-90"></a>    <span class="st">"HALIFAX STANFIELD INT'L A"</span>, bike_count_years,</span>
<span id="cb77-91"><a href="#cb77-91"></a>    get_daily_climate_report_year</span>
<span id="cb77-92"><a href="#cb77-92"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb77-93"><a href="#cb77-93"></a>  <span class="co"># The airport has a few different identifiers, this one seems to have the</span></span>
<span id="cb77-94"><a href="#cb77-94"></a>  <span class="co">#  most non-missing data</span></span>
<span id="cb77-95"><a href="#cb77-95"></a>  <span class="fu">filter</span>(CLIMATE_IDENTIFIER <span class="sc">==</span> <span class="st">"8202251"</span>)</span>
<span id="cb77-96"><a href="#cb77-96"></a></span>
<span id="cb77-97"><a href="#cb77-97"></a>climate_report_daily <span class="ot">&lt;-</span> climate_report_windsor <span class="sc">%&gt;%</span></span>
<span id="cb77-98"><a href="#cb77-98"></a>  <span class="fu">transmute</span>(</span>
<span id="cb77-99"><a href="#cb77-99"></a>    <span class="at">report_date =</span> <span class="fu">as.POSIXct</span>(LOCAL_DATE) <span class="sc">%&gt;%</span> <span class="fu">as.Date</span>(),</span>
<span id="cb77-100"><a href="#cb77-100"></a>    <span class="at">mean_temperature =</span> MEAN_TEMPERATURE,</span>
<span id="cb77-101"><a href="#cb77-101"></a>    <span class="at">total_precipitation =</span> TOTAL_PRECIPITATION,</span>
<span id="cb77-102"><a href="#cb77-102"></a>    <span class="at">snow_on_ground =</span> SNOW_ON_GROUND,</span>
<span id="cb77-103"><a href="#cb77-103"></a>    <span class="at">speed_max_gust =</span> SPEED_MAX_GUST</span>
<span id="cb77-104"><a href="#cb77-104"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb77-105"><a href="#cb77-105"></a>  <span class="fu">full_join</span>(</span>
<span id="cb77-106"><a href="#cb77-106"></a>    climate_report_airport <span class="sc">%&gt;%</span></span>
<span id="cb77-107"><a href="#cb77-107"></a>      <span class="fu">transmute</span>(</span>
<span id="cb77-108"><a href="#cb77-108"></a>        <span class="at">report_date =</span> <span class="fu">as.POSIXct</span>(LOCAL_DATE) <span class="sc">%&gt;%</span> <span class="fu">as.Date</span>(),</span>
<span id="cb77-109"><a href="#cb77-109"></a>        <span class="at">mean_temperature_airport =</span> MEAN_TEMPERATURE,</span>
<span id="cb77-110"><a href="#cb77-110"></a>        <span class="at">total_precipitation_airport =</span> TOTAL_PRECIPITATION,</span>
<span id="cb77-111"><a href="#cb77-111"></a>        <span class="at">snow_on_ground_airport =</span> SNOW_ON_GROUND,</span>
<span id="cb77-112"><a href="#cb77-112"></a>        <span class="at">speed_max_gust_airport =</span> SPEED_MAX_GUST,</span>
<span id="cb77-113"><a href="#cb77-113"></a>      ),</span>
<span id="cb77-114"><a href="#cb77-114"></a>    <span class="at">by =</span> <span class="st">"report_date"</span></span>
<span id="cb77-115"><a href="#cb77-115"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb77-116"><a href="#cb77-116"></a>  <span class="fu">arrange</span>(report_date)</span>
<span id="cb77-117"><a href="#cb77-117"></a></span>
<span id="cb77-118"><a href="#cb77-118"></a><span class="fu">message</span>(<span class="st">"Max weather date: "</span>, <span class="fu">max</span>(climate_report_daily<span class="sc">$</span>report_date))</span>
<span id="cb77-119"><a href="#cb77-119"></a></span>
<span id="cb77-120"><a href="#cb77-120"></a><span class="co"># Upload data -------------------------------------------------------------</span></span>
<span id="cb77-121"><a href="#cb77-121"></a></span>
<span id="cb77-122"><a href="#cb77-122"></a><span class="co"># Authorize to view and manage BigQuery projects</span></span>
<span id="cb77-123"><a href="#cb77-123"></a><span class="fu">bq_auth</span>(<span class="st">"/home/rstudio/oauth-client.json"</span>,</span>
<span id="cb77-124"><a href="#cb77-124"></a>        <span class="at">email =</span> <span class="st">"hfx-bike-ridership@hfx-bike-ridership.iam.gserviceaccount.com"</span>)</span>
<span id="cb77-125"><a href="#cb77-125"></a></span>
<span id="cb77-126"><a href="#cb77-126"></a><span class="co"># Define the project, dataset and a new table for this project</span></span>
<span id="cb77-127"><a href="#cb77-127"></a>project <span class="ot">&lt;-</span> <span class="st">"hfx-bike-ridership"</span></span>
<span id="cb77-128"><a href="#cb77-128"></a></span>
<span id="cb77-129"><a href="#cb77-129"></a>daily_counts_table <span class="ot">&lt;-</span> <span class="fu">bq_table</span>(project, <span class="st">"bike_counts"</span>, <span class="st">"daily_counts"</span>)</span>
<span id="cb77-130"><a href="#cb77-130"></a>weather_table <span class="ot">&lt;-</span> <span class="fu">bq_table</span>(project, <span class="st">"weather"</span>, <span class="st">"daily_report"</span>)</span>
<span id="cb77-131"><a href="#cb77-131"></a></span>
<span id="cb77-132"><a href="#cb77-132"></a><span class="fu">bq_table_upload</span>(daily_counts_table,</span>
<span id="cb77-133"><a href="#cb77-133"></a>                <span class="at">value =</span> bike_counts_daily,</span>
<span id="cb77-134"><a href="#cb77-134"></a>                <span class="at">fields =</span> bike_counts_daily,</span>
<span id="cb77-135"><a href="#cb77-135"></a>                <span class="co"># If table doesn't exist, create it</span></span>
<span id="cb77-136"><a href="#cb77-136"></a>                <span class="at">create_disposition =</span> <span class="st">"CREATE_IF_NEEDED"</span>,</span>
<span id="cb77-137"><a href="#cb77-137"></a>                <span class="co"># If table exists, overwrite it</span></span>
<span id="cb77-138"><a href="#cb77-138"></a>                <span class="at">write_disposition =</span> <span class="st">"WRITE_TRUNCATE"</span>)</span>
<span id="cb77-139"><a href="#cb77-139"></a></span>
<span id="cb77-140"><a href="#cb77-140"></a><span class="fu">bq_table_upload</span>(weather_table,</span>
<span id="cb77-141"><a href="#cb77-141"></a>                <span class="at">value =</span> climate_report_daily,</span>
<span id="cb77-142"><a href="#cb77-142"></a>                <span class="at">fields =</span> climate_report_daily,</span>
<span id="cb77-143"><a href="#cb77-143"></a>                <span class="at">create_disposition =</span> <span class="st">"CREATE_IF_NEEDED"</span>,</span>
<span id="cb77-144"><a href="#cb77-144"></a>                <span class="at">write_disposition =</span> <span class="st">"WRITE_TRUNCATE"</span>)</span>
<span id="cb77-145"><a href="#cb77-145"></a></span>
<span id="cb77-146"><a href="#cb77-146"></a><span class="fu">message</span>(<span class="st">"Finished ETL pipeline"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="etl-pipeline-1" class="slide level2">
<h2>ETL pipeline</h2>
<p><img data-src="images/etl-3.PNG" style="width:150.0%"></p>
<div class="fragment">
<div class="columns">
<div class="column" style="width:50%;">
<p><img data-src="images/etl-1.PNG" style="width:120.0%"></p>
</div><div class="column fragment" style="width:50%;">
<p><img data-src="images/etl-2.PNG" style="width:150.0%"></p>
</div>
</div>
</div>
</section>
<section id="model-training" class="slide level2">
<h2>Model training</h2>
<ul>
<li>At the bottom of the <code>etl.R</code> script:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1"></a><span class="fu">message</span>(<span class="st">"Finished ETL pipeline"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li>A “sink” to look for the message in Cloud logs</li>
</ul>
<p><img data-src="images/pub-sub.PNG" style="width:150.0%"></p>
</div><div class="column fragment" style="width:50%;">
<ul>
<li>A script to fit and save the new model</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb79-2"><a href="#cb79-2"></a><span class="fu">library</span>(readr)</span>
<span id="cb79-3"><a href="#cb79-3"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb79-4"><a href="#cb79-4"></a><span class="fu">library</span>(bigrquery)</span>
<span id="cb79-5"><a href="#cb79-5"></a><span class="fu">library</span>(googleCloudStorageR)</span>
<span id="cb79-6"><a href="#cb79-6"></a><span class="fu">library</span>(googleCloudRunner)</span>
<span id="cb79-7"><a href="#cb79-7"></a><span class="fu">library</span>(plumber)</span>
<span id="cb79-8"><a href="#cb79-8"></a><span class="fu">source</span>(<span class="st">"preprocess.R"</span>)</span>
<span id="cb79-9"><a href="#cb79-9"></a></span>
<span id="cb79-10"><a href="#cb79-10"></a><span class="fu">bq_auth</span>(<span class="at">path =</span> <span class="st">"oauth-client.json"</span>)</span>
<span id="cb79-11"><a href="#cb79-11"></a><span class="fu">gcs_auth</span>(<span class="st">"oauth-client.json"</span>)</span>
<span id="cb79-12"><a href="#cb79-12"></a><span class="fu">gcs_upload_set_limit</span>(20000000L) <span class="co"># 20 Mb</span></span>
<span id="cb79-13"><a href="#cb79-13"></a></span>
<span id="cb79-14"><a href="#cb79-14"></a><span class="co"># This function will retrieve the latest data from BigQuery, the trained</span></span>
<span id="cb79-15"><a href="#cb79-15"></a><span class="co">#  model from GCS, and fit a boosted tree model, which is saved to GCS</span></span>
<span id="cb79-16"><a href="#cb79-16"></a>pub <span class="ot">&lt;-</span> <span class="cf">function</span>(message) {</span>
<span id="cb79-17"><a href="#cb79-17"></a>  <span class="co"># Define the project, dataset and a new table for this project</span></span>
<span id="cb79-18"><a href="#cb79-18"></a>  project <span class="ot">&lt;-</span> <span class="st">"hfx-bike-ridership"</span></span>
<span id="cb79-19"><a href="#cb79-19"></a></span>
<span id="cb79-20"><a href="#cb79-20"></a>  daily_counts_table <span class="ot">&lt;-</span> <span class="fu">bq_table</span>(project, <span class="st">"bike_counts"</span>, <span class="st">"daily_counts"</span>)</span>
<span id="cb79-21"><a href="#cb79-21"></a>  bike_data <span class="ot">&lt;-</span> <span class="fu">bq_table_download</span>(daily_counts_table)</span>
<span id="cb79-22"><a href="#cb79-22"></a>  bike_data_updated <span class="ot">&lt;-</span> <span class="fu">bq_table_meta</span>(daily_counts_table)<span class="sc">$</span>lastModifiedTime <span class="sc">%&gt;%</span></span>
<span id="cb79-23"><a href="#cb79-23"></a>    <span class="fu">as.numeric</span>() <span class="sc">%&gt;%</span></span>
<span id="cb79-24"><a href="#cb79-24"></a>    {<span class="fu">as.POSIXct</span>(. <span class="sc">/</span> <span class="dv">1000</span>, <span class="at">origin =</span> <span class="st">"1970-01-01"</span>)}</span>
<span id="cb79-25"><a href="#cb79-25"></a></span>
<span id="cb79-26"><a href="#cb79-26"></a></span>
<span id="cb79-27"><a href="#cb79-27"></a>  weather_table <span class="ot">&lt;-</span> <span class="fu">bq_table</span>(project, <span class="st">"weather"</span>, <span class="st">"daily_report"</span>)</span>
<span id="cb79-28"><a href="#cb79-28"></a>  weather_data <span class="ot">&lt;-</span> <span class="fu">bq_table_download</span>(weather_table)</span>
<span id="cb79-29"><a href="#cb79-29"></a>  weather_data_updated <span class="ot">&lt;-</span> <span class="fu">bq_table_meta</span>(weather_table)<span class="sc">$</span>lastModifiedTime <span class="sc">%&gt;%</span></span>
<span id="cb79-30"><a href="#cb79-30"></a>    <span class="fu">as.numeric</span>() <span class="sc">%&gt;%</span></span>
<span id="cb79-31"><a href="#cb79-31"></a>    {<span class="fu">as.POSIXct</span>(. <span class="sc">/</span> <span class="dv">1000</span>, <span class="at">origin =</span> <span class="st">"1970-01-01"</span>)}</span>
<span id="cb79-32"><a href="#cb79-32"></a></span>
<span id="cb79-33"><a href="#cb79-33"></a>  bike_data <span class="ot">&lt;-</span> <span class="fu">preprocess</span>(bike_data, weather_data)</span>
<span id="cb79-34"><a href="#cb79-34"></a>  tree_tuned <span class="ot">&lt;-</span> <span class="fu">gcs_get_object</span>(<span class="st">"tune/tree-model-tuned.rds"</span>,</span>
<span id="cb79-35"><a href="#cb79-35"></a>                              <span class="at">bucket =</span> <span class="st">"hfx-bike-ridership-model"</span>,</span>
<span id="cb79-36"><a href="#cb79-36"></a>                              <span class="at">parseFunction =</span> gcs_parse_rds)</span>
<span id="cb79-37"><a href="#cb79-37"></a></span>
<span id="cb79-38"><a href="#cb79-38"></a>  <span class="fu">message</span>(<span class="st">"Writing updating tree-fit"</span>)</span>
<span id="cb79-39"><a href="#cb79-39"></a>  tree_fit <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb79-40"><a href="#cb79-40"></a>    <span class="at">tune_timestamp =</span> tree_tuned<span class="sc">$</span>timestamp,</span>
<span id="cb79-41"><a href="#cb79-41"></a>    <span class="at">timestamp =</span> <span class="fu">Sys.time</span>(),</span>
<span id="cb79-42"><a href="#cb79-42"></a>    <span class="at">bike_data_updated =</span> bike_data_updated,</span>
<span id="cb79-43"><a href="#cb79-43"></a>    <span class="at">weather_data_updated =</span> weather_data_updated,</span>
<span id="cb79-44"><a href="#cb79-44"></a>    <span class="at">bike_tree_fit =</span> <span class="fu">fit</span>(tree_tuned<span class="sc">$</span>bike_tree_fit, bike_data)</span>
<span id="cb79-45"><a href="#cb79-45"></a>  )</span>
<span id="cb79-46"><a href="#cb79-46"></a></span>
<span id="cb79-47"><a href="#cb79-47"></a>  f <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) <span class="fu">write_rds</span>(input, output)</span>
<span id="cb79-48"><a href="#cb79-48"></a>  metadata <span class="ot">&lt;-</span> <span class="fu">gcs_upload</span>(tree_fit, <span class="at">name =</span> <span class="st">"tree-fit.rds"</span>,</span>
<span id="cb79-49"><a href="#cb79-49"></a>                         <span class="at">bucket =</span> <span class="st">"hfx-bike-ridership-model"</span>,</span>
<span id="cb79-50"><a href="#cb79-50"></a>                         <span class="at">object_function =</span> f)</span>
<span id="cb79-51"><a href="#cb79-51"></a></span>
<span id="cb79-52"><a href="#cb79-52"></a>  <span class="fu">return</span>(<span class="cn">TRUE</span>)</span>
<span id="cb79-53"><a href="#cb79-53"></a>}</span>
<span id="cb79-54"><a href="#cb79-54"></a></span>
<span id="cb79-55"><a href="#cb79-55"></a><span class="co">#' Receive pub/sub message</span></span>
<span id="cb79-56"><a href="#cb79-56"></a><span class="co">#' @post /pubsub</span></span>
<span id="cb79-57"><a href="#cb79-57"></a><span class="co">#' @param message a pub/sub message</span></span>
<span id="cb79-58"><a href="#cb79-58"></a><span class="cf">function</span>(<span class="at">message =</span> <span class="cn">NULL</span>) {</span>
<span id="cb79-59"><a href="#cb79-59"></a>  <span class="fu">message</span>(<span class="st">"Received message "</span>, message)</span>
<span id="cb79-60"><a href="#cb79-60"></a>  googleCloudRunner<span class="sc">::</span><span class="fu">cr_plumber_pubsub</span>(message, pub)</span>
<span id="cb79-61"><a href="#cb79-61"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="rest-api" class="slide level2">
<h2>REST API</h2>
<div class="cell">
<details>
<summary>API code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1"></a><span class="co">#* @apiTitle Predict bike ridership in Halifax, NS</span></span>
<span id="cb80-2"><a href="#cb80-2"></a><span class="co">#* @apiDescription This API serves predictions for the daily number of bicyclists passing particular sites around Halifax, Nova Scotia. For more information, check out the [source code](https://github.com/taylordunn/hfx-bike-ridership), my [post about the data](https://tdunn.ca/posts/2022-04-27-predicting-bike-ridership-getting-the-data/), and [my post about developing the model](https://tdunn.ca/posts/2022-04-29-predicting-bike-ridership-developing-a-model/).</span></span>
<span id="cb80-3"><a href="#cb80-3"></a><span class="co">#* @apiContact list(name = "Taylor Dunn", url = "http://www.tdunn.ca", email = "t.dunn19@gmail.com")</span></span>
<span id="cb80-4"><a href="#cb80-4"></a><span class="co">#* @apiVersion 1.0</span></span>
<span id="cb80-5"><a href="#cb80-5"></a></span>
<span id="cb80-6"><a href="#cb80-6"></a><span class="fu">library</span>(plumber)</span>
<span id="cb80-7"><a href="#cb80-7"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb80-8"><a href="#cb80-8"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb80-9"><a href="#cb80-9"></a><span class="fu">library</span>(bigrquery)</span>
<span id="cb80-10"><a href="#cb80-10"></a><span class="fu">library</span>(googleCloudStorageR)</span>
<span id="cb80-11"><a href="#cb80-11"></a></span>
<span id="cb80-12"><a href="#cb80-12"></a><span class="fu">bq_auth</span>(<span class="at">path =</span> <span class="st">"oauth-client.json"</span>,</span>
<span id="cb80-13"><a href="#cb80-13"></a>        <span class="at">email =</span> <span class="st">"hfx-bike-ridership@hfx-bike-ridership.iam.gserviceaccount.com"</span>)</span>
<span id="cb80-14"><a href="#cb80-14"></a><span class="fu">gcs_auth</span>(<span class="st">"oauth-client.json"</span>)</span>
<span id="cb80-15"><a href="#cb80-15"></a></span>
<span id="cb80-16"><a href="#cb80-16"></a>project <span class="ot">&lt;-</span> <span class="st">"hfx-bike-ridership"</span></span>
<span id="cb80-17"><a href="#cb80-17"></a></span>
<span id="cb80-18"><a href="#cb80-18"></a><span class="fu">message</span>(<span class="st">"Reading data"</span>)</span>
<span id="cb80-19"><a href="#cb80-19"></a>daily_counts_table <span class="ot">&lt;-</span> <span class="fu">bq_table</span>(project, <span class="st">"bike_counts"</span>, <span class="st">"daily_counts"</span>)</span>
<span id="cb80-20"><a href="#cb80-20"></a>bike_data <span class="ot">&lt;-</span> <span class="fu">bq_table_download</span>(daily_counts_table)</span>
<span id="cb80-21"><a href="#cb80-21"></a></span>
<span id="cb80-22"><a href="#cb80-22"></a><span class="fu">message</span>(<span class="st">"Loading model"</span>)</span>
<span id="cb80-23"><a href="#cb80-23"></a>boost_fit <span class="ot">&lt;-</span> <span class="fu">gcs_get_object</span>(<span class="st">"boost-fit.rds"</span>, <span class="at">bucket =</span> <span class="st">"hfx-bike-ridership-model"</span>,</span>
<span id="cb80-24"><a href="#cb80-24"></a>                          <span class="at">parseFunction =</span> gcs_parse_rds)</span>
<span id="cb80-25"><a href="#cb80-25"></a></span>
<span id="cb80-26"><a href="#cb80-26"></a>site_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Dartmouth Harbourfront Greenway"</span>, <span class="st">"Hollis St"</span>,</span>
<span id="cb80-27"><a href="#cb80-27"></a>                <span class="st">"South Park St"</span>, <span class="st">"Vernon St"</span>, <span class="st">"Windsor St"</span>)</span>
<span id="cb80-28"><a href="#cb80-28"></a></span>
<span id="cb80-29"><a href="#cb80-29"></a><span class="co">#* @param count_date:str The date in YYYY-MM-DD format.</span></span>
<span id="cb80-30"><a href="#cb80-30"></a><span class="co">#* @param site_name:[str] The location of the bike counter. One of "Dartmouth Harbourfront Greenway", "Hollis St", "South Park St", "Vernon St", "Windsor St".</span></span>
<span id="cb80-31"><a href="#cb80-31"></a><span class="co">#* @param n_bikes_lag_14:[int] The number of bikes measured at the given `site_name` 14 days ago. If not provided, will attempt to impute with the actual value 14 days before `count_date`.</span></span>
<span id="cb80-32"><a href="#cb80-32"></a><span class="co">#* @param mean_temperature:numeric The daily mean temperature. If not provided, will impute with the rolling mean.</span></span>
<span id="cb80-33"><a href="#cb80-33"></a><span class="co">#* @param total_precipitation:numeric The daily amount of precipitation in mm. If not provided, will impute with zero.</span></span>
<span id="cb80-34"><a href="#cb80-34"></a><span class="co">#* @param snow_on_ground:numeric The daily amount of snow on the ground in cm. If not provided, will impute with zero.</span></span>
<span id="cb80-35"><a href="#cb80-35"></a><span class="co">#* @param speed_max_gust:numeric The daily maximum wind speed in km/h. If not provided, will impute with the mean in the training set.</span></span>
<span id="cb80-36"><a href="#cb80-36"></a><span class="co">#* @get /n_bikes</span></span>
<span id="cb80-37"><a href="#cb80-37"></a><span class="cf">function</span>(count_date, <span class="at">site_name =</span> <span class="cn">NA_character_</span>, <span class="at">n_bikes_lag_14 =</span> <span class="cn">NA_integer_</span>,</span>
<span id="cb80-38"><a href="#cb80-38"></a>         <span class="at">mean_temperature =</span> <span class="cn">NA_real_</span>, <span class="at">total_precipitation =</span> <span class="cn">NA_real_</span>,</span>
<span id="cb80-39"><a href="#cb80-39"></a>         <span class="at">snow_on_ground =</span> <span class="cn">NA_real_</span>, <span class="at">speed_max_gust =</span> <span class="cn">NA_real_</span>) {</span>
<span id="cb80-40"><a href="#cb80-40"></a></span>
<span id="cb80-41"><a href="#cb80-41"></a>  <span class="co"># If not provided, use all `site_name`s</span></span>
<span id="cb80-42"><a href="#cb80-42"></a>  <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(site_name))) {</span>
<span id="cb80-43"><a href="#cb80-43"></a>    site_name <span class="ot">&lt;-</span> site_names</span>
<span id="cb80-44"><a href="#cb80-44"></a>  } <span class="cf">else</span> {</span>
<span id="cb80-45"><a href="#cb80-45"></a>    site_name <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(</span>
<span id="cb80-46"><a href="#cb80-46"></a>      site_name, <span class="at">choices =</span> site_names, <span class="at">several.ok =</span> <span class="cn">TRUE</span></span>
<span id="cb80-47"><a href="#cb80-47"></a>    )</span>
<span id="cb80-48"><a href="#cb80-48"></a>  }</span>
<span id="cb80-49"><a href="#cb80-49"></a></span>
<span id="cb80-50"><a href="#cb80-50"></a>  count_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(count_date)</span>
<span id="cb80-51"><a href="#cb80-51"></a></span>
<span id="cb80-52"><a href="#cb80-52"></a>  <span class="co"># Get the 14-day lagged bike counts for each site</span></span>
<span id="cb80-53"><a href="#cb80-53"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(n_bikes_lag_14) <span class="sc">&amp;</span> <span class="fu">length</span>(site_name) <span class="sc">!=</span> <span class="fu">length</span>(n_bikes_lag_14)) {</span>
<span id="cb80-54"><a href="#cb80-54"></a>    <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb80-55"><a href="#cb80-55"></a>      <span class="at">status =</span> <span class="dv">400</span>,</span>
<span id="cb80-56"><a href="#cb80-56"></a>      <span class="at">message =</span> <span class="st">"Must provide a value of `n_bikes_lag_14` for every given `site_name`."</span></span>
<span id="cb80-57"><a href="#cb80-57"></a>    ))</span>
<span id="cb80-58"><a href="#cb80-58"></a>  } <span class="cf">else</span> {</span>
<span id="cb80-59"><a href="#cb80-59"></a>    d <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">site_name =</span> .env<span class="sc">$</span>site_name, <span class="at">count_date =</span> .env<span class="sc">$</span>count_date,</span>
<span id="cb80-60"><a href="#cb80-60"></a>                <span class="at">count_date_lag_14 =</span> count_date <span class="sc">-</span> <span class="dv">14</span>,</span>
<span id="cb80-61"><a href="#cb80-61"></a>                <span class="at">n_bikes_lag_14 =</span> .env<span class="sc">$</span>n_bikes_lag_14)</span>
<span id="cb80-62"><a href="#cb80-62"></a></span>
<span id="cb80-63"><a href="#cb80-63"></a>    <span class="cf">if</span> (<span class="fu">sum</span>(<span class="fu">is.na</span>(d<span class="sc">$</span>n_bikes_lag_14)) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb80-64"><a href="#cb80-64"></a>      <span class="fu">message</span>(<span class="st">"Imputing `n_bikes_lag_14`"</span>)</span>
<span id="cb80-65"><a href="#cb80-65"></a>      d <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span></span>
<span id="cb80-66"><a href="#cb80-66"></a>        <span class="fu">left_join</span>(</span>
<span id="cb80-67"><a href="#cb80-67"></a>          bike_data <span class="sc">%&gt;%</span></span>
<span id="cb80-68"><a href="#cb80-68"></a>            <span class="fu">select</span>(site_name, <span class="at">count_date_lag_14 =</span> count_date,</span>
<span id="cb80-69"><a href="#cb80-69"></a>                   <span class="at">n_bikes_lag_14_impute =</span> n_bikes),</span>
<span id="cb80-70"><a href="#cb80-70"></a>          <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"site_name"</span>, <span class="st">"count_date_lag_14"</span>)</span>
<span id="cb80-71"><a href="#cb80-71"></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb80-72"><a href="#cb80-72"></a>        <span class="fu">mutate</span>(</span>
<span id="cb80-73"><a href="#cb80-73"></a>          <span class="at">n_bikes_lag_14 =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(n_bikes_lag_14),</span>
<span id="cb80-74"><a href="#cb80-74"></a>                                  n_bikes_lag_14_impute, n_bikes_lag_14)</span>
<span id="cb80-75"><a href="#cb80-75"></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb80-76"><a href="#cb80-76"></a>        <span class="fu">select</span>(<span class="sc">-</span>n_bikes_lag_14_impute)</span>
<span id="cb80-77"><a href="#cb80-77"></a></span>
<span id="cb80-78"><a href="#cb80-78"></a>      <span class="cf">if</span> (<span class="fu">sum</span>(<span class="fu">is.na</span>(d<span class="sc">$</span>n_bikes_lag_14)) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb80-79"><a href="#cb80-79"></a>        <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb80-80"><a href="#cb80-80"></a>          <span class="at">status =</span> <span class="dv">400</span>,</span>
<span id="cb80-81"><a href="#cb80-81"></a>          <span class="at">message =</span> <span class="fu">paste0</span>(</span>
<span id="cb80-82"><a href="#cb80-82"></a>            <span class="st">"Could not find `n_bikes_lag_14` values on date "</span>, count_date,</span>
<span id="cb80-83"><a href="#cb80-83"></a>            <span class="st">" for these sites "</span>,</span>
<span id="cb80-84"><a href="#cb80-84"></a>            <span class="fu">filter</span>(d, <span class="fu">is.na</span>(n_bikes_lag_14)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(site_name) <span class="sc">%&gt;%</span> <span class="fu">paste</span>(<span class="at">collapse =</span> <span class="st">", "</span>),</span>
<span id="cb80-85"><a href="#cb80-85"></a>            <span class="st">". Please provide your own `n_bikes_lag_14`, or choose a different `count_date`."</span></span>
<span id="cb80-86"><a href="#cb80-86"></a>          )</span>
<span id="cb80-87"><a href="#cb80-87"></a>        ))</span>
<span id="cb80-88"><a href="#cb80-88"></a>      }</span>
<span id="cb80-89"><a href="#cb80-89"></a>    }</span>
<span id="cb80-90"><a href="#cb80-90"></a>  }</span>
<span id="cb80-91"><a href="#cb80-91"></a></span>
<span id="cb80-92"><a href="#cb80-92"></a>  <span class="co"># Add weather variables</span></span>
<span id="cb80-93"><a href="#cb80-93"></a>  d <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span></span>
<span id="cb80-94"><a href="#cb80-94"></a>    <span class="fu">mutate</span>(</span>
<span id="cb80-95"><a href="#cb80-95"></a>      <span class="at">n_bikes_lag_14 =</span> <span class="fu">as.numeric</span>(n_bikes_lag_14),</span>
<span id="cb80-96"><a href="#cb80-96"></a>      <span class="at">mean_temperature =</span> <span class="fu">as.numeric</span>(mean_temperature),</span>
<span id="cb80-97"><a href="#cb80-97"></a>      <span class="at">total_precipitation =</span> <span class="fu">as.numeric</span>(total_precipitation),</span>
<span id="cb80-98"><a href="#cb80-98"></a>      <span class="at">snow_on_ground =</span> <span class="fu">as.numeric</span>(snow_on_ground),</span>
<span id="cb80-99"><a href="#cb80-99"></a>      <span class="at">speed_max_gust =</span> <span class="fu">as.numeric</span>(speed_max_gust)</span>
<span id="cb80-100"><a href="#cb80-100"></a>    )</span>
<span id="cb80-101"><a href="#cb80-101"></a></span>
<span id="cb80-102"><a href="#cb80-102"></a>  <span class="fu">augment</span>(boost_fit<span class="sc">$</span>bike_boost_fit, d)</span>
<span id="cb80-103"><a href="#cb80-103"></a>}</span>
<span id="cb80-104"><a href="#cb80-104"></a></span>
<span id="cb80-105"><a href="#cb80-105"></a><span class="co">#* @get /model_info</span></span>
<span id="cb80-106"><a href="#cb80-106"></a><span class="co">#* @response 200 Returns model information: timestamps of when the model was last trained (`timestamp`), the model was last tuned (`tune_timestamp`), the bicycle data was last updated (`bike_data_updated`), the weather data was last updated (`weather_data_updated`).</span></span>
<span id="cb80-107"><a href="#cb80-107"></a><span class="cf">function</span>() {</span>
<span id="cb80-108"><a href="#cb80-108"></a>  <span class="fu">list</span>(</span>
<span id="cb80-109"><a href="#cb80-109"></a>    <span class="at">timestamp =</span> boost_fit<span class="sc">$</span>timestamp,</span>
<span id="cb80-110"><a href="#cb80-110"></a>    <span class="at">tune_timestamp =</span> boost_fit<span class="sc">$</span>tune_timestamp,</span>
<span id="cb80-111"><a href="#cb80-111"></a>    <span class="at">bike_data_updated =</span> boost_fit<span class="sc">$</span>bike_data_updated,</span>
<span id="cb80-112"><a href="#cb80-112"></a>    <span class="at">weather_data_updated =</span> boost_fit<span class="sc">$</span>weather_data_updated</span>
<span id="cb80-113"><a href="#cb80-113"></a>  )</span>
<span id="cb80-114"><a href="#cb80-114"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>Containerized the API and placed on Cloud Run</li>
</ul>

<img data-src="images/cloud-run.PNG" class="r-stretch"></section>
<section id="rest-api-1" class="slide level2">
<h2>REST API</h2>
<ul>
<li>Anyone can request predictions!</li>
</ul>
<div class="fragment">
<div class="cell" data-hash="hfx-bike-ridership_cache/revealjs/unnamed-chunk-101_671cbf9cdcddeeb88e029c3c8b0761e2">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1"></a>base_url <span class="ot">&lt;-</span> <span class="st">"https://hfx-bike-ridership-api-74govvz7xq-uc.a.run.app/"</span></span>
<span id="cb81-2"><a href="#cb81-2"></a>query <span class="ot">&lt;-</span> <span class="st">"n_bikes?count_date=2022-05-23&amp;site_name=Hollis St"</span></span>
<span id="cb81-3"><a href="#cb81-3"></a></span>
<span id="cb81-4"><a href="#cb81-4"></a>httr<span class="sc">::</span><span class="fu">GET</span>(<span class="fu">URLencode</span>(<span class="fu">paste0</span>(base_url, query))) <span class="sc">%&gt;%</span></span>
<span id="cb81-5"><a href="#cb81-5"></a>  <span class="fu">content</span>(<span class="at">as =</span> <span class="st">"parsed"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-6"><a href="#cb81-6"></a>  purrr<span class="sc">::</span><span class="fu">flatten</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$site_name
[1] "Hollis St"

$count_date
[1] "2022-05-23"

$count_date_lag_14
[1] "2022-05-09"

$n_bikes_lag_14
[1] 86

$.pred
[1] 31.7453</code></pre>
</div>
</div>
</div>
<div class="fragment">
<ul>
<li>Or use the web interface: <a href="https://hfx-bike-ridership-api-74govvz7xq-uc.a.run.app/__docs__/">https://hfx-bike-ridership-api-74govvz7xq-uc.a.run.app/<strong>docs</strong>/</a></li>
</ul>
</div>
</section>
<section id="shiny-dashboard" class="slide level2">
<h2>Shiny dashboard</h2>
<div class="cell">
<details>
<summary>App code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb83-2"><a href="#cb83-2"></a><span class="fu">library</span>(shinydashboard)</span>
<span id="cb83-3"><a href="#cb83-3"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb83-4"><a href="#cb83-4"></a><span class="fu">library</span>(readr)</span>
<span id="cb83-5"><a href="#cb83-5"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb83-6"><a href="#cb83-6"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb83-7"><a href="#cb83-7"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb83-8"><a href="#cb83-8"></a><span class="fu">library</span>(workflows)</span>
<span id="cb83-9"><a href="#cb83-9"></a><span class="fu">library</span>(bigrquery)</span>
<span id="cb83-10"><a href="#cb83-10"></a><span class="fu">library</span>(googleCloudStorageR)</span>
<span id="cb83-11"><a href="#cb83-11"></a><span class="fu">library</span>(DT)</span>
<span id="cb83-12"><a href="#cb83-12"></a><span class="fu">library</span>(dunnr)</span>
<span id="cb83-13"><a href="#cb83-13"></a><span class="fu">source</span>(<span class="st">"funcs.R"</span>)</span>
<span id="cb83-14"><a href="#cb83-14"></a></span>
<span id="cb83-15"><a href="#cb83-15"></a><span class="fu">library</span>(showtext)</span>
<span id="cb83-16"><a href="#cb83-16"></a>sysfonts<span class="sc">::</span><span class="fu">font_add_google</span>(<span class="st">"Roboto Condensed"</span>)</span>
<span id="cb83-17"><a href="#cb83-17"></a><span class="fu">showtext_auto</span>()</span>
<span id="cb83-18"><a href="#cb83-18"></a><span class="fu">theme_set</span>(<span class="fu">theme_td</span>(<span class="at">base_size =</span> <span class="dv">14</span>))</span>
<span id="cb83-19"><a href="#cb83-19"></a><span class="fu">set_geom_fonts</span>()</span>
<span id="cb83-20"><a href="#cb83-20"></a><span class="fu">set_palette</span>()</span>
<span id="cb83-21"><a href="#cb83-21"></a></span>
<span id="cb83-22"><a href="#cb83-22"></a>project <span class="ot">&lt;-</span> <span class="st">"hfx-bike-ridership"</span></span>
<span id="cb83-23"><a href="#cb83-23"></a><span class="fu">bq_auth</span>(<span class="at">path =</span> <span class="st">"oauth-client.json"</span>)</span>
<span id="cb83-24"><a href="#cb83-24"></a><span class="fu">gcs_auth</span>(<span class="st">"oauth-client.json"</span>)</span>
<span id="cb83-25"><a href="#cb83-25"></a></span>
<span id="cb83-26"><a href="#cb83-26"></a>bike_counts_table <span class="ot">&lt;-</span> <span class="fu">bq_table</span>(project, <span class="st">"bike_counts"</span>, <span class="st">"daily_counts"</span>)</span>
<span id="cb83-27"><a href="#cb83-27"></a>weather_table <span class="ot">&lt;-</span> <span class="fu">bq_table</span>(project, <span class="st">"weather"</span>, <span class="st">"daily_report"</span>)</span>
<span id="cb83-28"><a href="#cb83-28"></a></span>
<span id="cb83-29"><a href="#cb83-29"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb83-30"><a href="#cb83-30"></a>  <span class="co"># Import data and model ---------------------------------------------------</span></span>
<span id="cb83-31"><a href="#cb83-31"></a>  data <span class="ot">&lt;-</span> <span class="fu">reactiveValues</span>()</span>
<span id="cb83-32"><a href="#cb83-32"></a>  min_date <span class="ot">&lt;-</span> <span class="fu">reactiveVal</span>()</span>
<span id="cb83-33"><a href="#cb83-33"></a>  max_date <span class="ot">&lt;-</span> <span class="fu">reactiveVal</span>()</span>
<span id="cb83-34"><a href="#cb83-34"></a>  model <span class="ot">&lt;-</span> <span class="fu">reactiveVal</span>()</span>
<span id="cb83-35"><a href="#cb83-35"></a></span>
<span id="cb83-36"><a href="#cb83-36"></a>  <span class="fu">observe</span>({</span>
<span id="cb83-37"><a href="#cb83-37"></a>    <span class="co"># Re-reads data every hour</span></span>
<span id="cb83-38"><a href="#cb83-38"></a>    <span class="fu">invalidateLater</span>(<span class="dv">1000</span> <span class="sc">*</span> <span class="dv">60</span> <span class="sc">*</span> <span class="dv">60</span>)</span>
<span id="cb83-39"><a href="#cb83-39"></a>    <span class="fu">message</span>(<span class="st">"Reading data and model"</span>)</span>
<span id="cb83-40"><a href="#cb83-40"></a></span>
<span id="cb83-41"><a href="#cb83-41"></a>    bike_data_raw <span class="ot">&lt;-</span> <span class="fu">bq_table_download</span>(bike_counts_table)</span>
<span id="cb83-42"><a href="#cb83-42"></a>    weather_data_raw <span class="ot">&lt;-</span> <span class="fu">bq_table_download</span>(weather_table)</span>
<span id="cb83-43"><a href="#cb83-43"></a>    <span class="fu">model</span>(<span class="fu">gcs_get_object</span>(<span class="st">"xgb-fit.rds"</span>,</span>
<span id="cb83-44"><a href="#cb83-44"></a>                         <span class="at">bucket =</span> <span class="st">"hfx-bike-ridership-model"</span>,</span>
<span id="cb83-45"><a href="#cb83-45"></a>                         <span class="at">parseFunction =</span> gcs_parse_rds))</span>
<span id="cb83-46"><a href="#cb83-46"></a></span>
<span id="cb83-47"><a href="#cb83-47"></a>    bike_data <span class="ot">&lt;-</span> bike_data_raw <span class="sc">%&gt;%</span></span>
<span id="cb83-48"><a href="#cb83-48"></a>      <span class="fu">preprocess_bike_data</span>() <span class="sc">%&gt;%</span></span>
<span id="cb83-49"><a href="#cb83-49"></a>      <span class="co"># Only include the last 14 days</span></span>
<span id="cb83-50"><a href="#cb83-50"></a>      <span class="fu">filter</span>(count_date <span class="sc">&gt;=</span> <span class="fu">max</span>(count_date) <span class="sc">-</span> <span class="dv">13</span>)</span>
<span id="cb83-51"><a href="#cb83-51"></a>    <span class="fu">min_date</span>(<span class="fu">min</span>(bike_data<span class="sc">$</span>count_date))</span>
<span id="cb83-52"><a href="#cb83-52"></a>    <span class="fu">max_date</span>(<span class="fu">max</span>(bike_data<span class="sc">$</span>count_date))</span>
<span id="cb83-53"><a href="#cb83-53"></a>    bike_data_future <span class="ot">&lt;-</span> bike_data <span class="sc">%&gt;%</span></span>
<span id="cb83-54"><a href="#cb83-54"></a>      <span class="fu">transmute</span>(</span>
<span id="cb83-55"><a href="#cb83-55"></a>        <span class="at">count_date =</span> count_date <span class="sc">+</span> <span class="dv">14</span>, site_name, <span class="at">n_bikes_lag_14 =</span> n_bikes</span>
<span id="cb83-56"><a href="#cb83-56"></a>      )</span>
<span id="cb83-57"><a href="#cb83-57"></a></span>
<span id="cb83-58"><a href="#cb83-58"></a>    weather_data <span class="ot">&lt;-</span> weather_data_raw <span class="sc">%&gt;%</span></span>
<span id="cb83-59"><a href="#cb83-59"></a>      <span class="fu">preprocess_weather_data</span>() <span class="sc">%&gt;%</span></span>
<span id="cb83-60"><a href="#cb83-60"></a>      <span class="fu">filter</span>(report_date <span class="sc">&gt;=</span> <span class="fu">min</span>(bike_data<span class="sc">$</span>count_date),</span>
<span id="cb83-61"><a href="#cb83-61"></a>             report_date <span class="sc">&lt;=</span> <span class="fu">max</span>(bike_data<span class="sc">$</span>count_date))</span>
<span id="cb83-62"><a href="#cb83-62"></a>    weather_data_future <span class="ot">&lt;-</span> weather_data <span class="sc">%&gt;%</span></span>
<span id="cb83-63"><a href="#cb83-63"></a>      <span class="fu">transmute</span>(</span>
<span id="cb83-64"><a href="#cb83-64"></a>        <span class="at">report_date =</span> report_date <span class="sc">+</span> <span class="dv">14</span>,</span>
<span id="cb83-65"><a href="#cb83-65"></a>        <span class="co"># Impute temperature and wind speed with the mean</span></span>
<span id="cb83-66"><a href="#cb83-66"></a>        <span class="at">mean_temperature =</span> <span class="fu">round</span>(<span class="fu">mean</span>(weather_data<span class="sc">$</span>mean_temperature,</span>
<span id="cb83-67"><a href="#cb83-67"></a>                                      <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">1</span>),</span>
<span id="cb83-68"><a href="#cb83-68"></a>        <span class="at">speed_max_gust =</span> <span class="fu">round</span>(<span class="fu">mean</span>(weather_data<span class="sc">$</span>speed_max_gust,</span>
<span id="cb83-69"><a href="#cb83-69"></a>                                    <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb83-70"><a href="#cb83-70"></a>        <span class="co"># Impute precipitation and snow with zero</span></span>
<span id="cb83-71"><a href="#cb83-71"></a>        <span class="at">total_precipitation =</span> <span class="dv">0</span>, <span class="at">snow_on_ground =</span> <span class="dv">0</span></span>
<span id="cb83-72"><a href="#cb83-72"></a>      )</span>
<span id="cb83-73"><a href="#cb83-73"></a></span>
<span id="cb83-74"><a href="#cb83-74"></a>    data<span class="sc">$</span>bike <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(bike_data, bike_data_future)</span>
<span id="cb83-75"><a href="#cb83-75"></a>    data<span class="sc">$</span>weather <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(weather_data, weather_data_future)</span>
<span id="cb83-76"><a href="#cb83-76"></a>  })</span>
<span id="cb83-77"><a href="#cb83-77"></a></span>
<span id="cb83-78"><a href="#cb83-78"></a>  bike_weather_data <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb83-79"><a href="#cb83-79"></a>    data<span class="sc">$</span>bike <span class="sc">%&gt;%</span></span>
<span id="cb83-80"><a href="#cb83-80"></a>      <span class="fu">left_join</span>(data<span class="sc">$</span>weather, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"count_date"</span> <span class="ot">=</span> <span class="st">"report_date"</span>))</span>
<span id="cb83-81"><a href="#cb83-81"></a>  })</span>
<span id="cb83-82"><a href="#cb83-82"></a></span>
<span id="cb83-83"><a href="#cb83-83"></a>  <span class="co"># Model info --------------------------------------------------------------</span></span>
<span id="cb83-84"><a href="#cb83-84"></a>  output<span class="sc">$</span>model_info_1 <span class="ot">&lt;-</span> <span class="fu">renderText</span>({</span>
<span id="cb83-85"><a href="#cb83-85"></a>    <span class="fu">HTML</span>(</span>
<span id="cb83-86"><a href="#cb83-86"></a>      <span class="fu">paste</span>(</span>
<span id="cb83-87"><a href="#cb83-87"></a>        <span class="st">"This Shiny app visualizes predictions of the daily number of bicyclists passing various bike counter sites around Halifax, Nova Scotia, in a four-week window."</span>,</span>
<span id="cb83-88"><a href="#cb83-88"></a>        <span class="st">"Check out the &lt;a href='https://github.com/taylordunn/hfx-bike-ridership'&gt;source code here&lt;/a&gt;, and &lt;a href='https://tdunn.ca/posts/2022-05-19-predicting-bike-ridership-deploying-the-model/'&gt;this write-up&lt;/a&gt; for more information."</span>,</span>
<span id="cb83-89"><a href="#cb83-89"></a>        <span class="fu">paste0</span>(<span class="st">"&lt;br&gt;Data are updated, and the model is re-trained on a schedule: currently every Sunday at midnight AST, and sometimes manually by me. "</span>,</span>
<span id="cb83-90"><a href="#cb83-90"></a>               <span class="st">"The current data go up to "</span>,</span>
<span id="cb83-91"><a href="#cb83-91"></a>               <span class="st">"&lt;b&gt;"</span>, <span class="fu">max_date</span>(), <span class="st">"&lt;/b&gt;"</span>,</span>
<span id="cb83-92"><a href="#cb83-92"></a>               <span class="st">" as indicated by the vertical dashed line in the plots."</span>),</span>
<span id="cb83-93"><a href="#cb83-93"></a>        <span class="st">"&lt;br&gt;The locations of the sites are overlaid on a map of Halifax below:"</span>,</span>
<span id="cb83-94"><a href="#cb83-94"></a>        <span class="at">sep =</span> <span class="st">"&lt;br&gt;"</span></span>
<span id="cb83-95"><a href="#cb83-95"></a>      )</span>
<span id="cb83-96"><a href="#cb83-96"></a>    )</span>
<span id="cb83-97"><a href="#cb83-97"></a>  })</span>
<span id="cb83-98"><a href="#cb83-98"></a></span>
<span id="cb83-99"><a href="#cb83-99"></a>  output<span class="sc">$</span>model_info_2 <span class="ot">&lt;-</span> <span class="fu">renderText</span>({</span>
<span id="cb83-100"><a href="#cb83-100"></a>    <span class="fu">HTML</span>(</span>
<span id="cb83-101"><a href="#cb83-101"></a>      <span class="fu">paste</span>(</span>
<span id="cb83-102"><a href="#cb83-102"></a>        <span class="st">"&lt;br&gt;"</span>,</span>
<span id="cb83-103"><a href="#cb83-103"></a>        <span class="st">"In addition to site, other features of the model are:"</span>,</span>
<span id="cb83-104"><a href="#cb83-104"></a>        <span class="fu">paste0</span>(<span class="st">"&lt;ul&gt;"</span>,</span>
<span id="cb83-105"><a href="#cb83-105"></a>               <span class="st">"&lt;li&gt;date features: day of week, day of year, year, and Canadian holidays&lt;/li&gt;"</span>,</span>
<span id="cb83-106"><a href="#cb83-106"></a>               <span class="st">"&lt;li&gt;the number of bikes counted 14 days ago&lt;/li&gt;"</span>,</span>
<span id="cb83-107"><a href="#cb83-107"></a>               <span class="st">"&lt;li&gt;weather features: daily mean temperature, total precipitation, maximum gust speed, and snow on the ground"</span>,</span>
<span id="cb83-108"><a href="#cb83-108"></a>               <span class="st">"&lt;/ul&gt;"</span>),</span>
<span id="cb83-109"><a href="#cb83-109"></a>        <span class="st">"See more information about the features and how missing data are handled &lt;a href='https://tdunn.ca/posts/2022-04-29-predicting-bike-ridership-developing-a-model/'&gt;in this post&lt;/a&gt;."</span>,</span>
<span id="cb83-110"><a href="#cb83-110"></a>        <span class="st">"&lt;br&gt;"</span></span>
<span id="cb83-111"><a href="#cb83-111"></a>      )</span>
<span id="cb83-112"><a href="#cb83-112"></a>    )</span>
<span id="cb83-113"><a href="#cb83-113"></a>  })</span>
<span id="cb83-114"><a href="#cb83-114"></a></span>
<span id="cb83-115"><a href="#cb83-115"></a>  <span class="co"># Plotting helpers --------------------------------------------------------</span></span>
<span id="cb83-116"><a href="#cb83-116"></a>  scale_x <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb83-117"><a href="#cb83-117"></a>    <span class="fu">scale_x_date</span>(<span class="cn">NULL</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="fu">min_date</span>() <span class="sc">-</span> <span class="dv">1</span>, <span class="fu">max_date</span>() <span class="sc">+</span> <span class="dv">14</span>),</span>
<span id="cb83-118"><a href="#cb83-118"></a>                 <span class="at">breaks =</span> <span class="fu">seq.Date</span>(<span class="fu">min_date</span>() <span class="sc">-</span> <span class="dv">1</span>, <span class="fu">max_date</span>() <span class="sc">+</span> <span class="dv">14</span>, <span class="st">"7 days"</span>),</span>
<span id="cb83-119"><a href="#cb83-119"></a>                 <span class="at">date_labels =</span> <span class="st">"%b %d"</span>)</span>
<span id="cb83-120"><a href="#cb83-120"></a>  })</span>
<span id="cb83-121"><a href="#cb83-121"></a>  vline <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb83-122"><a href="#cb83-122"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">max_date</span>(), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">size =</span> <span class="dv">1</span>)</span>
<span id="cb83-123"><a href="#cb83-123"></a>  })</span>
<span id="cb83-124"><a href="#cb83-124"></a></span>
<span id="cb83-125"><a href="#cb83-125"></a>  <span class="co"># Bike predictions --------------------------------------------------------</span></span>
<span id="cb83-126"><a href="#cb83-126"></a>  output<span class="sc">$</span>n_bikes_plot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb83-127"><a href="#cb83-127"></a>    workflows<span class="sc">:::</span><span class="fu">augment.workflow</span>(<span class="fu">model</span>()<span class="sc">$</span>bike_xgb_fit,</span>
<span id="cb83-128"><a href="#cb83-128"></a>                                 <span class="fu">bike_weather_data</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb83-129"><a href="#cb83-129"></a>      <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> count_date)) <span class="sc">+</span></span>
<span id="cb83-130"><a href="#cb83-130"></a>      <span class="fu">vline</span>() <span class="sc">+</span></span>
<span id="cb83-131"><a href="#cb83-131"></a>      <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .pred), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb83-132"><a href="#cb83-132"></a>      <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> n_bikes, <span class="at">fill =</span> site_name),</span>
<span id="cb83-133"><a href="#cb83-133"></a>                 <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb83-134"><a href="#cb83-134"></a>      <span class="fu">facet_wrap</span>(<span class="sc">~</span> site_name, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb83-135"><a href="#cb83-135"></a>      <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb83-136"><a href="#cb83-136"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb83-137"><a href="#cb83-137"></a>      <span class="fu">scale_x</span>() <span class="sc">+</span></span>
<span id="cb83-138"><a href="#cb83-138"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Number of bikes vs date"</span>,</span>
<span id="cb83-139"><a href="#cb83-139"></a>           <span class="at">subtitle =</span> <span class="st">"Coloured points show actual values, black lines are predictions"</span>) <span class="sc">+</span></span>
<span id="cb83-140"><a href="#cb83-140"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb83-141"><a href="#cb83-141"></a>      dunnr<span class="sc">::</span><span class="fu">add_facet_borders</span>()</span>
<span id="cb83-142"><a href="#cb83-142"></a>  })</span>
<span id="cb83-143"><a href="#cb83-143"></a></span>
<span id="cb83-144"><a href="#cb83-144"></a>  <span class="co"># Weather data ------------------------------------------------------------</span></span>
<span id="cb83-145"><a href="#cb83-145"></a>  temperature_plot <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb83-146"><a href="#cb83-146"></a>    data<span class="sc">$</span>weather <span class="sc">%&gt;%</span></span>
<span id="cb83-147"><a href="#cb83-147"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(mean_temperature)) <span class="sc">%&gt;%</span></span>
<span id="cb83-148"><a href="#cb83-148"></a>      <span class="fu">mutate</span>(<span class="at">var =</span> <span class="st">"Mean daily temperature (celsius)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb83-149"><a href="#cb83-149"></a>      <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> report_date, <span class="at">y =</span> mean_temperature)) <span class="sc">+</span></span>
<span id="cb83-150"><a href="#cb83-150"></a>      <span class="fu">vline</span>() <span class="sc">+</span></span>
<span id="cb83-151"><a href="#cb83-151"></a>      <span class="fu">geom_point</span>(<span class="at">fill =</span> td_colors<span class="sc">$</span>nice<span class="sc">$</span>strong_red, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb83-152"><a href="#cb83-152"></a>      <span class="fu">facet_wrap</span>(<span class="sc">~</span> var) <span class="sc">+</span></span>
<span id="cb83-153"><a href="#cb83-153"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb83-154"><a href="#cb83-154"></a>           <span class="at">title =</span> <span class="st">"Weather vs date"</span>,</span>
<span id="cb83-155"><a href="#cb83-155"></a>           <span class="at">subtitle =</span> <span class="st">"Use the table below to edit values for prediction"</span>) <span class="sc">+</span></span>
<span id="cb83-156"><a href="#cb83-156"></a>      <span class="fu">scale_x</span>() <span class="sc">+</span></span>
<span id="cb83-157"><a href="#cb83-157"></a>      <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb83-158"><a href="#cb83-158"></a>      dunnr<span class="sc">::</span><span class="fu">add_facet_borders</span>()</span>
<span id="cb83-159"><a href="#cb83-159"></a>  })</span>
<span id="cb83-160"><a href="#cb83-160"></a>  precipitation_plot <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb83-161"><a href="#cb83-161"></a>    data<span class="sc">$</span>weather <span class="sc">%&gt;%</span></span>
<span id="cb83-162"><a href="#cb83-162"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(total_precipitation)) <span class="sc">%&gt;%</span></span>
<span id="cb83-163"><a href="#cb83-163"></a>      <span class="fu">mutate</span>(<span class="at">var =</span> <span class="st">"Total daily precipitation (mm)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb83-164"><a href="#cb83-164"></a>      <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> report_date, <span class="at">y =</span> total_precipitation)) <span class="sc">+</span></span>
<span id="cb83-165"><a href="#cb83-165"></a>      <span class="fu">vline</span>() <span class="sc">+</span></span>
<span id="cb83-166"><a href="#cb83-166"></a>      <span class="fu">geom_col</span>(<span class="at">fill =</span> td_colors<span class="sc">$</span>nice<span class="sc">$</span>spanish_blue, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb83-167"><a href="#cb83-167"></a>      <span class="fu">facet_wrap</span>(<span class="sc">~</span> var) <span class="sc">+</span></span>
<span id="cb83-168"><a href="#cb83-168"></a>      <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb83-169"><a href="#cb83-169"></a>      <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb83-170"><a href="#cb83-170"></a>      <span class="fu">scale_x</span>() <span class="sc">+</span></span>
<span id="cb83-171"><a href="#cb83-171"></a>      <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb83-172"><a href="#cb83-172"></a>      dunnr<span class="sc">::</span><span class="fu">add_facet_borders</span>()</span>
<span id="cb83-173"><a href="#cb83-173"></a>  })</span>
<span id="cb83-174"><a href="#cb83-174"></a></span>
<span id="cb83-175"><a href="#cb83-175"></a>  snow_plot <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb83-176"><a href="#cb83-176"></a>    data<span class="sc">$</span>weather <span class="sc">%&gt;%</span></span>
<span id="cb83-177"><a href="#cb83-177"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(snow_on_ground)) <span class="sc">%&gt;%</span></span>
<span id="cb83-178"><a href="#cb83-178"></a>      <span class="fu">mutate</span>(<span class="at">var =</span> <span class="st">"Snow on ground (cm)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb83-179"><a href="#cb83-179"></a>      <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> report_date, <span class="at">y =</span> snow_on_ground)) <span class="sc">+</span></span>
<span id="cb83-180"><a href="#cb83-180"></a>      <span class="fu">vline</span>() <span class="sc">+</span></span>
<span id="cb83-181"><a href="#cb83-181"></a>      <span class="fu">geom_col</span>(<span class="at">fill =</span> td_colors<span class="sc">$</span>nice<span class="sc">$</span>charcoal, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb83-182"><a href="#cb83-182"></a>      <span class="fu">facet_wrap</span>(<span class="sc">~</span> var) <span class="sc">+</span></span>
<span id="cb83-183"><a href="#cb83-183"></a>      <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb83-184"><a href="#cb83-184"></a>      <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb83-185"><a href="#cb83-185"></a>      <span class="fu">scale_x</span>() <span class="sc">+</span></span>
<span id="cb83-186"><a href="#cb83-186"></a>      <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb83-187"><a href="#cb83-187"></a>      dunnr<span class="sc">::</span><span class="fu">add_facet_borders</span>()</span>
<span id="cb83-188"><a href="#cb83-188"></a>  })</span>
<span id="cb83-189"><a href="#cb83-189"></a>  wind_plot <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb83-190"><a href="#cb83-190"></a>    data<span class="sc">$</span>weather <span class="sc">%&gt;%</span></span>
<span id="cb83-191"><a href="#cb83-191"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(speed_max_gust)) <span class="sc">%&gt;%</span></span>
<span id="cb83-192"><a href="#cb83-192"></a>      <span class="fu">mutate</span>(<span class="at">var =</span> <span class="st">"Maximum wind gust (km/h)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb83-193"><a href="#cb83-193"></a>      <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> report_date, <span class="at">y =</span> speed_max_gust)) <span class="sc">+</span></span>
<span id="cb83-194"><a href="#cb83-194"></a>      <span class="fu">vline</span>() <span class="sc">+</span></span>
<span id="cb83-195"><a href="#cb83-195"></a>      <span class="fu">geom_point</span>(<span class="at">fill =</span> td_colors<span class="sc">$</span>nice<span class="sc">$</span>emerald, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb83-196"><a href="#cb83-196"></a>      <span class="fu">facet_wrap</span>(<span class="sc">~</span> var) <span class="sc">+</span></span>
<span id="cb83-197"><a href="#cb83-197"></a>      <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb83-198"><a href="#cb83-198"></a>      <span class="fu">scale_x</span>()</span>
<span id="cb83-199"><a href="#cb83-199"></a>  })</span>
<span id="cb83-200"><a href="#cb83-200"></a></span>
<span id="cb83-201"><a href="#cb83-201"></a>  output<span class="sc">$</span>weather_plot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb83-202"><a href="#cb83-202"></a>    <span class="fu">temperature_plot</span>() <span class="sc">+</span></span>
<span id="cb83-203"><a href="#cb83-203"></a>      <span class="fu">precipitation_plot</span>() <span class="sc">+</span></span>
<span id="cb83-204"><a href="#cb83-204"></a>      <span class="fu">snow_plot</span>() <span class="sc">+</span></span>
<span id="cb83-205"><a href="#cb83-205"></a>      <span class="fu">wind_plot</span>() <span class="sc">+</span></span>
<span id="cb83-206"><a href="#cb83-206"></a>      <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb83-207"><a href="#cb83-207"></a>  })</span>
<span id="cb83-208"><a href="#cb83-208"></a></span>
<span id="cb83-209"><a href="#cb83-209"></a>  output<span class="sc">$</span>weather_table <span class="ot">&lt;-</span> <span class="fu">renderDataTable</span>(</span>
<span id="cb83-210"><a href="#cb83-210"></a>    <span class="fu">datatable</span>(</span>
<span id="cb83-211"><a href="#cb83-211"></a>      data<span class="sc">$</span>weather,</span>
<span id="cb83-212"><a href="#cb83-212"></a>      <span class="at">rownames =</span> <span class="cn">FALSE</span>, <span class="at">escape =</span> <span class="cn">FALSE</span>,</span>
<span id="cb83-213"><a href="#cb83-213"></a>      <span class="at">colnames =</span> <span class="fu">c</span>(<span class="st">"Date"</span>, <span class="st">"Temp."</span>, <span class="st">"Precip."</span>, <span class="st">"Snow"</span>, <span class="st">"Wind"</span>),</span>
<span id="cb83-214"><a href="#cb83-214"></a>      <span class="at">editable =</span> <span class="fu">list</span>(<span class="at">target =</span> <span class="st">"cell"</span>, <span class="at">numeric =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)),</span>
<span id="cb83-215"><a href="#cb83-215"></a>      <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">7</span>, <span class="at">dom =</span> <span class="st">"tp"</span>),</span>
<span id="cb83-216"><a href="#cb83-216"></a>      <span class="at">caption =</span> <span class="st">"Double click a cell to edit values. Plots and predictions will update automatically."</span></span>
<span id="cb83-217"><a href="#cb83-217"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb83-218"><a href="#cb83-218"></a>      DT<span class="sc">::</span><span class="fu">formatStyle</span>(<span class="fu">names</span>(data<span class="sc">$</span>weather), <span class="at">lineHeight =</span> <span class="st">"80%"</span>)</span>
<span id="cb83-219"><a href="#cb83-219"></a>  )</span>
<span id="cb83-220"><a href="#cb83-220"></a></span>
<span id="cb83-221"><a href="#cb83-221"></a>  <span class="fu">observeEvent</span>(input<span class="sc">$</span>weather_table_cell_edit, {</span>
<span id="cb83-222"><a href="#cb83-222"></a>    row <span class="ot">&lt;-</span> input<span class="sc">$</span>weather_table_cell_edit<span class="sc">$</span>row</span>
<span id="cb83-223"><a href="#cb83-223"></a>    col <span class="ot">&lt;-</span> input<span class="sc">$</span>weather_table_cell_edit<span class="sc">$</span>col</span>
<span id="cb83-224"><a href="#cb83-224"></a>    data<span class="sc">$</span>weather[row, col <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> input<span class="sc">$</span>weather_table_cell_edit<span class="sc">$</span>value</span>
<span id="cb83-225"><a href="#cb83-225"></a>  })</span>
<span id="cb83-226"><a href="#cb83-226"></a>}</span>
<span id="cb83-227"><a href="#cb83-227"></a></span>
<span id="cb83-228"><a href="#cb83-228"></a>ui <span class="ot">&lt;-</span> <span class="fu">dashboardPage</span>(</span>
<span id="cb83-229"><a href="#cb83-229"></a>  <span class="at">skin =</span> <span class="st">"yellow"</span>,</span>
<span id="cb83-230"><a href="#cb83-230"></a>  <span class="fu">dashboardHeader</span>(<span class="at">title =</span> <span class="st">"Predicting bike ridership in Halifax, NS"</span>,</span>
<span id="cb83-231"><a href="#cb83-231"></a>                  <span class="at">titleWidth =</span> <span class="dv">500</span>),</span>
<span id="cb83-232"><a href="#cb83-232"></a>  <span class="fu">dashboardSidebar</span>(<span class="at">disable =</span> <span class="cn">TRUE</span>),</span>
<span id="cb83-233"><a href="#cb83-233"></a>  <span class="fu">dashboardBody</span>(</span>
<span id="cb83-234"><a href="#cb83-234"></a>    tags<span class="sc">$</span><span class="fu">head</span>(</span>
<span id="cb83-235"><a href="#cb83-235"></a>      tags<span class="sc">$</span><span class="fu">link</span>(<span class="at">rel =</span> <span class="st">"stylesheet"</span>, <span class="at">type =</span> <span class="st">"text/css"</span>, <span class="at">href =</span> <span class="st">"custom.css"</span>)</span>
<span id="cb83-236"><a href="#cb83-236"></a>    ),</span>
<span id="cb83-237"><a href="#cb83-237"></a>    <span class="fu">fluidRow</span>(</span>
<span id="cb83-238"><a href="#cb83-238"></a>    <span class="fu">column</span>(</span>
<span id="cb83-239"><a href="#cb83-239"></a>      <span class="at">width =</span> <span class="dv">3</span>,</span>
<span id="cb83-240"><a href="#cb83-240"></a>      <span class="fu">box</span>(</span>
<span id="cb83-241"><a href="#cb83-241"></a>        <span class="at">title =</span> <span class="fu">HTML</span>(<span class="fu">paste0</span>(<span class="fu">as.character</span>(<span class="fu">icon</span>(<span class="st">"info"</span>)), <span class="st">" &lt;b&gt;Info&lt;/b&gt;"</span>)),</span>
<span id="cb83-242"><a href="#cb83-242"></a>        <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb83-243"><a href="#cb83-243"></a>        <span class="at">style =</span> <span class="st">"overflow-x: scroll;"</span>,</span>
<span id="cb83-244"><a href="#cb83-244"></a>        <span class="fu">uiOutput</span>(<span class="st">"model_info_1"</span>),</span>
<span id="cb83-245"><a href="#cb83-245"></a>        <span class="fu">img</span>(<span class="at">src =</span> <span class="st">"bike-counter-sites.png"</span>,</span>
<span id="cb83-246"><a href="#cb83-246"></a>            <span class="at">style =</span> <span class="st">"width: 300px; display: block; margin-left: auto; margin-right: auto;"</span>),</span>
<span id="cb83-247"><a href="#cb83-247"></a>        <span class="fu">uiOutput</span>(<span class="st">"model_info_2"</span>)</span>
<span id="cb83-248"><a href="#cb83-248"></a>      )</span>
<span id="cb83-249"><a href="#cb83-249"></a>    ),</span>
<span id="cb83-250"><a href="#cb83-250"></a>    <span class="fu">column</span>(</span>
<span id="cb83-251"><a href="#cb83-251"></a>      <span class="at">width =</span> <span class="dv">5</span>,</span>
<span id="cb83-252"><a href="#cb83-252"></a>      <span class="fu">box</span>(</span>
<span id="cb83-253"><a href="#cb83-253"></a>        <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb83-254"><a href="#cb83-254"></a>        <span class="at">style =</span> <span class="st">"overflow-x: scroll;"</span>,</span>
<span id="cb83-255"><a href="#cb83-255"></a>        <span class="fu">plotOutput</span>(<span class="st">"n_bikes_plot"</span>, <span class="at">height =</span> <span class="st">"800px"</span>)</span>
<span id="cb83-256"><a href="#cb83-256"></a>      )</span>
<span id="cb83-257"><a href="#cb83-257"></a>    ),</span>
<span id="cb83-258"><a href="#cb83-258"></a>    <span class="fu">column</span>(</span>
<span id="cb83-259"><a href="#cb83-259"></a>      <span class="at">width =</span> <span class="dv">4</span>,</span>
<span id="cb83-260"><a href="#cb83-260"></a>      <span class="fu">box</span>(</span>
<span id="cb83-261"><a href="#cb83-261"></a>        <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb83-262"><a href="#cb83-262"></a>        <span class="at">style =</span> <span class="st">"overflow-x: scroll;"</span>,</span>
<span id="cb83-263"><a href="#cb83-263"></a>        <span class="fu">plotOutput</span>(<span class="st">"weather_plot"</span>, <span class="at">height =</span> <span class="st">"600px"</span>),</span>
<span id="cb83-264"><a href="#cb83-264"></a>        <span class="fu">dataTableOutput</span>(<span class="st">"weather_table"</span>)</span>
<span id="cb83-265"><a href="#cb83-265"></a>      )</span>
<span id="cb83-266"><a href="#cb83-266"></a>    )</span>
<span id="cb83-267"><a href="#cb83-267"></a>  )</span>
<span id="cb83-268"><a href="#cb83-268"></a>  )</span>
<span id="cb83-269"><a href="#cb83-269"></a>)</span>
<span id="cb83-270"><a href="#cb83-270"></a></span>
<span id="cb83-271"><a href="#cb83-271"></a><span class="fu">shinyApp</span>(ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>Also publicly available: <a href="https://hfx-bike-ridership-app-74govvz7xq-uc.a.run.app/">https://hfx-bike-ridership-app-74govvz7xq-uc.a.run.app/</a></li>
</ul>
</section></section>
<section>
<section id="conclusions" class="title-slide slide level1 center">
<h1>Conclusions</h1>

</section>
<section id="conclusions-1" class="slide level2">
<h2>Conclusions</h2>
<div>
<ol type="1">
<li class="fragment">Retrieved bicycle counter data from the city of Halifax</li>
<li class="fragment">Retrieved historical weather data from the government of Canada</li>
<li class="fragment">Prepared data for modeling</li>
<li class="fragment">Fit and evaluated many machine learning models</li>
<li class="fragment">Deployed the full pipeline on GCP
<ul>
<li class="fragment">ETL on a schedule</li>
<li class="fragment">Automatic model fitting</li>
<li class="fragment">REST API</li>
<li class="fragment">Shiny app</li>
</ul></li>
</ol>
</div>
<div class="columns">
<div class="column" style="width:60%;">
<div>
<ul>
<li class="fragment">Take-aways:
<ul>
<li class="fragment">Data you care about is a <em>great</em> way to learn data science</li>
<li class="fragment">EDA and feature engineering are 80% of the work</li>
<li class="fragment">Missing data is hard</li>
</ul></li>
</ul>
</div>
</div><div class="column" style="width:40%;">
<div>
<ul>
<li class="fragment">Some idea for the future:
<ul>
<li class="fragment">Data monitoring</li>
<li class="fragment">Model monitoring</li>
<li class="fragment">Integrate weather forecasts into predictions</li>
</ul></li>
</ul>
</div>
</div>
</div>
</section></section>
<section>
<section id="thank-you" class="title-slide slide level1 center">
<h1>Thank you!</h1>

</section>
<section id="extra-slides" class="slide level2" data-visibility="uncounted">
<h2>Extra slides</h2>
<div class="footer footer-default">

</div>
</section></section>

    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="hfx-bike-ridership_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="hfx-bike-ridership_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="hfx-bike-ridership_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="hfx-bike-ridership_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="hfx-bike-ridership_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="hfx-bike-ridership_files/libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="hfx-bike-ridership_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="hfx-bike-ridership_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="hfx-bike-ridership_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="hfx-bike-ridership_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="hfx-bike-ridership_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'smaller': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true,"boardmarkerWidth":5},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'default',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1920,

        height: 1080,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        function fireSlideChanged(previousSlide, currentSlide) {

          // dispatch for htmlwidgets
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for reveal
        if (window.Reveal) {
          window.Reveal.addEventListener("slidechanged", function(event) {
            fireSlideChanged(event.previousSlide, event.currentSlide);
          });
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        toggleBodyColorMode(window.document.querySelector("link#quarto-bootstrap"));
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        target: function(trigger) {
          return trigger.previousElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        setTimeout(function() {
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn) {
        const config = {
          allowHTML: true,
          content: contentFn,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto-reveal',
          placement: 'bottom-start'
        };
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          let href = ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const cites = ref.parentNode.getAttribute('data-cites').split(' ');
        tippyHover(ref, function() {
          var popup = window.document.createElement('div');
          cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    });
    </script>
    

</body></html>